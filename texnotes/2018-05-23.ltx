\documentclass{article}
\input{theorem}
\input{prooftree}
\usepackage{stmaryrd}
\usepackage{latexsym}
\usepackage{yfonts}
\usepackage{amsmath}
\usepackage[usenames,dvipsnames,svgnames,table]{xcolor}
\usepackage{tikz}
\usetikzlibrary{calc,arrows,cd,decorations.pathreplacing}
\usetikzlibrary{decorations.pathmorphing}
\usepackage{tcolorbox}
\tcbuselibrary{breakable}
\usepackage{listings}
\lstset{basicstyle=\ttfamily\footnotesize,breaklines=true}

\def\thn{\mathrel|}
\def\coe{\mathsf{coe}}
\def\bpush{\mathbf{push}}
\def\bpull{\mathbf{pull}}

\def\wo{\setminus}
\def\fA{\mathsf{A}}
\def\fC{\mathsf{C}}
\def\fX{\mathsf{X}}
\def\ff{\mathsf{f}}
\def\fm{\mathsf{m}}
\def\rspan{\mathsf{Span}}
% \def\El#1{\mathsf{El}({#1})}
\def\El#1{\ulcorner{#1}\urcorner}
\def\U{\mathsf{U}}
\def\uu{\mathsf{u}}
\def\uni{\U}
\def\mor#1#2{#1 \to \underline{#2}}

\def\ridp{\mathsf{idp}}
\def\ssem#1{\langle\!\langle{#1}\rangle\!\rangle}

\definecolor{lred}{rgb}{0.95,0.8,0.8}
\definecolor{cyan}{rgb}{0.80,0.95,0.95}
\definecolor{orange}{rgb}{0.95,0.90,0.80}
\definecolor{bluegray}{rgb}{0.6,0.6,0.85}
\definecolor{lgray}{gray}{0.9}
\newtcolorbox{declbox}{colframe=lred,colback=lred,grow to right by=-10mm,grow to left by=-10mm,
boxrule=0pt,boxsep=0pt,breakable}
\newtcolorbox{thmbox}{colframe=cyan,colback=cyan,grow to right by=-10mm,grow to left by=-10mm,
boxrule=0pt,boxsep=0pt,breakable}
\newtcolorbox{defnbox}{colframe=orange,colback=orange,grow to right by=-10mm,grow to left by=-10mm,
boxrule=0pt,boxsep=0pt,breakable}
\newtcolorbox{tangentbox}{colframe=lgray,colback=lgray,grow to right by=-10mm,grow to left by=-10mm,
boxrule=0pt,boxsep=0pt,breakable}

\input{linear}
\def\rpath#1{[#1]}
\def\rfst{\mathsf{fst}\,}
\def\rsnd{\mathsf{snd}\,}
\def\bunfold{\mathbf{unfold}}
\def\bfold{\mathbf{fold}}
\def\susp#1{\langle {#1} \rangle}
\def\ssusp#1{\langle\!\langle {#1} \rangle\!\rangle}
\def\dto{\mathrel{\dot\to}}
\def\dns{{\downarrow}}
\def\ups{{\uparrow}}
\def\sprov{\Vdash}
\def\signat{{\color{red}\Sigma}}
\def\ep#1{\underline{#1}}
\def\wat{\mathbin{@}}
\def\wwat{\mathbin{\underline\wat}}
\def\cn{{:}}
\def\dv{{\div}}
\def\ww{{\mathsf w}}
\def\base{{\textfrak b}}

\def\munit{I}
\def\tt{{\mathsf t}}
\def\ii{{\mathbb I}}
\def\T{\mathbb{T}}
\def\pp{\textsf{\textbf p}}
\def\nn{{\mathsf n}}
\def\PP{\textsf{\textbf P}}
\def\NN{{\mathsf N}}
\def\zz{{\mathsf z}}
\def\sem#1{[\![#1]\!]}
\def\usem#1{\lceil\!\!\lceil{#1}\rceil\!\!\rceil}
\def\zem#1{\langle\!\langle#1\rangle\!\rangle}
\def\col#1{{\mathsf{C}}_{#1}}
\def\lax{\mathop\bigcirc}
\def\rjust{\mathsf{just}}
\def\rcvt{\mathsf{cvt}}
\def\rtype{\mathsf{type}}
\def\rdtype{\mathsf{disc}}
\def\rkind{\mathsf{kind}}
\def\rmode{\mathsf{mode}}
\def\rprel{\mathbf{Prel}}
\def\rrfam{\mathbf{Rfam}}
\def\rset{\mathbf{Set}}
\def\rfinset{\mathbf{FinSet}}
\def\rrel{\mathbf{Rel}}
\def\rcat{\mathbf{Cat}}
\def\rfam{\mathbf{Fam}}
\def\binj{\mathbf{inj}}
\def\rid{\mathsf{id}}
\def\rtrue{\mathrel\mathrm{true}}
\def\pbck{\ar[dr, phantom, pos=0, "\lrcorner"]}
\def\bpbck{\ar[ddrr, phantom, pos=0, "\lrcorner"]}
\def\erule#1#2{\begin{prooftree}#1\justifies #2\end{prooftree}}
\def\lpar{\bindnasrepma}
\def\lamp{\binampersand}
\def\btwo{\mathbf{2}}
\def\bone{\mathbf{1}}

\newarrow {Equiv} =====
\def\FinSet{\mathbf{FinSet}}
\def\x{\times}
\def\maps{\ar[dd,mapsto,shorten <=2em, shorten >=2em]}
\def\mapt{\ar[ddd,mapsto,shorten <=2em, shorten >=2em]}
\def\frommaps{\ar[from=uu,mapsto,shorten <=2em, shorten >=2em, crossing over]}
\def\frommapt{\ar[from=uuu,mapsto,shorten <=2em, shorten >=2em, crossing over]}
\def\C{\mathbf{C}}
\def\G{\mathbf{G}}
\def\S{\mathbf{S}}
\def\D{\mathbf{D}}
\def\E{\mathbf{E}}
\def\M{\mathbf{M}}
\def\pair#1#2{\langle#1,#2\rangle}
\def\ltri{{\lhd}}
\def\rtri{{\rhd}}
\def\o{\circ}
\def\rctx{\,\mathsf{ctx}}
\def\rdctx{\,\mathsf{dctx}}
\def\del{\partial}
\def\also#1{\ \textcolor{blue}{\celse #1}}
\newcounter{nodemaker}
\setcounter{nodemaker}{0}
\def\twocell#1#2{%
  \global\edef\mynodeone{twocell\arabic{nodemaker}}%
  \stepcounter{nodemaker}%
  \global\edef\mynodetwo{twocell\arabic{nodemaker}}%
  \stepcounter{nodemaker}%
  \ar[#1,phantom,shift left=3,""{name=\mynodeone}]%
  \ar[#1,phantom,shift right=3,""'{name=\mynodetwo}]%
  \ar[Rightarrow,#2,from=\mynodeone,to=\mynodetwo]%
}
\def\twocellswap#1#2{%
  \global\edef\mynodeone{twocell\arabic{nodemaker}}%
  \stepcounter{nodemaker}%
  \global\edef\mynodetwo{twocell\arabic{nodemaker}}%
  \stepcounter{nodemaker}%
  \ar[#1,phantom,shift right=3,""{name=\mynodeone}]%
  \ar[#1,phantom,shift left=3,""'{name=\mynodetwo}]%
  \ar[Rightarrow,#2,from=\mynodeone,to=\mynodetwo]%
}
\def\maps{\ar[dd,mapsto,shorten <=2em, shorten >=2em]}
\author{Jason Reed}
\definecolor{fib}{HTML}{ff7f00}
\definecolor{green}{HTML}{007f00}
\definecolor{red}{HTML}{df3f3f}
\definecolor{opfib}{HTML}{007fff}

% For lightening colors I used
% http://trycolors.com/ 6 parts white to 1 part color
\definecolor{opfibl}{HTML}{DBEDFF}
\definecolor{greenl}{HTML}{DBEDDB}
\definecolor{redl}{HTML}{FAE4E4}
\def\njudge#1{\fcolorbox{opfib}{white}{#1}}
\def\nrule#1{\fcolorbox{white}{opfibl}{#1}}
\def\neqn#1{\fcolorbox{white}{redl}{#1}}



\def\judge#1{\vskip 2em\noindent \njudge{$#1$}\vskip 0.5em\noindent}
\def\rule#1{\vskip 2em \noindent \nrule{$#1$}\vskip 0.5em\noindent}
\def\eqn#1{\vskip 2em \noindent \neqn{$#1$}\vskip 0.5em\noindent}
\def\prof{\nrightarrow}
\def\tensor{\otimes}
\def\htensor{\mathrel{\hat\otimes}}
\def\lol{\multimap}
\def\hlol{\mathrel{\hat\multimap}}
\def\wtf{{\color{red}???}}

\def\re{\mathbf{E}}
\def\sh{\sharp}
\def\shp{\mathrel{\sharp}}
\def\zero{\texttt{0}}
\begin{document}

\def\
\tikzset{
   commutative diagrams/.cd,
   arrow style=tikz,
   diagrams={>=stealth}}

\section{Just Thinking About Notation}

\def\rs{{\sqsupset}}
\def\ls{{\sqsubset}}
\def\ll{\mathsf{L}}
\def\rr{\mathsf{R}}
\def\cc{\mathsf{c}}
\def\dd{\mathsf{d}}
\def\ccc{\mathsf{C}}
\def\ddd{\mathsf{D}}
\def\tw{{\bullet}}

What if, for
\[\tau \qquad = \qquad \begin{tikzcd}
  \delta' \ar[r, "\psi"]\ar[d, "\tau_1"'] & \epsilon'\ar[from=d, "\tau_2"']\\
  \delta \ar[r, "\phi"']& \epsilon
\end{tikzcd}\]
I define $\ll \tau = \tau_1$ and $\rr \tau = \tau_2$
and $\cc \tau = \phi$ and $\dd \tau = \psi$
and
\[\tw \tau =
\begin{tikzcd}
  \tw\delta' \ar[from=r, "\tw\psi"']\ar[from=d, "\tw{\tau_1}"] & \tw\epsilon'\ar[d, "\tw{\tau_2}"]\\
  \tw\delta \ar[from=r, "\tw\phi"]& \tw\epsilon
\end{tikzcd}\]
 \begin{defnbox}
   \(
   \ls \tau  = \begin{tikzcd}
     \delta' \ar[r, "\psi"]\ar[d, equal] & \epsilon'\ar[from=d, "\tau_2 \o \phi"']\\
     \delta' \ar[r, "\tau_1"']& \delta
   \end{tikzcd}
   \qquad
   \rs \tau  = \begin{tikzcd}
     \delta' \ar[r, "\psi"]\ar[d, "\phi \o \tau_1"'] & \epsilon'\ar[from=d, equal]\\
     \epsilon \ar[r, "\tau_2"']& \epsilon'
   \end{tikzcd}
\)
 \end{defnbox}
A general $\tau$ can be written
\[\tau \qquad = \qquad \begin{tikzcd}
  \ddd\dd\tau \ar[r, "\dd \tau"]\ar[d, "\ll \tau"'] & \ccc\dd\tau\ar[from=d, "\rr \tau"']\\
  \ddd\cc\tau \ar[r, "\cc \tau"']& \ccc\cc\tau
\end{tikzcd}\]
with $\ddd$ and $\ccc$ being domain and codomain in $\sem \Delta$.
\begin{thmbox}
$\ls \tau : \dd \tau \to \ll \tau  $\\
$\rs \tau : \dd \tau \to \rr \tau  $\\

\begin{tabular}{ll}
$\ll \ls \tau = \ddd \dd \tau  $&$ \rr \ls \tau = \rr \tau  \o \cc \tau$\\
$\ll \rs \tau = \cc \tau \o \ll \tau $&$ \rr \rs \tau = \ccc \dd \tau $\\
$\tw \ll \tau = \rr \tw \tau $&$ \tw \rr \tau = \ll \tw \tau$\\
$\tw \ls \tau = \rs \tw \tau $&$ \tw \rs \tau = \ls \tw \tau$\\
$\tw \ccc \tau = \ddd \tw \tau $&$ \tw \ddd \tau = \ccc \tw \tau$\\
$\tw \cc \tau = \cc \tw \tau $&$ \tw \dd \tau = \dd \tw \tau$\\
$\ll (\tau \o \sigma) = \ll \tau \o \ll \sigma$&
$\rr (\tau \o \sigma) = \rr \tau \o \rr \sigma$\\
\end{tabular}
\end{thmbox}
\[
\erule
{\ll x = \ll y\qquad \rr x = \rr y}
{x = y}
\]
Want to prove things like
\[{\ls \ll \tau} \o {\ls \tau}  = {\ls\dd \tau} \qquad
{\ls \cc \tau} \o \tau = {\rs \ll \tau } \o {\ls \tau}\]
Hm I don't think this is much easier than doing it diagrammatically.
\section{Working Out Duals}
\[(\Gamma, x - A)_\phi = (\Gamma^\op, x + A)^\op_\phi\]
\[ = (\Gamma^\op, x + A)_{\bar \phi} \]
\[ = (g : \Gamma^\op_{\bar \phi}) \x A_{\dd \bar \phi}( \Gamma^\op_{\ltri\bar\phi} g ) \]
\[ = (g : \Gamma_\phi) \x A_{\overline{\cc  \phi}}( \Gamma_{\rtri\phi} g ) \]
\[ (\Gamma, x - A)_\tau (g, a) = (\Gamma^\op, x + A)^\op_\phi \]
\[ = (\Gamma^\op_{\bar \tau} g, A_{\ll \bar \tau}(\Gamma^\op_{\ltri \bar \tau}g , a) ) \]
\[ = (\Gamma_\tau g, A_{\overline{\rr \tau}}(\Gamma_{ \rtri \tau}g , a) ) \]

\section{Are Signed Variables Necessary?}

If I have unsigned variables in $\Delta$, is there a way of
`automatically doing the right thing' with respect to variables in
$\Gamma$ without knowing a priori what sign they are?

%% Recall that it's the $\Pi$ and $\Sigma$ rules that motivated this marking in the first place.
%% $\alpha + \C ; \Gamma, x + A \prov B : \rtype$ has morphism interpretation
%% \[(\alpha : \C) : \Gamma\]

I think I can reduce confusion by being more explicit about how I've
really been treating variables up to this point. There is an operation
$\Delta\mapsto\Delta^\op$ which takes $\alpha : \C$ to $\alpha :
\C^\op$ (or, if you like, $\alpha + \C$ to $\alpha - \C$ and
vice-versa)

The operation $\Gamma \mapsto \Gamma^\op$ does
\begin{defnbox}
  \begin{tabular}{lll}
    $(\Gamma, x + A)^\op$&$=$&$\Gamma^\op, x - A$\\
    $(\Gamma, x - A)^\op$&$=$&$\Gamma^\op, x + A$\\
  \end{tabular}
\end{defnbox}
and satisfies
\begin{thmbox}
  If $\Delta \prov \Gamma \rctx$, then $\Delta^\op \prov \Gamma^\op \rctx$
\end{thmbox}
where context formation is given by
\[
\erule
{\Delta \prov \Gamma \rctx\qquad \Delta \thn \Gamma \prov A :\rtype}
{\Delta \prov \Gamma, x + A \rctx}
\qquad
\erule
{\Delta \prov \Gamma \rctx\qquad \Delta^\op \thn \Gamma^\op \prov A :\rtype}
{\Delta \prov \Gamma, x - A \rctx}
\]
But there's also a substitution operation on $\Delta$s.
We have
\[
\erule
{\alpha : \C \in \Delta}
{\Delta \prov \alpha : \C}
\qquad
\erule
{\alpha : \C \in \Delta}
{\Delta \prov \bar\alpha : \C^\op}
\qquad
\erule
{\Delta \prov t_i : \C_i \qquad F : \C_1 \x \cdots \C_n \to \C}
{\Delta \prov F(t_1, \ldots, t_n)  : \C}
\]
\[
\erule
{\Delta \prov \theta : \Delta' \qquad \Delta \prov t  : \C}
{\Delta \prov \theta[t / \alpha] : \Delta', \alpha : \C}
\]
so we expect a substitution theorem
\begin{thmbox}
  If $\Delta \prov \theta : \Delta'$ and $\Delta' \prov J$, then $\Delta \prov \theta J$.
\end{thmbox}
The thing we can do to variables $\bar \alpha$ extends to a general operation
 $t^\op$ on terms
\begin{defnbox}
  \begin{tabular}{lll}
    $ \alpha^\op$&$=$&$\bar\alpha$\\
    $ \bar\alpha^\op$&$=$&$\alpha$\\
    $(F(t_1, \ldots, t_n))^\op$&$=$&$F^\op(t_1^\op, \ldots, t_n^\op)$\\
  \end{tabular}
\end{defnbox}
which satisfies
\begin{thmbox}
  If $\Delta \prov t : \C$ then $\Delta \prov  t^\op : \C^\op$
\end{thmbox}

There's an operation we can do from the other side, which arises from a canonical
substitution $\Delta^\op \prov \mathsf{rev}_\Delta : \Delta$. For every $\alpha : C$
in $\Delta$, we have $[\bar\alpha / \alpha]$ in $\mathsf{rev}_\Delta$. We write
$\mathsf{rev_\Delta}$ applied to some thing $A$, $t$, etc. as
 $\bar A$, $\bar t$, etc. So the substitution theorem gives us that
\begin{thmbox}
  If $\Delta \prov t : \C$, then $\Delta^\op \prov \bar t : \C$\\
  If $\Delta \thn \Gamma \prov A : \rtype$, then $\Delta^\op \thn \bar \Gamma \prov  \bar A : \rtype$
\end{thmbox}

Ok, what then is the definition of substitution when we hit variables?
\[[t/\alpha]\bar\alpha =  ?\]
We have $\Delta \prov t : \C$ and $\alpha : \C \in \Delta'$, so
$\Delta \prov \bar \alpha : \C^\op$, so we need $\Delta \prov [t/\alpha]\bar \alpha : \C^\op$.
The sensible thing to do is
\[[t/\alpha]\bar\alpha =  t^\op\]
Apart from that, carrying out substitutions is the homomorphism we expect it to be.
\end{document}
