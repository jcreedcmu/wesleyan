\documentclass{article}
\usepackage{amssymb}
\input{theorem}

\input{prooftree}
\def\erule#1#2{\begin{prooftree}#1\justifies #2\end{prooftree}}
\def\pair#1#2{\langle #1 , #2 \rangle}
\def\lol{\multimap}

\usepackage{bm}
\usepackage{float}
\usepackage{tikz}
\usepackage{tikz-cd}
\newcommand{\sqdiamond}[1][fill=black]{\tikz [x=1.2ex,y=1.85ex,line width=.1ex,line join=round, yshift=-0.285ex] \draw  [#1]  (-0.25,.5) -- (0.5,1) -- (1.25,.5) -- (.5,0) --  cycle;}%
\newcommand{\dia}[1][fill=black]{\mathop{\raisebox{-0.275ex}{$\sqdiamond[#1]$}}}
\def\bx{\square}

%\usepackage{wasysym}
%\usepackage{stmaryrd}
\usetikzlibrary{calc}
\definecolor{morange}{rgb}{1,0.56,0}
\definecolor{lorange}{rgb}{1,0.95,0.8}
\definecolor{mgreen}{rgb}{0,0.56,0}
\definecolor{lgreen}{rgb}{0.95,1,0.8}
\definecolor{lgray}{rgb}{0.95,0.95,1.0}
\definecolor{mblue2}{rgb}{0,0.2,1.0}
\definecolor{lblue}{rgb}{0.8,0.95,1}
\definecolor{mred}{rgb}{0.9,0.1,0.1}
\definecolor{mgreen}{rgb}{0.1,0.5,0.1}
\definecolor{mblue}{rgb}{0.3,0.3,0.9}
\def\x{\times}
\def\bitf#1{#1 [smooth, tension=0.8] coordinates {(-1.6,2) (-1,1) (0,0)}}
\def\bitg#1{#1 [smooth, tension=0.8] coordinates {(1,2) (0.55,1) (0,0)}}
\def\bitgrev#1{#1 [smooth, tension=0.8] coordinates {(0,0) (0.55,1) (1,2)}}
\def\bitfg#1{#1 [smooth, tension=0.8] coordinates {(0,0) (0,-2) }}
\def\ep{\varepsilon}
\def\Top{\mathbf{Top}}
\def\TopR{\mathbf{TopR}}
\def\bcase{\mathop\mathbf{case}}
\def\bof{\mathop\mathbf{of}}
\def\binj{\mathbf{inj}}
\def\blet{\mathrel\mathbf{let}}
\def\bin{\mathrel\mathbf{in}}
\def\bmatch{\mathrel\mathbf{match}}
\def\bwith{\mathrel\mathbf{with}}
\def\pbck{\ar[dr, phantom, pos=0, "\lrcorner"]}
\def\ups{{\uparrow}}
\def\dns{{\downarrow}}
\def\grad{\nabla}
\def\uups{{\Uparrow}}
\def\ddns{{\Downarrow}}
\def\adjust{\big|}
\def\O{\mathcal{O}}
\def\rid{\mathsf{id}}
\def\ridp{\mathsf{idp}}
\def\rcoe{\mathsf{coe}}
\def\rtype{\mathsf{type}}
%\def\int{\square}
\def\bd{\partial}
\def\prov{\vdash}
\def\prequiv{\dashv\vdash}
\def\imp{\Rightarrow}
\def\cqed{\hskip2mm{\vrule width .5em height .5em depth 0em}} % at the end of a |P.
\def\o{\circ}
\def\lx{\bigcirc}
\def\B{\mathbb{B}}
\def\C{\mathbf{C}}
\def\K{\mathbf{K}}
\def\M{\mathbf{M}}
\def\T{\mathbf{T}}
\def\Set{\mathbf{Set}}
\def\D{\mathbf{D}}
\def\J{\mathbf{J}}
\def\R{\mathbb{R}}
\def\op{\mathsf{op}}
\def\P{\mathbb{P}}
\def\I{\mathbb{I}}
\def\U{\mathbb{U}}
\def\N{\mathbb{N}}
\def\Z{\mathbb{Z}}
\def\tw{\mathbf{2}}
\def\dash{\hbox{---}}
\def\span{\mathop{\mathrm{span}}}
\def\dom{\mathop{\mathrm{dom}}}
\def\cod{\mathop{\mathrm{cod}}}
\def\celse{\mathrel{|}}
\def\cn{{:}}
\def\rok{\mathrel\mathsf{ok}}
\def\llam#1{\langle {#1} \rangle}
\def\hf{{\odot}}
\def\lerp#1#2#3{#1[\![#2,#3]\!]}
\def\nope{\emptyset}
\def\ep{\varepsilon}
\def\rng{\mathop\mathrm{rng}}
\def\npart{\not\!\partial}
\def\null{\emptyset}
\def\xx{{\bf x}}
\def\yy{{\bf y}}
\def\ps{\wp}

\begin{document}
\tikzset{>=stealth}
\tikzset{
   commutative diagrams/.cd,
   arrow style=tikz,
   diagrams={>=stealth}}

\section{Thinking about a 2-d Modal Logic}

This is something that arose by trying to think about higher-dimensional analogs of adjoints.
A proposition is something like: a well-behaved compact subset of $\R^2$, (up to homotopies of $\R^2$)
and an entailment is something like a way of `adding ink' to that subset, making it bigger.
This is by analogy with with ordinary adjunctions characterize well-behaved compact subsets of $\R^1$
as lists of finite intervals interpreted as alternations of the adjoint functors $UFUFUF$, and $\eta$
lets us `create a new interval blob of ink' and $\epsilon$ lets us `join two blobs of ink'.
If $F : \C \to \D$ and $U : \D \to \C$ then we think of $\C$ as `whitespace' on the page, and $\D$ as `ink',
for $\eta : 1_\C \to UF$ and $\epsilon : FU \to 1_\D$.

The two-dimensional case looks syntactically like this, I think:
\def\ox{\otimes}
\def\pr{{\,\hskip0.1em\bindnasrepma\,}}
\[
\begin{tabular}{r@{$\quad$}c@{$\quad::=\quad$ }l}
   Polarities&$i$&$0 \celse 1$\\
   Contexts&$\Delta^i$&$\cdot \celse \Delta^i, A^i \celse \Delta^i, (\Delta^{\bar i})^i$\\
   Propositions&$A^i$&$1^i \celse A^i \ox^i A^i\celse \bigcirc^i A^{\bar i} $\\
\end{tabular}
\]
The complement of $i$ (swapping $0$ and $1$) is $\bar i$.
We write $\Gamma$ for either $\Delta^0$ or $\Delta^1$, and $\Gamma[\Gamma']$ for $\Gamma$ with $\Gamma'$ occurring somewhere
(perhaps deeply nested inside $($parentheses$)$) inside it.

%We write $(\Omega)^i$ and $(\Delta)^s$
%for the parentheses when it's important to disambiguate the overloading.

The propositions here are all positive; on the left we asynchronously decompose into judgmental context-material,
and on the right we demand it exists. Probably we could add some negative propositions but I haven't thought
through them yet. We leave off all the polarity superscripts here because the most general set
of them can be uniquely inferred.
\[
\erule
{\using 1 R}
{\cdot \prov 1}
\qquad
\erule
{\Gamma[\cdot] \prov \using 1 L}
{\Gamma[1] \prov}
\qquad
\erule
{\Gamma \prov A \using \bigcirc R}
{(\Gamma) \prov \bigcirc A}
\qquad
\erule
{\Gamma[ (A_0)] \prov \using \bigcirc L}
{\Gamma[\bigcirc A_0] \prov  }
\]
\[
\erule
{\Gamma_1 \prov A_1 \qquad \Gamma_2 \prov A_2\using \ox R}
{\Gamma_1, \Gamma_2 \prov A_1 \ox A_2}
\qquad
\erule
{\Gamma[A_1,A_2]\prov  \using {\ox} L}
{\Gamma[A_1 \ox A_2] \prov }
\]
The interesting content of the logic is its structural rules. We have
exchange (but not weakening or contraction) for the comma in both
kinds of contexts, and

\[
\erule
{\Gamma[(\Delta_1, \Delta_2)^1 ] \prov }
{\Gamma[(\Delta_1)^1, (\Delta_2)^1 ] \prov }
\qquad
\erule
{\Gamma[()^1 ] \prov }
{\Gamma[\cdot ] \prov }
\qquad
\erule
{\Gamma[(\Delta_1)^0, (\Delta_2)^0 ] \prov }
{\Gamma[(\Delta_1, \Delta_2)^0 ] \prov }
\qquad
\erule
{\Gamma[\cdot ] \prov }
{\Gamma[()^0 ] \prov }
\]
\[
\erule
{\Gamma[\Delta_1, ( \Delta_2)^0] \prov }
{\Gamma[((\Delta_1)^1, \Delta_2)^0] \prov }
\qquad
\erule
{\Gamma[((\Delta_1)^0, \Delta_2)^1] \prov }
{\Gamma[\Delta_1, ( \Delta_2)^1] \prov }
\]
\subsection{First-order Interpretation}
\def\tri{\triangleright}

Here's a translation that might be equivalent to the proof theory above. We imagine
that there are two classes of first-order worlds, and interpret into first-order linear logic
with unrestricted propositions for relation facts $v \tri w$.

We define
\def\wat{\mathrel{@}}
\[ (\bigcirc^1 A) \wat w = \forall v . (v\tri w) \imp A \wat v \]
\[ (\bigcirc^0 A) \wat v = \exists w.  (v \tri w)  \land A  \wat w \]
\[ (A \ox B) \wat w = (A \wat w) \ox (B \wat w) \]
\[ 1 \wat w = 1 \]
\[ a \wat w = a(w) \]

Essentially, this means $\bigcirc^0 A = \dia A$ and $\bigcirc^1 A = \bx A$.
\subsection{Proof Terms}

A proof term of the entailment
\[b : \bx 1 \ox \bx 1 \ox \bx 1 \prov M : \bx 1 \ox \bx 1  \ox \bx 1 \ox \bx 1 \]
should be something like a function $3 \to 4$. This seems about right. I could sketch
\[ \blet (x, y, z) = b \bin (\]
\[\Lambda k . \blet () = k[x] \bin\ \blet () = k[y] \bin () ,\]
\[\Lambda k . \blet () = k[z] \bin () ,\]
\[\Lambda k .  () ,\]
\[\Lambda k .  () \]
\[) \]
And this is the map that takes $(x,y,z) \to (0,1,2,3)$ and assigns $x,y$ to $0$ and $z$ to $1$.

Likewise a proof term  of
\[b : \dia 1 \ox \dia 1 \ox \dia 1  \ox \dia 1 \prov M : \dia 1 \ox \dia 1  \ox \dia 1 \]
should be a map $3 \to 4$. We write
\[ \blet b = ((k_0, ()), (k_1, ()), (k_2, ()), (k_3, ())) \bin ( \]
\[ \langle k_0,() \rangle, \langle k_0, () \rangle, \langle k_1, () \rangle \]
\[ )\]
for the same function.
\subsection{Soundness/Completeness}
I never know which direction to call these things. Let me describe directly a partial order
on propositions
\[
\begin{tabular}{r@{$\quad$}c@{$\quad::=\quad$ }l}
   Polarities&$i$&$0 \celse 1$\\
   Propositions&$P^i$&$1^i \celse P^i \ox^i P^i\celse \bigcirc^i P^{\bar i} \celse a^i $\\
\end{tabular}
\]
where I write as abbreviations $\dia = \bigcirc^0$ and $\bx = \bigcirc^1$.
Let me use consistently $A$ for $P^0$ and $B$ for $P^1$. Write $\equiv$ when $\le$ and $\ge$ both hold.
Take as axioms
\[
\bx A_1 \ox \bx A_2 \le \bx (A_1 \ox A_2)
\qquad
1 \le \bx 1
\]
\[
\dia (B_2 \ox B_2) \le \dia B_1 \ox \dia B_2
\qquad
\dia 1 \le 1
\]
\[ \bx A \ox B \le \bx (A \ox \dia B)
\qquad  \dia (B \ox \bx A) \le \dia B \ox A  \]
and associativity/commutativity/unit laws
\[ P^i \ox 1 \equiv P^i \]
\[ P^i_1 \ox P^i_2 \equiv P^i_2 \ox P^i_1 \]
\[ (P^i_1 \ox P^i_2) \ox P^i_3 \equiv P^i_1 \ox (P^i_2 \ox P^i_3) \]
and reflexivity and transitivity
\[
\erule{}{
a^i \le a^i}
\qquad
\erule
{P^i_1 \le P^i_2 \qquad P^i_2 \le P^i_3}
{P^i_1 \le P^i_3}
\]
and congruences
\[
\erule
{P^i_1 \le Q^i_1 \qquad P^i_2 \le Q^i_2}
{P^i_1 \ox P^i_2 \le Q^i_1 \ox Q^i_2}
\qquad
\erule
{}
{1 \le 1}
\qquad
\erule
{P^{\bar i} \le Q^{\bar i}}
{\bigcirc^i P^{\bar i} \le \bigcirc^i Q^{\bar i}}
\]
Then I conjecture $P^i \le Q^i$ iff $P^i[ w] \prov Q^i [ w]$.

I think the direction ${\le} \imp {\prov} $ is easy. I just inspect
every axiom, and find that the sequent-calculus version under translation holds.

The other direction is trickier. For every sequent
\[\Delta \prov P^i[w] \iff  P_1^{i_1}[w_1], \ldots, P_n^{i_n}[w_n] \prov P^i[w]\]
I need to come up with some interpretation of the context and the conclusion as props, and assert
\[ \Delta^* \le (P^i[w])^* \]
and proceed by induction on the sequent calculus rules somehow.

Let's have the following data structure:
\def\CC{{\mathsf C}}
\def\xto{\rightsquigarrow}
\[
\begin{tabular}{r@{$\quad$}c@{$\quad::=\quad$ }l}
   Trees&$C^i$&$ w^{ i} ( C^{\bar i}) \celse C^i \ox C^i \celse P^i$
\end{tabular}
\]
Tree expressions have actual world variables in them. I translate to contexts like
\[ w(C) \wat v = w :\mathsf{world}, w\tri v, (C \wat v)\]
\[ (C_1 \ox C_2) \wat w = (C_1 \wat w) \ox (C_2 \wat w) \]
\[ P \wat w = P[w] \]
I can translate to propositions like
\[ \pi(w(C))  = \bigcirc (\pi C) \]
\[ \pi(C_1 \ox C_2) = \pi C_1 \ox \pi C_2 \]
\[ \pi P  = P \]
and I can pick out a conclusion world via
?

Suppose I understood what it means for $C \xto_w \Delta$. One is meant to unpack
all the modalities eagerly as if they were asynchronous, even when they are not.

Then I claim: if $C \xto_w \Delta$, and $C' \xto_w P$, and $\Delta \prov P[w]$,
then $C \le C'$.

\subsection{Another Try}

Let's say $\Gamma$ is the unrestricted context in which world variables and relations between them exist.
Define a judgment that says how a context can reduce to a single proposition.
\[
\erule
{}
{\Gamma \prov P[u] \xto P[u]}
\]
\[
\erule{ \Gamma \prov v \tri w \qquad  \Gamma \prov \Delta, \bx B[w] \xto P[u]}
{\Gamma \prov \Delta, B[v] \xto P[u]}
\qquad
\erule{ \Gamma \prov v \tri w \qquad \Gamma \prov \Delta, \dia A[v] \xto P[u]}
{\Gamma \prov \Delta, A[w] \xto P[u]}
\]
\[
\erule
{\Gamma \prov \Delta, (P_1 \ox P_2)[w] \xto P[u]}
{\Gamma \prov \Delta, P_1[w], P_2[w] \xto P[u]}
\]
Then I think the other half of the adequacy theorem is the claim:
If $\Gamma; \Delta \prov P[w]$ and $\Gamma \prov \Delta \xto Q[u]$ and $\Gamma \prov P[w] \xto P'[u]$,
then $Q \le P'$.

The proof should go by induction on $\Gamma; \Delta \prov P[w]$. Let's look at an easy case first; the asynchronous
case of a modal operator. We suppose we have a derivation like
\[
\erule
{\Gamma, t, v\tri t; \Delta,  A[t] \prov P[w] \using {\dia} L}
{\Gamma; \Delta, \dia A[v] \prov P[w]}
\]
By assumption we have derivations
\[ \Gamma \prov \Delta, \dia A[v] \xto Q[u] \]
\[ \Gamma \prov P[w] \xto P'[u] \]
but we can construct
\[ \Gamma, t, v \tri t\prov \Delta, \dia A[t] \xto Q[u] \]
so the i.h. gives us $Q \le P'$ as required.

Let's tackle the asynchronous case for $\bx$, too, I'm suspicious of the asymmetry. We start with a derivation like
\[
\erule
{\Gamma, t, t\tri w; \Delta\prov B[t] \using {\bx} R}
{\Gamma; \Delta \prov \bx B[w]}
\]
and also we have
\[ \Gamma \prov \Delta \xto Q[u] \]
\[ \Gamma \prov \bx B[w] \xto P'[u] \]
but we can construct
\[
{\Gamma, t, t \tri w \prov \Delta, B[t] \xto P'[u]}
\]
so again we get $Q \le P'$ out of the induction hypothesis, phew.

Let's lookat the {\em synchronous} side of the modalities. I expect to encounter the `escaping' move here.
We could look at $\dia R$. We have a relation
\[
\erule
{\Gamma \prov v \tri t \qquad \Gamma; \Delta\prov A[t] \using {\dia} R}
{\Gamma; \Delta \prov \dia A[v]}
\]
and we have collateral derivations
\[ \Gamma \prov \Delta \xto Q[u] \]
\[ \Gamma \prov \dia A[v] \xto P'[u] \]
Now we want to derive something from that $\xto$ derivation involving $\dia A$. It seems we can get
\[
{\Gamma \prov  A[t] \xto P'[u]}
\]
which seems like it's too easy? What did we get away with here.

Let's try $\bx L$ just to be sure.
We have a derivation
\[
\erule
{\Gamma \prov  t\tri v \qquad \Delta,  B[t] \prov P[w] \using {\bx} L}
{\Gamma; \Delta, \bx B[v] \prov P[w]}
\]
and collateral derivations
\[ \Gamma \prov \Delta, \bx B[v] \xto Q[u] \]
\[ \Gamma \prov P[w] \xto P'[u] \]
and it seems we can derive
\[
\erule{ \Gamma \prov t \tri v \qquad  \Gamma \prov \Delta, \bx B[v] \xto Q[u]}
{\Gamma \prov \Delta, B[t] \xto Q[u]}
\]
so it looks like again we just straightforwardly get $Q \le P'$.
\subsection{Analyzing the Confusion}
When I have $a, b, c$ arising in
\[
\begin{prooftree}
\[
\[
\[
\justifies
b \tri a, b \tri c; A [c] \prov  B[b]
\]
\justifies
b \tri a ; \dia A [b] \prov  B[b]
\]
\justifies
b \tri a ; \bx( \dia A )[a] \prov  B[b]
\]
\justifies
\bx( \dia A )[a] \prov \bx B[a]
\end{prooftree}
\]

with $b \tri a$ and $b \tri c$ I don't actually know which is was the {\em root} of the tree of assumptions;
I just know I have an acyclic connected bipartite graph, I think. This same arrangement could have come from
\[
\begin{prooftree}
\[
\[
\[
\[
\justifies
b\tri a, b \tri c; A[c] \prov  B[b]
\]
\justifies
b\tri a;\dia A[b] \prov  B[b]
\]
\justifies
b\tri a;\dia A[b],  1[a] \prov  B[b]
\]
\justifies
\dia A[b], \dia 1[b] \prov  B[b]
\]
\justifies
\dia A\ox \dia 1[b] \prov  B[b]
\end{prooftree}
\]
Now both of these sequents are provable, if I substitute $A = \bx B$. Do these make sense graphically?
I think so:
\begin{figure}[H]
\centering
\includegraphics[scale=0.35]{images/modal-proofs.png}
\end{figure}

I conjecture that there is some canonical way of rolling back a sequent to an entailment involving only
a pair of propositions at the same world, given a choice of root of the bipartite tree, and maybe like
an ordering of leaves to roll back. To prove this I'd have to show how to roll back any leaf.

So there are really four cases. I spit on whether I'm going forward or backward on the leaf,
and whether that world appears in the conclusion or not. Case one is eliminating $a \tri \dash$
where $a$ is the conclusion.
\[
{\Gamma, a \tri b; \Delta, A_1[a], \ldots, A_n[a] \prov A[a]}
\]
goes to
\[
{\Gamma; \Delta, \bx(A_1\ox \cdots\ox A_n)[b] \prov \bx A[b]}
\]
Case two is eliminating $\dash \tri b$ where $b$ is the conclusion:
\[
{\Gamma, a \tri b; \Delta, A_1[b], \ldots, A_n[b] \prov A[b]}
\]
goes to
\[
{\Gamma; \Delta, \dia(A_1\ox \cdots\ox A_n)[a] \prov \dia A[a]}
\]
Case three is eliminating $\dash \tri b$ where $b$ is not the conclusion:
\[
{\Gamma, a \tri b; \Delta, A_1[b], \ldots, A_n[b] \prov A[c]}
\]
goes to
\[
{\Gamma; \Delta, \dia(A_1\ox \cdots\ox A_n)[a] \prov  A[c]}
\]
Case four is is eliminating $a \tri \dash$
where $a$ is not the conclusion --- but I don't know how to handle this case.
Can I rule it out? Does it arise organically?

Let me define a relation $\xto$ by these three cases:

\[
\Gamma, a, a \tri b; \Delta, A_1[a], \ldots, A_n[a] \prov A[a]
\xto
\Gamma; \Delta, \bx(A_1\ox \cdots\ox A_n)[b] \prov \bx A[b]
\]
%
\[
\Gamma, b, a \tri b; \Delta, A_1[b], \ldots, A_n[b] \prov A[b]
\xto
\Gamma; \Delta, \dia(A_1\ox \cdots\ox A_n)[a] \prov \dia A[a]
\]
%
\[\Gamma, b, a \tri b; \Delta, A_1[b], \ldots, A_n[b] \prov A[c]
\xto
\Gamma; \Delta, \dia(A_1\ox \cdots\ox A_n)[a] \prov  A[c]
\]
and conjecture that if $\Gamma;\Delta \prov A[w]$ and
$\Gamma;\Delta \prov A[w] \xto^* v;A[v] \prov B[v]$ then $A \le B$.

\subsection{Simpler Syntax}
\[
\begin{tabular}{r@{$\quad$}c@{$\quad::=\quad$ }l}
   Props&$A$&$ \dia B \celse A \ox A \celse 1 \celse a$\\
   Coprops&$B$&$ \bx A \celse B \oplus B \celse 0 \celse a^\perp$\\
\end{tabular}
\]
Define $A^\perp$ and $B^\perp$ by
\[ 1^\perp = 0 \qquad  0^\perp = 1\qquad (\dia B)^\perp = \bx (B^\perp) \qquad (\bx A)^\perp = \dia (A^\perp) \]
\[ (A_1 \ox A_2)^\perp = A_1^\perp \oplus A_2^\perp \qquad
(B_1 \oplus B_2)^\perp = B_1^\perp \ox B_2^\perp \qquad a^{\perp\perp} = a\]
Take as axioms
\[
\bx A_1 \ox \bx A_2 \le \bx (A_1 \ox A_2)
\qquad
1 \le \bx 1
\qquad
 \bx A \ox B \le \bx (A \ox \dia B)\]
and associativity/commutativity/unit laws
\[ (A_1 \ox A_2) \ox A_3 \equiv A_1 \ox (A_2 \ox A_3)  \qquad A_1 \ox A_2 \equiv A_2 \ox A_1
\qquad  A \ox 1 \equiv A\]
and reflexivity and transitivity
\[
\erule{}{
a \le a}
\qquad
\erule
{A_1 \le A_2 \qquad A_2 \le A_3}
{A_1 \le A_3}
\]
and congruences
\[
\erule
{A_1 \le A'_1 \qquad A_2 \le A'_2}
{A_1 \ox A_2 \le A'_1 \ox A'_2}
\qquad
\erule
{}
{1 \le 1}
\qquad
\erule
{B_2^\perp \le B_1^\perp  }
{\dia B_1 \le \dia B_2}
\]
\def\mod{\vDash}
\subsection{Even Simpler Syntax}
\[
\begin{tabular}{r@{$\quad$}c@{$\quad::=\quad$ }l}
   Propositions&$A, B, C$&$ \bx A \celse A \ox A \celse 1 \celse a$\\
\end{tabular}
\]
Define $A \mod B$ (with $\equiv$ meaning $\mod$ in both directions) by the axioms
\[
\bx A \ox \bx B \mod \bx (A \ox B)
\qquad
1 \mod \bx 1
\qquad
 \bx A \ox B \mod \bx (A \ox \bx B)\]
% and associativity/commutativity/unit laws
\[ (A \ox B) \ox C \equiv A \ox (B \ox C)  \qquad A \ox B \equiv B \ox A
\qquad  A \ox 1 \equiv A\]
% and reflexivity, transitivity, and congruences
\[
\erule{}{
a \mod a}
\qquad
\erule
{A \mod B \qquad B \mod C}
{A \mod C}
\qquad
\erule
{A \mod A' \qquad B \mod B'}
{A \ox B \mod A' \ox B'}
\qquad
\erule
{}
{1 \mod 1}
\qquad
\erule
{B \mod A }
{\bx A \mod \bx B}
\]

We can interpret this langauge into linear logic with
first-order quantifiers over a sort of `kripke worlds', and unrestricted assumptions of a binary relation $\tri$ on worlds.
We define two interpretation functions, $A^x$ and $A_y$, each of which takes a proposition and a world, and
returns a (linear, first-order) proposition.
\[ (\bx A)^x = \forall y . !(y \tri x) \multimap A_y \qquad (\bx A)_y = \exists x . !(y \tri x) \ox A_x  \]
\[ ( A\ox B)^x = A^x \ox B^x \qquad (A \ox B)_y = A_y \ox B_y \]
\[ 1^x = 1 \qquad 1_x = 1\]
\[ a^x = a(x) \qquad a_x = a(x)\]
\begin{conjecture}
$A^x \prov B^x$ if and only if $A \mod B$.
\end{conjecture}

\subsection{The Limit of Generality of World Trees}

\def\AA{\bm{\mathsf A}}
\def\BB{\bm{\mathsf B}}
I think I can characterize the variety of world structures one actually encounters while
carrying out proof search. Suppose we have world-sorts $b \tri a$, with
\[(\bx A) \wat b = \forall a .  (a\tri b) \imp (A \wat a)\]
\[(\dia B) \wat a = \exists b . (a \tri b) \land (B \wat b)\]
We define two classes of linear contexts (which tacitly depend on which worlds
are available) $\AA$ and $\BB$ by
\[
\erule
{}
{ \cdot \in \BB(b)}
\qquad
\erule
{}
{ \cdot \in \AA(a)}
\qquad
\erule
{\Delta \in \BB(b)}
{ \Delta, B[b] \in \BB(b)}
\]

\[
\erule
{\Delta \in \AA(a)}
{\Delta, A[a] \in \AA(a)}
\qquad
\erule
{\Delta \in \AA(a) \qquad \Delta' \in \BB(b) \qquad a \tri b}
{\Delta, \Delta' \in \AA(a)}
\]

\[
\erule
{\Delta \in \AA(a)}
{\Delta \in \AA^+(a)}
\qquad
\erule
{\Delta \in \AA(a) \qquad \Delta' \in \BB^+(b) \qquad a \tri b}
{\Delta, \Delta' \in \AA^+(a)}
\]

\[
\erule
{\Delta \in \BB(b)}
{\Delta \in \BB^+(b)}
\qquad
\erule
{\Delta \in \BB(b) \qquad \Delta' \in \AA^+(a) \qquad a \tri b}
{\Delta, \Delta' \in \BB^+(b)}
\]


\subsection{Refining This into Pseudo-Props}

\[
\erule
{}
{ \cdot \prov \BB[b]}
\qquad
\erule
{}
{ \cdot \prov \AA[a]}
\qquad
\erule
{\Delta \prov \BB[b]}
{ \Delta, B[b] \prov \BB[b]}
\]

\[
\erule
{\Delta \prov \AA[a]}
{\Delta, A[a] \prov \AA[a]}
\qquad
\erule
{\Delta \prov \AA[a] \qquad \Delta' \prov \BB[b] \qquad a \tri b}
{\Delta, \Delta' \prov \AA[a]}
\]

\[
\erule
{\Delta \prov \AA[a]}
{\Delta \prov \AA^+[a]}
\qquad
\erule
{\Delta \prov \AA[a] \qquad \Delta' \prov \BB^+[b] \qquad a \tri b}
{\Delta, \Delta' \prov \AA^+[a]}
\]

\[
\erule
{\Delta \prov \BB[b]}
{\Delta \prov \BB^+[b]}
\qquad
\erule
{\Delta \prov \BB[b] \qquad \Delta' \prov \AA^+[a] \qquad a \tri b}
{\Delta, \Delta' \prov \BB^+[b]}
\]
\section{A Puzzle about Hyperfunctions}
Suppose
\[L(T) = (T \to A) \to B\]
In some sense the hyperfunction type
\[(A \imp B) = (((\cdots \to A) \to B) \to A) \to B\]
resembles
\[ B + LB + L^2B + L^3 B\]
but I need to systematize how
\[ B \to LB \to L^2B \to L^3B \to \cdots\]
How about define
\[K(T : \star \to \star) = \Lambda \alpha . T((\alpha \to B) \to A)\]
\[\beta = \Lambda \alpha . \alpha \to B\]
for which we have
\[K \beta = \Lambda \alpha . ((\alpha \to B) \to A) \to B\]
\[K^2 \beta = \Lambda \alpha . ((((\alpha \to B) \to A) \to B) \to A) \to B\]
So definitely $f$ is a contravariant functor:
if $f : C \to D$ then $\beta f : \beta D \to \beta C$.
Moreover $K$ preserves the property of being a contravariant functor.
So we get in general a map
$(K^n \beta)(1) \to (K^{n+1} \beta)(1)$ because
\[(K^n \beta)(1) \to (K^{n+1} \beta)(1)
= (K^n \beta)(1) \to (K K^n\beta)(1) \]
\[= (K^n \beta)(1) \to (\Lambda \alpha . (K^n \beta)((\alpha \to B) \to A))(1) \]
\[= (K^n \beta)(1) \to  (K^n \beta)((1 \to B) \to A) \]
and there's a unique map $((1 \to B) \to A) \to 1$.

\subsection{Isomorphism?}
So let's say I have an element of
\[H_{AB} = \sum_{i = 0} L_{AB}^i B \]
where
\[L_{AB}(T) = (T \to A) \to B\]
How close do I get to an isomorphism $H_{AB} \cong H_{BA} \to B$?
Let me just write $H$ for $H_{AB}$ and $\bar H$ for $H_{BA}$.

I just reasoned above that I do have canonical morphisms
\[\begin{tikzcd}
  B \ar[r, "\ell_0"] & LB \ar[r, "\ell_1"] & L^2 B\ar[r, "\ell_2"] & \cdots
\end{tikzcd}\]
So let's say I'm given
\[h_1 \in H = B + (B \to A) \to B + (((B \to A) \to B) \to A) \to B + \cdots \]
\[h_2 \in \bar H = A + (A \to B) \to A + (((A \to B) \to A) \to B) \to A + \cdots \]
Surely I can get a $B$ out of this pair. I know I can push elements of either of these to the right.
I just want to show that I can do
\[L^{n+1}_{AB}(B) \x L^n_{BA}(A) \to B\]
Ok let's write $[ A B C ]$ for $((1 \to A) \to B) \to C$, i.e.
\[ [] = 1 \qquad [\vec A A ] = [\vec A] \to A\]
in which case I'm trying to show
\[ [B] + [BAB] + [BABAB] + \cdots = ([A] + [ABA] + [ABABA] + \cdots) \to B \]

\section{Thinking about Logic in General}

Remember that we represent some structured sequent
\[ A, B \prov C\]
as
\[   A[\alpha], B[\beta], C[\phi]  \prov \alpha * \beta \tri \phi \]
The symbol $\tri$ is really getting at some kind of heteromorphism
homset --- it's always worlds on the left, frames on the right. The
types of $\alpha * \beta$ and $\phi$ must match up somehow though,
along any dimensions of syntactic variation orthogonal to the
world-frame axis. Licata/Shulman/Riley considers
 multicategory morphisms.

But I could imagine $\alpha$ itself comes from some homset $X \to Y$
and $\beta$ comes from $Y \to Z$, and $\phi$ from an abstract frame homset $X \to Z$
and in that case I'm considering (if I fully annotate props and annotations with boundaries)
\[   A_{XY}[\alpha_{X Y}], B_{YZ}[\beta_{YZ}], C_{XZ}[\phi_{XZ}]  \prov \beta_{YZ} \o \alpha_{XY} \tri \phi_{XZ} \]
or more cleanly without annotations I mean just
\[   A[\alpha], B[\beta], C[\phi]  \prov \beta \o \alpha \tri \phi \]
and this could have come from
\[   (B \bullet A)[\alpha'], C[\phi_{XZ}]  \prov  \alpha' \tri \phi \]
where
\[
\erule
{A : \mathsf{prop}^+(X, Y) \qquad B : \mathsf{prop}^+(Y, Z)}
{B \bullet A : \mathsf{prop}^+(X, Z)}
\]
\[ (B \bullet A) [\alpha'] = \exists (\alpha:\mathsf{w}^+(X, Y))  (\beta: \mathsf{w}^+(Y, Z)) . (\beta \o \alpha) \le \alpha' \land B[\beta] \land A[\alpha]\]
or it could have equally well come from a sequent like
\def\rto{\twoheadrightarrow}
\def\lto{\rightarrowtail}
\def\st{\mathrel|}
\[   A[\alpha],  B \rto C[\phi']  \prov   \alpha \tri \phi' \]
where
\[
\erule
{B : \mathsf{prop}^+(Y, Z) \qquad C : \mathsf{prop}^-(X, Z)}
{B \rto C : \mathsf{prop}^-(X, Y)}
\]
\[ (B \rto C) [\phi'] = \exists (\beta:\mathsf{w}^+(Y, Z))  (\phi: \mathsf{w}^-(X, Z)) . (\beta \rto \phi) \le \phi' \land B[\beta] \land C[\phi]\]
and we would expect something like
\[ \beta \o \alpha \tri \phi \equiv \alpha \tri \beta \rto \phi \]

How can I generalize this a bit? Suppose I have a set of sorts $\sigma_1, \sigma_2, \rho,$ etc.
An example of a $\sigma$ from what I've described above is like a pair $(X, Y)$. I think they come in
positive and negative versions.
If I have an algebraic operation $\bullet$ that makes a $\sigma$ out of a $\sigma_1, \sigma_2$, then I should have
\[
\erule
{A_1 : \mathsf{prop}^+(\sigma_1) \qquad A_2 : \mathsf{prop}^+(\sigma_2)}
{A_1 \bullet A_2 : \mathsf{prop}^+(\sigma)}
\]

\[
\erule
{A : \mathsf{prop}^+(\sigma_2) \qquad B : \mathsf{prop}^-(\sigma)}
{A \rto B : \mathsf{prop}^-(\sigma_1)}
\]

\[
\erule
{A : \mathsf{prop}^+(\sigma_1) \qquad B : \mathsf{prop}^-(\sigma)}
{A \lto B : \mathsf{prop}^-(\sigma_2)}
\]

How would this work with $n$-ary operations?
Let me imagine binary $\bullet_L$ that takes $\sigma_1$ and $\sigma_2$ to $\sigma_L$
and $\bullet_R$ which takes $\sigma_L$ and $\sigma_3$ to $\sigma$.

We would get out the rules
\[
\erule
{A_1 : \sigma_1 \qquad A_2 : \sigma_2}
{A_1 \bullet_L A_2 : \sigma_L}
\qquad
\erule
{A_L : \sigma_L \qquad A_3 : \sigma_3}
{A_L \bullet_R A_3 : \sigma}
\]

\[
\erule
{A : \sigma_2 \qquad B : \sigma_L}
{A \rto_L B : \sigma_1}
\qquad
\erule
{A : \sigma_3 \qquad B : \sigma}
{A \rto_R B : \sigma_L}
\]

\[
\erule
{A : \sigma_1 \qquad B : \sigma_L}
{A \lto_L B : \sigma_2}
\qquad
\erule
{A : \sigma_L \qquad B : \sigma}
{A \lto_R B : \sigma_3}
\]
From which we can make the compound rules
\[
\erule
{A_1 : \sigma_1 \qquad A_2 : \sigma_2 \qquad A_3 : \sigma_3}
{A_1 \bullet_L A_2 \bullet_R A_3 : \sigma}
\]

\[
\erule
{A_2 : \sigma_2 \qquad \[ A_3 : \sigma_3 \qquad B : \sigma \justifies A_3 \rto_R B : \sigma_L\]}
{A_2 \rto_L A_3 \rto_R B : \sigma_1}
\]

\[
\erule
{A_1 : \sigma_1 \qquad \[ A_3 : \sigma_3 \qquad B : \sigma \justifies A_3 \rto_R B : \sigma_L\]}
{A_1 \lto_L A_3 \rto_R B : \sigma_2}
\]

\[
\erule
{\[A_1 :  \sigma_1 \qquad A_2 :  \sigma_2
 \justifies A_1 \bullet A_2 : \sigma_L\] \qquad B : \sigma}
{A_1 \bullet A_2 \lto_R B : \sigma_3}
\]

Ok, so the generalization I want is clear. Suppose
I have sorts $\sigma_1, \ldots, \sigma_n$ and some
operation $\bullet : \sigma_1 \x \cdots \x \sigma_n \to \sigma$. Then I should have
some propositional operations
\[
\erule
{A_i : \sigma_i^+}
{\bullet(\vec A) : \sigma^+}
\qquad
\erule
{A_i : \sigma_i^+ \qquad (i \ne j) \qquad B : \sigma^-}
{{\to}([B/j]\vec A) : \sigma_j^-}
\]
and I think the adjointness relationship I expect between these is
\[ \bullet(\vec A) \tri_\sigma B \equiv A_j  \tri_{\sigma_j} {\to}([B/j]\vec A) \]
where $\tri_\sigma$ is the relation that takes a $\sigma^+$ and a $\sigma^-$ and yields a proposition.

\subsection{An Example}

Here's an example: there are four sorts, $00$, $01$, $10$, and $11$.
There are composition operators on worlds/frames:
\[\{ \bullet_{abc} : ab^+ \x bc^+ \to ac^+\st a,b,c\in\{0,1\}\} \]
\[\{ \rto_{abc} : ac^- \x bc^+ \to ab^- \st a,b,c\in\{0,1\}\} \]
\[\{ \lto_{abc} : ab^+ \x ac^- \to bc^-\st a,b,c\in\{0,1\}\} \]
with like
\[
\erule{\alpha : ab^+ \qquad \beta : bc^+ \qquad \phi : ac^-}
{ (\alpha \bullet \beta \tri \phi)  = (\alpha \tri \beta \rto \phi) = (\beta \tri \alpha \lto \phi) }\]
and there are four constants
\[\{ m_{ab} : () \to ab \st a,b \in \{0,1\}\} \]
and maybe I have `2-cells' to witness
\[ m_{00} \imp m_{01} \bullet m_{10} \]
\[   m_{10} \bullet m_{01} \imp m_{11}\]
or maybe I can just say
\[   m_{a0} \bullet m_{0b} \imp m_{a1} \bullet m_{1b}\]
because in any event I have identity laws
\[
  \erule{\alpha : a0}{\alpha \bullet m_{00} = \alpha}\qquad
  \erule{\alpha : 0a}{m_{00} \bullet \alpha = \alpha}\qquad
  \erule{\alpha : a1}{\alpha \bullet m_{11} = \alpha}\qquad
  \erule{\alpha : 1a}{m_{11} \bullet \alpha = \alpha}
\]
I think this ends up creating a sort of ordered logic where propositions
can live over 00, 01, 10, 11, and there are some joins that are allowed.

\subsection{Higher Adjunctions}

Can I clearly describe the `walking higher adjunction'?
Let me start with the walking higher equivalence, since the adjunction should be a subset of that.
How many objects are there? Up to equivalence, two, call them $C, D$.
How many morphisms are there in each homset? Essentially, one. There's $\rid_C$ and $\rid_D$ in the
homogeneous homsets, and let's call them $F: C \to D$ and $U : D \to C$ elsewhere.
As we go up in dimensions, we'll always get exactly one cell in each homset --- that's the contractibility
that being an equivalence implies.

But if we have an equivalence up to 1-dimensional cells --- we have
$C, D, F, U$ --- but we want an adjunction above that, we find that we have
$\eta : \rid_{C} \to UF$ and $\epsilon : FU \to \rid_{D}$, and not any converses
to them. And in fact prior to that, we should point out that $FU$ is now {\em distinct} from $\rid_D$.
The `size' of the homset $D \to D$ (considered up to equivalence) got bigger because we {\em removed} cells that would
have constituted an equivalence. It's now infinitely big:
\[ \hom(D, D) = \{(FU)^n \st n \in \N\}\]
\[ \hom(C, C) = \{(UF)^n \st n \in \N\}\]
\[ \hom(C, D) = \{F(UF)^n \st n \in \N\}\]
\[ \hom(D, C) = \{U(FU)^n \st n \in \N\}\]

\section{Returning to a Proof}

Remember the syntax of ``blob logic'' is
\[
\begin{tabular}{r@{$\quad$}c@{$\quad::=\quad$ }l}
   Polarities&$i$&$0 \celse 1$\\
   Propositions&$P^i$&$1^i \celse P^i \ox^i P^i\celse \bigcirc^i P^{\bar i} \celse a^i $\\
\end{tabular}
\]
where I write as abbreviations $\dia = \bigcirc^0$ and $\bx = \bigcirc^1$,
and I'll write $A$ for $P^0$ and $B$ for $P^1$. We'll drop superscripts when they're
inferrable from context.

The translation into first-order linear logic requires two syntactic classes of worlds
$u^i$ and (we write $v$ for $u^0$ and $w$ for $u^1$), and a relation $v \tri w$, and goes like
\[ (\bx A) \wat w = \forall v . !(v\tri w) \lol (A \wat v) \]
\[ (\dia B) \wat v = \exists w.  !(v \tri w)  \ox (B  \wat w) \]
\[ (P_1 \ox P_2) \wat u = (P_1 \wat u) \ox (P_2 \wat u) \]
\[ 1 \wat u = 1 \]
\[ a \wat u = a(u) \]

And a pair of preorders on propositions of the same polarity can
be given inductively by the rules
(writing $\equiv$ for when $\le$ and $\ge$ both hold)

\[
\bx A_1 \ox \bx A_2 \le \bx (A_1 \ox A_2)
\qquad
1 \le \bx 1
\qquad  \dia \bx A \le A
\]
\[
\dia (B_2 \ox B_2) \le \dia B_1 \ox \dia B_2
\qquad
\dia 1 \le 1
\qquad  B \le \bx  \dia B
\]
\[ P \ox 1 \equiv P \qquad
P_1 \ox P_2 \equiv P_2 \ox P_1
\qquad
\erule
{P_1 \le Q_1 \qquad P_2 \le Q_2}
{P_1 \ox P_2 \le Q_1 \ox Q_2}
\]
\[ (P_1 \ox P_2) \ox P_3 \equiv P_1 \ox (P_2 \ox P_3)
\qquad
\erule
{P \le Q}
{\bigcirc P \le \bigcirc Q}
\]
closing under reflexivity and transitivity.

\begin{lemma}
If $P \le Q$, then $P \wat u \prov Q \wat u$.
\end{lemma}

\begin{proof}
We need only show this holds for all the axioms of $\le$, the rest follows by cut.
For example, $B \le \bx \dia B$ becomes (assuming
we make the abbreivations $P \imp Q = {!}P \lol Q$ and $P \land Q = {!}P \ox Q$)
\[ B \wat w \prov \bx \dia B \wat w\]
\[ B \wat w \prov \forall v . v\tri w \imp  \exists w' . v \tri w' \land  B \wat w'\]
which can be proven

\[
\erule
{
\[
\[
\justifies
v\tri w; B \wat w \prov B \wat w
\]
\justifies
v\tri w; B \wat w \prov   \exists w' . v \tri w' \land  B \wat w'\]
}
{ B \wat w \prov \forall v . v\tri w \imp  \exists w' . v \tri w' \land  B \wat w'}\]
\cqed
\end{proof}

To prove the converse, we need to generalize a little. I'm going to slip back into
some notation that makes the modality more baked into the judgment. Something like
\[
\begin{tabular}{r@{$\quad$}c@{$\quad::=\quad$ }l}
   Unrestricted Contexts&$\Gamma$&$\cdot\celse \Gamma, v \tri w$\\
   Linear Context&$\Delta$&$\cdot\celse \Delta, P^i[u^i]$\\
\end{tabular}
\]
with rules
\[
\erule{}{\Gamma;a[u] \prov a[u]}
\]
\[
\erule{\Gamma; \Delta_1 \prov P_1[u] \qquad \Gamma;\Delta_2\prov P_2[u]}{\Gamma;\Delta_1, \Delta_2 \prov P_1 \ox P_2[u]}
\qquad
\erule{\Gamma; \Delta, P[u], Q[u] \prov J}{\Gamma; \Delta, P\ox Q[u] \prov J}
\]
\[
\erule{}{\Gamma;\cdot \prov 1[u]}
\qquad
\erule{\Gamma; \Delta \prov J}{\Gamma; \Delta, 1[u] \prov J}
\]
\[
\erule{\Gamma, v\tri w;\Delta \prov  A[v]}{\Gamma;\Delta \prov \bx A[w]}
\qquad
\erule{v\tri w \in \Gamma \qquad \Gamma;\Delta, A[v] \prov  J}{\Gamma;\Delta, \bx A[w] \prov J}
\]
\[
\erule{ v\tri w \in \Gamma  \qquad \Gamma;\Delta \prov   B[w]}{\Gamma;\Delta  \prov \dia B[v]}
\qquad
\erule{\Gamma, v\tri w;\Delta, B[w] \prov J}{\Gamma;\Delta,\dia B[v] \prov  J}
\]
 From $\Gamma;\Delta$ an unrestricted and
linear context together, and a choice of world for the root,
we can construct a unique proposition, or at least unique up to $\equiv$.
Call this $(\Gamma;\Delta)^u$. For example,
\[(v \tri w, v \tri w', v' \tri w'; A_1[v], A_2[v], B[w], B'[w'], A'[v'] )^v = \]
\[ A_1 \ox A_2 \ox \dia B \ox \dia (B' \ox \bx A') \]

Then I think my claim is
\begin{lemma}
If  $\Gamma;\Delta_j \prov P_j[u_j]$ for every $j \in \{1,\ldots,n\}$, and $u\in\Gamma$, then
\[ (\Gamma; \Delta_1, \ldots, \Delta_n)^u \le (\Gamma;P_1[u_1],\ldots,P_n[u_n])^u \]
\end{lemma}

\begin{proof}
By induction on the list of derivations $\Gamma;\Delta_j \prov P_j[u_j]$.

If we need to peel off a terminal proof using the init rule, it's easy:
appeal to the induction hypothesis, and tack on the variable to both sides of the tree.

The tensor (and 1) rules are extremely easy, they just shuffle around
the shape of the same proof obligation.

The $\bx$ and $\dia$ asynchronous rules are similarly easy. They don't actually affect
the tree shape, but just rename parts of it.

The $\bx$ and $\dia$ synchronous rules are where the real core of the proof is.
\cqed
\end{proof}

\begin{corollary}
If  $u ;P[u] \prov Q[u]$, then $P \le Q$.
\end{corollary}





\end{document}
