\documentclass{article}
\usepackage[tmargin=0.05in, bmargin=0.05in]{geometry}
\input{theorem}
\input{prooftree}
\usepackage{stmaryrd}
\usepackage{latexsym}
\usepackage{yfonts}
\usepackage{amsmath}
\usepackage[usenames,dvipsnames,svgnames,table]{xcolor}
\usepackage{tikz}
\usetikzlibrary{calc,arrows,cd,decorations.pathreplacing}
\usetikzlibrary{decorations.pathmorphing}
\usepackage{tcolorbox}
\tcbuselibrary{breakable}
\usepackage{listings}
\lstset{basicstyle=\ttfamily\footnotesize,breaklines=true}

\def\gol{\sqsubset}
\def\gor{\sqsupset}

\def\sp{\bullet}
\def\ot{\leftarrow}
\def\prequiv{\dashv\vdash}
\def\fdom{{\mathbf{d}f}}
\def\fcod{{\mathbf{e}f}}
\def\fidom{\mathbf{\bar d}f}
\def\ficod{\mathbf{\bar e}f}

\def\thn{\mathrel|}
\def\coe{\mathsf{coe}}
\def\bpush{\mathbf{push}}
\def\bpull{\mathbf{pull}}

\def\wo{\setminus}
\def\fA{\mathsf{A}}
\def\fC{\mathsf{C}}
\def\fX{\mathsf{X}}
\def\ff{\mathsf{f}}
\def\fm{\mathsf{m}}
\def\rspan{\mathsf{Span}}
% \def\El#1{\mathsf{El}({#1})}
\def\El#1{\ulcorner{#1}\urcorner}
\def\U{\mathsf{U}}
\def\uu{\mathsf{u}}
\def\uni{\U}
\def\mor#1#2{#1 \to \underline{#2}}

\def\ridp{\mathsf{idp}}
\def\ssem#1{\langle\!\langle{#1}\rangle\!\rangle}

\definecolor{lred}{rgb}{0.95,0.8,0.8}
\definecolor{cyan}{rgb}{0.80,0.95,0.95}
\definecolor{orange}{rgb}{0.95,0.90,0.80}
\definecolor{bluegray}{rgb}{0.6,0.6,0.85}
\definecolor{lgray}{gray}{0.9}
\newtcolorbox{declbox}{colframe=lred,colback=lred,grow to right by=-10mm,grow to left by=-10mm,
boxrule=0pt,boxsep=0pt,breakable}
\newtcolorbox{thmbox}{colframe=cyan,colback=cyan,grow to right by=-10mm,grow to left by=-10mm,
boxrule=0pt,boxsep=0pt,breakable}
\newtcolorbox{defnbox}{colframe=orange,colback=orange,grow to right by=-10mm,grow to left by=-10mm,
boxrule=0pt,boxsep=0pt,breakable}
\newtcolorbox{tangentbox}{colframe=lgray,colback=lgray,grow to right by=-10mm,grow to left by=-10mm,
boxrule=0pt,boxsep=0pt,breakable}

\input{linear}
\def\rpath#1{[#1]}
\def\rfst{\mathsf{fst}\,}
\def\rsnd{\mathsf{snd}\,}
\def\bunfold{\mathbf{unfold}}
\def\bfold{\mathbf{fold}}
\def\susp#1{\langle {#1} \rangle}
\def\ssusp#1{\langle\!\langle {#1} \rangle\!\rangle}
\def\dto{\mathrel{\dot\to}}
\def\dns{{\downarrow}}
\def\ups{{\uparrow}}
\def\sprov{\Vdash}
\def\signat{{\color{red}\Sigma}}
\def\ep#1{\underline{#1}}
\def\wat{\mathbin{@}}
\def\wwat{\mathbin{\underline\wat}}
\def\cn{{:}}
\def\dv{{\div}}
\def\ww{{\mathsf w}}
\def\base{{\textfrak b}}

\def\munit{I}
\def\tt{{\mathsf t}}
\def\ii{{\mathbb I}}
\def\T{\mathbb{T}}
\def\TP{\mathbf{TPre}}
\def\pp{\textsf{\textbf p}}
\def\nn{{\mathsf n}}
\def\PP{\textsf{\textbf P}}
\def\NN{\textsf{\textbf N}}
\def\zz{{\mathsf z}}
\def\sem#1{[\![#1]\!]}
\def\usem#1{\lceil\!\!\lceil{#1}\rceil\!\!\rceil}
\def\zem#1{\langle\!\langle#1\rangle\!\rangle}
\def\col#1{{\mathsf{C}}_{#1}}
\def\lax{\mathop\bigcirc}
\def\rjust{\mathsf{just}}
\def\rcvt{\mathsf{cvt}}
\def\rtype{\mathsf{type}}
\def\rdtype{\mathsf{disc}}
\def\rkind{\mathsf{kind}}
\def\rmode{\mathsf{mode}}
\def\rprel{\mathbf{Prel}}
\def\rrfam{\mathbf{Rfam}}
\def\rset{\mathbf{Set}}
\def\rfinset{\mathbf{FinSet}}
\def\rrel{\mathbf{Rel}}
\def\rcat{\mathbf{Cat}}
\def\rfam{\mathbf{Fam}}
\def\binj{\mathbf{inj}}
\def\rid{\mathsf{id}}
\def\rtrue{\mathrel\mathrm{true}}
\def\pbck{\ar[dr, phantom, pos=0, "\lrcorner"]}
\def\bpbck{\ar[ddrr, phantom, pos=0, "\lrcorner"]}
\def\erule#1#2{\begin{prooftree}#1\justifies #2\end{prooftree}}
\def\lpar{\bindnasrepma}
\def\lamp{\binampersand}
\def\btwo{\mathbf{2}}
\def\bone{\mathbf{1}}

\newarrow {Equiv} =====
\def\FinSet{\mathbf{FinSet}}
\def\x{\times}
\def\maps{\ar[dd,mapsto,shorten <=2em, shorten >=2em]}
\def\mapt{\ar[ddd,mapsto,shorten <=2em, shorten >=2em]}
\def\frommaps{\ar[from=uu,mapsto,shorten <=2em, shorten >=2em, crossing over]}
\def\frommapt{\ar[from=uuu,mapsto,shorten <=2em, shorten >=2em, crossing over]}
\def\C{\mathbf{C}}
\def\G{\mathbf{G}}
\def\D{\mathbf{D}}
\def\DD{\mathbb{D}}
\def\E{\mathbf{E}}
\def\M{\mathbf{M}}
\def\pair#1#2{\langle#1,#2\rangle}
\def\ltri{{\lhd}}
\def\rtri{{\rhd}}
\def\tri{\rhd}
\def\ll{{<}}
\def\rr{{>}}
\def\cc{\mathsf{c}}
\def\dd{\mathsf{d}}
\def\o{\circ}
\def\rctx{\,\mathsf{ctx}}
\def\rdctx{\,\mathsf{dctx}}
\def\del{\partial}
\def\also#1{\ \textcolor{blue}{\celse #1}}
\newcounter{nodemaker}
\setcounter{nodemaker}{0}
\def\twocell#1#2{%
  \global\edef\mynodeone{twocell\arabic{nodemaker}}%
  \stepcounter{nodemaker}%
  \global\edef\mynodetwo{twocell\arabic{nodemaker}}%
  \stepcounter{nodemaker}%
  \ar[#1,phantom,shift left=3,""{name=\mynodeone}]%
  \ar[#1,phantom,shift right=3,""'{name=\mynodetwo}]%
  \ar[Rightarrow,#2,from=\mynodeone,to=\mynodetwo]%
}
\def\twocellswap#1#2{%
  \global\edef\mynodeone{twocell\arabic{nodemaker}}%
  \stepcounter{nodemaker}%
  \global\edef\mynodetwo{twocell\arabic{nodemaker}}%
  \stepcounter{nodemaker}%
  \ar[#1,phantom,shift right=3,""{name=\mynodeone}]%
  \ar[#1,phantom,shift left=3,""'{name=\mynodetwo}]%
  \ar[Rightarrow,#2,from=\mynodeone,to=\mynodetwo]%
}
\def\maps{\ar[dd,mapsto,shorten <=2em, shorten >=2em]}
\author{Jason Reed}
\definecolor{fib}{HTML}{ff7f00}
\definecolor{green}{HTML}{007f00}
\definecolor{red}{HTML}{df3f3f}
\definecolor{opfib}{HTML}{007fff}

% For lightening colors I used
% http://trycolors.com/ 6 parts white to 1 part color
\definecolor{opfibl}{HTML}{DBEDFF}
\definecolor{greenl}{HTML}{DBEDDB}
\definecolor{redl}{HTML}{FAE4E4}
\def\njudge#1{\fcolorbox{opfib}{white}{#1}}
\def\nrule#1{\fcolorbox{white}{opfibl}{#1}}
\def\neqn#1{\fcolorbox{white}{redl}{#1}}



\def\judge#1{\vskip 2em\noindent \njudge{$#1$}\vskip 0.5em\noindent}
\def\rule#1{\vskip 2em \noindent \nrule{$#1$}\vskip 0.5em\noindent}
\def\eqn#1{\vskip 2em \noindent \neqn{$#1$}\vskip 0.5em\noindent}
\def\prof{\nrightarrow}
\def\tensor{\otimes}
\def\htensor{\mathrel{\hat\otimes}}
\def\lol{\multimap}
\def\hlol{\mathrel{\hat\multimap}}
\def\wtf{{\color{red}???}}

\def\re{\mathbf{E}}
\def\sh{\sharp}
\def\shp{\mathrel{\sharp}}
\def\zero{\texttt{0}}
\begin{document}

\def\
\tikzset{
   commutative diagrams/.cd,
   arrow style=tikz,
   diagrams={>=stealth}}

\section{Thinking About A Small Example}

Let's just do some ordinary category theory about the case where
I have just a single-arrow category $f : 0 \to 1$. Then transport
looks like
\[
\begin{tikzcd}
A_{01} \arrow[r, "0f"] \arrow[d, "f1"'] & A_{00} \arrow[d, "f0"] \\
A_{11} \arrow[r, "1f"'] & A_{10}
\end{tikzcd}
\]
where $A : \C \x \C^\op \to \rset$. The type $A \to B$ has object
part $(A \to B)_\delta = A_{\bar\delta} \to B_\delta$ so that transport works at all.
A closed term at a type is a natural transformation from the hom-type
\[
\begin{tikzcd}
0 \arrow[r] \arrow[d] & 1 \arrow[d] \\
1 \arrow[r] & 1
\end{tikzcd}
\]
Products should work pointwise, I should think? Then surely $A \x 1 = A$.
Do I also get that $1 \imp A = A$? Sure. $1_{\bar \delta} \to A_{\delta}$ is still
$A_{\delta}$. But {\em morphisms} from the hom-type are something else.
$H_{\bar\delta} \to A_\delta$ means that we take everything at $A_{10}$ and replace
it with a single unique point. So some kind of non-truthvalue-centric modality?

Consider the type $A \to A$. We can make a term of it by
taking the identity functions  $A_{00} \to A_{00}$ and $A_{11} \to A_{11}$,
and observing that their common transport to $A_{01} \to A_{10}$ is just
either trip around the transport diamond of $A$ itself.

Consider the composition type $(A \to B) \to (B \to C) \to A \to C$.
We can pick
\[(A_{00} \to B_{00}) \to (B_{00} \to C_{00}) \to A_{00} \to C_{00}\]
\[(A_{11} \to B_{11}) \to (B_{11} \to C_{11}) \to A_{11} \to C_{11}\]
to be actual composition, and then from these we derive
\[(A_{10} \to B_{01}) \to (B_{10} \to C_{01}) \to A_{01} \to C_{10}\]
In which an element from $A_{01}$ is transported down (in one of two
equivalent ways) to $A_{10}$, lifted back up to $B_{01}$ by the first
argument, transported back down to $B_{10}$ (in one of two
equivalent ways) lifted back up to $C_{01}$ by the second argument,
then finally transported down to $C_{10}$ (in one of two
equivalent ways). So yeah, composition is definable as a term.

\subsection{Some more generality}

Let's say we have a category $\C$ with an involutive contravariant endofunctor
$\star : \C^\op \to \C$. We aim to define a sort of `twisted presheaf' with
respect to $\star$. The objects of the putative category of twisted presheaves
is just functors $\C \to \rset$, but the morphisms will be nonstandard.

We can define $F \imp G$ to be the objectwise function space from $F \o \star$ to $G$.
That is, for any $C, D$, and $f : C \to D$, we have
\[(F \imp G)_C = F_{\star C} \to G_C\]
and
\[(F \imp G)_f = \lambda h : F_{\star C} \to G_C . \lambda d : F_{\star D} . G_f (h (F_{\star f} d))\]

We want something to play the role of the homfunctor $H : \C \to \C^\op \to \rset$
so that we can say a morphism $F \to G : \TP$ is a natural tranformation
$\rset^\C[H , F \imp G]$.

\subsection{Wait a minute What about composition}

Forget about the generality above for now, go back to the concrete case where I am
talking about $\C^\op \x \C$, not some general case where I have a category-
with-involution. It looks like I can't define normal things like application
or composition across several closed terms, even though I can make closed
terms with fairly rich behavior when application or composition is internalized!
So maybe this is a place where I can see how I need to generalize what a term is,
to get a better-situated induction hypothesis.

Let me expand on what I just said with examples: There is always a closed
term $(A \to B) \to (B \to C) \to A \to C$, as I described farther above.
Even more simply, there is always a closed term at $A \to (A \to B) \to B$.
For I say
\[t_0 : A_{00} \to (A_{00} \to B_{00}) \to B_{00}\]
\[t_1 : A_{11} \to (A_{11} \to B_{11}) \to B_{11}\]
are the application functions at each individual type, and observe that transport
along $f : 0 \to 1$
to
\[A_{01} \to (A_{10} \to B_{01}) \to B_{10}\]
which gives me either
(repeatedly using
$ (A \to B)_{\phi}(h) = \lambda x . B_{\phi} ( h(A_{\bar\phi} x))$)
\[ (A \to (A \to B) \to B)_{f0}(t_0) = \lambda a . ((A \to B) \to B)_{f0} ( t_0(A_{0f} a)) \]
\[= \lambda a . ((A \to B) \to B)_{f0} ( t_0(A_{0f} a)) \]
\[= \lambda a g . B_{f0} ( t_0(A_{0f} a, (A \to B)_{0f} g)) \]
\[= \lambda a g . B_{f0} ( t_0(A_{0f} a, \lambda x . B_{0f} ( g(A_{f0} x))))\]
\[= \lambda a g . B_{f0} (  B_{0f} ( g(A_{f0} A_{0f} a))))\]
\[= \lambda a g . B_{ff} ( g(A_{ff} a))\]
or symmetrically
\[ (A \to (A \to B) \to B)_{1f}(t_1) = \lambda a g . B_{ff} ( g(A_{ff} a))\]

However, suppose I have a closed term $M : A$ and $N : A \to B$.
This means I have all of
\[M_0 : A_{00} \qquad N_0 : A_{00} \to B_{00}\]
\[M_1 : A_{11} \qquad N_1 : A_{11} \to B_{11}\]
\[A_{f0} M_0 = A_{1f} M_1 \qquad
\forall x : A_{01} . B_{f0} ( N_0(A_{0f} x)) = B_{1f} ( N_0(A_{f1} x))\]
So I can make the raw data of a term $L = N M : B$ via
\[L_0 : B_{00} = N_0\ M_0 \qquad L_1 : B_{11} = N_1\ M_1\]
But I don't seem to be able to prove
\[B_{f0} (N_0(M_0)) = B_{1f} (N_1(M_1))\]
Because, on one side of the symmetric coin, $M_0$ is not of the form $A_{f0}$ of something.

Here's a na\"ive conjecture I hope I can refute: that we can get away with thinking
of terms as global sections, which is to say, a term of $A$ is just
picking out an element of $A_{01}$. For is there even an element of
\[(A_{01} \to B_{10}) \to (B_{01} \to C_{10}) \to A_{10} \to C_{01}\]
? It doesn't seem like it! I wouldn't know how to get from $B_{10}$ to $B_{01}$!
So that's a good signal that something interestingly
nontrivial is going on here, but I still don't
know what.

\subsubsection{A Guess}

What if I try to deliberately move away from the closedness of terms, by
saying: a term of type $A$ is a choice, for every type $\Gamma$, of
a closed term of the function type $\Gamma \to A$. Then can I prove
something like cut/substitution? I'd have $\Gamma \to A$ and
$\Gamma \to A \to B$ for every $\Gamma$. I want to prove $\Gamma \to B$
for every $\Gamma$. Is there a clever {\em choice} of $\Gamma$ for
the premises derived from the universal $\Gamma$ in my conclusion?
Hmm, don't see how. Any use of existentially quantifying over the $\Gamma$s?
Nah, that makes a term at every type.

\subsubsection{End Formulation}

The thing I failed to check is simply that if I have

\[M \in \int_{c \in \C} A_{cc} \to B_{cc} \qquad
N \in \int_{c \in \C} A_{cc}\]

it isn't obvious how to get

\[M\ N \in \int_{c \in \C} B_{cc}\]

Because the object part is easy; $(M\ N)_c = M_c\ N_c$.
But I need to check that $B_{fc} (M\ N)_c = B_{df} (M\ N)_d$,
that is, $B_{fc} (M_c\ N_c) = B_{df} (M_d\ N_d)$.
What I know is that $A_{fc} N_c = A_{df} N_d$
and $(A \to B)_{fc} M_c = (A \to B)_{df} M_d$, the latter which means
\[B_{fc} (M_c(A_{cf} x)) = B_{df} (M_d(A_{fd} x))\]
\end{document}
