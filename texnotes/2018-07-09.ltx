\documentclass{article}
\usepackage[tmargin=0.05in, bmargin=0.05in]{geometry}
\input{theorem}
\input{prooftree}
\usepackage{relsize}
\usepackage{stmaryrd}
\usepackage{latexsym}
\usepackage{yfonts}
\usepackage{amsmath}
\usepackage[usenames,dvipsnames,svgnames,table]{xcolor}
\usepackage{tikz}
\usetikzlibrary{calc,arrows,cd,decorations.pathreplacing}
\usetikzlibrary{decorations.pathmorphing}
\usepackage{tcolorbox}
\tcbuselibrary{breakable}
\usepackage{listings}
\lstset{basicstyle=\ttfamily\footnotesize,breaklines=true}


\def\isopen{\textcolor{orange}{\mathlarger{\mathlarger{\mathlarger{\textbf ?}}}}}
\def\isok{\textcolor{green}{\mathlarger{\mathlarger{\mathlarger{\checkmark}}}}}
\def\isbad{\textcolor{red}{\mathlarger{\mathlarger{\mathlarger{\x}}}}}
\def\chave{\eqno \textcolor{blue}{\hbox{have}}}
\def\cwant{\eqno \textcolor{orange}{\hbox{want}}}
\def\gol{\sqsubset}
\def\gor{\sqsupset}

\def\sp{\bullet}
\def\ot{\leftarrow}
\def\prequiv{\dashv\vdash}
\def\fdom{{\mathbf{d}f}}
\def\fcod{{\mathbf{e}f}}
\def\fidom{\mathbf{\bar d}f}
\def\ficod{\mathbf{\bar e}f}

\def\thn{\mathrel|}
\def\coe{\mathsf{coe}}
\def\bpush{\mathbf{push}}
\def\bpull{\mathbf{pull}}

\def\wo{\setminus}
\def\fA{\mathsf{A}}
\def\fC{\mathsf{C}}
\def\fX{\mathsf{X}}
\def\ff{\mathsf{f}}
\def\fm{\mathsf{m}}
\def\rspan{\mathsf{Span}}
% \def\El#1{\mathsf{El}({#1})}
\def\El#1{\ulcorner{#1}\urcorner}
\def\U{\mathsf{U}}
\def\uu{\mathsf{u}}
\def\uni{\U}
\def\mor#1#2{#1 \to \underline{#2}}

\def\ridp{\mathsf{idp}}
\def\ssem#1{\langle\!\langle{#1}\rangle\!\rangle}

\definecolor{lred}{rgb}{0.95,0.8,0.8}
\definecolor{cyan}{rgb}{0.80,0.95,0.95}
\definecolor{lorange}{rgb}{0.95,0.90,0.80}
\definecolor{bluegray}{rgb}{0.6,0.6,0.85}
\definecolor{lgray}{gray}{0.9}
\newtcolorbox{declbox}{colframe=lred,colback=lred,grow to right by=-10mm,grow to left by=-10mm,
boxrule=0pt,boxsep=0pt,breakable}
\newtcolorbox{thmbox}{colframe=cyan,colback=cyan,grow to right by=-10mm,grow to left by=-10mm,
boxrule=0pt,boxsep=0pt,breakable}
\newtcolorbox{defnbox}{colframe=lorange,colback=lorange,grow to right by=-10mm,grow to left by=-10mm,
boxrule=0pt,boxsep=0pt,breakable}
\newtcolorbox{tangentbox}{colframe=lgray,colback=lgray,grow to right by=-10mm,grow to left by=-10mm,
boxrule=0pt,boxsep=0pt,breakable}

\input{linear}
\def\rpath#1{[#1]}
\def\rfst{\mathsf{fst}\,}
\def\rsnd{\mathsf{snd}\,}
\def\bunfold{\mathbf{unfold}}
\def\bfold{\mathbf{fold}}
\def\susp#1{\langle {#1} \rangle}
\def\ssusp#1{\langle\!\langle {#1} \rangle\!\rangle}
\def\dto{\mathrel{\dot\to}}
\def\dns{{\downarrow}}
\def\ups{{\uparrow}}
\def\sprov{\Vdash}
\def\signat{{\color{red}\Sigma}}
\def\ep#1{\underline{#1}}
\def\wat{\mathbin{@}}
\def\wwat{\mathbin{\underline\wat}}
\def\cn{{:}}
\def\dv{{\div}}
\def\ww{{\mathsf w}}
\def\base{{\textfrak b}}

\def\munit{I}
\def\tt{{\mathsf t}}
\def\ii{{\mathbb I}}
\def\T{\mathbb{T}}
\def\tw{\mathsf{Tw}}
\def\sw#1{^{#1}_{#1}}
\def\TP{\mathbf{TPre}}
\def\pp{\textsf{\textbf p}}
\def\nn{{\mathsf n}}
\def\PP{\textsf{\textbf P}}
\def\NN{\textsf{\textbf N}}
\def\zz{{\mathsf z}}
\def\sem#1{[\![#1]\!]}
\def\usem#1{\lceil\!\!\lceil{#1}\rceil\!\!\rceil}
\def\zem#1{\langle\!\langle#1\rangle\!\rangle}
\def\col#1{{\mathsf{C}}_{#1}}
\def\lax{\mathop\bigcirc}
\def\rjust{\mathsf{just}}
\def\rcvt{\mathsf{cvt}}
\def\rtype{\mathsf{type}}
\def\rdtype{\mathsf{disc}}
\def\rkind{\mathsf{kind}}
\def\rmode{\mathsf{mode}}
\def\rprel{\mathbf{Prel}}
\def\rrfam{\mathbf{Rfam}}
\def\rset{\mathbf{Set}}
\def\rfinset{\mathbf{FinSet}}
\def\rrel{\mathbf{Rel}}
\def\rcat{\mathbf{Cat}}
\def\rfam{\mathbf{Fam}}
\def\binj{\mathbf{inj}}
\def\rid{\mathsf{id}}
\def\rtrue{\mathrel\mathrm{true}}
\def\pbck{\ar[dr, phantom, pos=0, "\lrcorner"]}
\def\bpbck{\ar[ddrr, phantom, pos=0, "\lrcorner"]}
\def\erule#1#2{\begin{prooftree}#1\justifies #2\end{prooftree}}
\def\lpar{\bindnasrepma}
\def\lamp{\binampersand}
\def\btwo{\mathbf{2}}
\def\bone{\mathbf{1}}

\newarrow {Equiv} =====
\def\FinSet{\mathbf{FinSet}}
\def\x{\times}
\def\maps{\ar[dd,mapsto,shorten <=2em, shorten >=2em]}
\def\mapt{\ar[ddd,mapsto,shorten <=2em, shorten >=2em]}
\def\A{\mathbf{A}}
\def\B{\mathbf{B}}
\def\C{\mathbf{C}}
\def\G{\mathbf{G}}
\def\D{\mathbf{D}}
\def\DD{\mathbb{D}}
\def\E{\mathbf{E}}
\def\M{\mathbf{M}}
\def\pair#1#2{\langle#1,#2\rangle}
\def\ltri{{\lhd}}
\def\rtri{{\rhd}}
\def\tri{\rhd}
\def\ll{{<}}
\def\rr{{>}}
\def\cc{\mathsf{c}}
\def\dd{\mathsf{d}}
\def\o{\circ}
\def\rctx{\,\mathsf{ctx}}
\def\rdctx{\,\mathsf{dctx}}
\def\del{\partial}
\def\also#1{\ \textcolor{blue}{\celse #1}}
\newcounter{nodemaker}
\setcounter{nodemaker}{0}
\def\twocell#1#2{%
  \global\edef\mynodeone{twocell\arabic{nodemaker}}%
  \stepcounter{nodemaker}%
  \global\edef\mynodetwo{twocell\arabic{nodemaker}}%
  \stepcounter{nodemaker}%
  \ar[#1,phantom,shift left=3,""{name=\mynodeone}]%
  \ar[#1,phantom,shift right=3,""'{name=\mynodetwo}]%
  \ar[Rightarrow,#2,from=\mynodeone,to=\mynodetwo]%
}
\def\twocellswap#1#2{%
  \global\edef\mynodeone{twocell\arabic{nodemaker}}%
  \stepcounter{nodemaker}%
  \global\edef\mynodetwo{twocell\arabic{nodemaker}}%
  \stepcounter{nodemaker}%
  \ar[#1,phantom,shift right=3,""{name=\mynodeone}]%
  \ar[#1,phantom,shift left=3,""'{name=\mynodetwo}]%
  \ar[Rightarrow,#2,from=\mynodeone,to=\mynodetwo]%
}
\def\maps{\ar[dd,mapsto,shorten <=2em, shorten >=2em]}
\author{Jason Reed}
\definecolor{fib}{HTML}{ff7f00}
\definecolor{green}{HTML}{007f00}
\definecolor{red}{HTML}{df3f3f}
\definecolor{opfib}{HTML}{007fff}

% For lightening colors I used
% http://trycolors.com/ 6 parts white to 1 part color
\definecolor{opfibl}{HTML}{DBEDFF}
\definecolor{greenl}{HTML}{DBEDDB}
\definecolor{redl}{HTML}{FAE4E4}
\def\njudge#1{\fcolorbox{opfib}{white}{#1}}
\def\nrule#1{\fcolorbox{white}{opfibl}{#1}}
\def\neqn#1{\fcolorbox{white}{redl}{#1}}



\def\judge#1{\vskip 2em\noindent \njudge{$#1$}\vskip 0.5em\noindent}
\def\rule#1{\vskip 2em \noindent \nrule{$#1$}\vskip 0.5em\noindent}
\def\eqn#1{\vskip 2em \noindent \neqn{$#1$}\vskip 0.5em\noindent}
\def\prof{\nrightarrow}
\def\tensor{\otimes}
\def\htensor{\mathrel{\hat\otimes}}
\def\lol{\multimap}
\def\hlol{\mathrel{\hat\multimap}}
\def\wtf{{\color{red}???}}

\def\re{\mathbf{E}}
\def\sh{\sharp}
\def\shp{\mathrel{\sharp}}
\def\zero{\texttt{0}}
\begin{document}

\def\
\tikzset{
   commutative diagrams/.cd,
   arrow style=tikz,
   diagrams={>=stealth}}

\def\doubs#1{{}^{{#1}^\op}_{\x {#1}}}
\def\doub#1{{#1}^\op \x {#1}}
\section{Collecting Examples}
\[
\erule
{\int_\alpha F \sw {\alpha \alpha}}
{\int_\alpha \int^\beta F \sw {\alpha \beta}}
\isbad
\qquad
\erule
{\int_\alpha F^\alpha_\alpha \to G\sw \alpha}
{\left(\int_\alpha F^\alpha_\alpha\right) \to \int_\alpha G\sw \alpha}
\isbad
\]
\[
\erule
{\int_\alpha F^\alpha_{\alpha t\sw \alpha} \x H^{\alpha t\sw \alpha}_\alpha}
{\int_\alpha \int^\beta F^\alpha_{\alpha \beta} \x H^{\alpha \beta}_\alpha}
\isopen
\qquad
\erule
{ \int_\alpha F^{\alpha}_{\alpha t^\alpha_\alpha} \x H^{\alpha t^\alpha_\alpha}_{\alpha } \to G^\alpha_\alpha}
{\int_{\alpha} \left(\int_{\beta} F^\alpha_{\alpha\beta} \x H^{\alpha \beta}_{\alpha }\right) \to G^\alpha_\alpha}
\isok
\]
\[
\erule
{\int_\alpha F^\alpha_{\alpha \alpha} \x H^{\alpha \alpha}_\alpha}
{\int_\alpha \int^\beta F^\alpha_{\alpha \beta} \x H^{\alpha \beta}_\alpha}
\isok
\qquad
\erule
{\int_\alpha F^\alpha_{\alpha t\sw \alpha} }
{\int_\alpha \int^\beta F^\alpha_{\alpha \beta}}
\isok
\]
\subsection{Solving that Open One}
I keep staring at
\[
\erule
{\int_\alpha F^\alpha_{\alpha t\sw \alpha} \x H^{\alpha t\sw \alpha}_\alpha}
{\int_\alpha \int^\beta F^\alpha_{\alpha \beta} \x H^{\alpha \beta}_\alpha}
\isopen
\]
and thinking I can do it now. Let's try.
We have $M_d : F^d_{d t\sw d} \x H^{d t\sw d}_d$.
We can surely write
$M^1_d : F^d_{d t\sw d}$ and $M^2_d : H^{d t\sw d}_d$ for its components.
The end property is
\[ (F_{ft_f} \x H^{\cdot t^f}_f)M_d = (F^f_{t^f} \x H^{ft_f})M_e : F^d_{e t^d_e} \x H^{d t^e_d}_e\]
which does separate as
\[ F_{ft_f} M^1_d = F^f_{t^f} M^1_e : F^d_{e t^d_e} \chave\]
\[  H^{\cdot t^f}_f M^2_d =  H^{ft_f} M^2_e :  H^{d t^e_d}_e \chave\]
We're trying to make $L_d : \int^\beta F^d_{d\beta} \x H^{d\beta}_d$ so we set
\[L_d = \pair {t\sw d} {M_d}\] and try to check
\[ (\int F_{f} \x H_f)L_d = (\int F^f \x H^{f})L_e : \int^\beta F^d_{e \beta} \x H^{d \beta}_e\]
i.e.
\[ \pair{t\sw d}{ (F_{f} \x H_f)M_d } = \pair{t\sw e}{ (F^{f} \x H^f)M_e } : \int^\beta F^d_{e \beta} \x H^{d \beta}_e\]
\[ \pair{t\sw d}{ F_{f}M^1_d,  H_fM^2_d } = \pair{t\sw e}{ F^{f}M^1_e, H^f M^2_e } : \int^\beta F^d_{e \beta} \x H^{d \beta}_e \cwant\]
\subsubsection{Option 1}
Let's suppose there is a $h  :  H^{dt^d_e}_e$ such that $H^{\cdot t_f} h= H_fM^2_d$. Then we would have,
by coend property,
\[ \pair{t\sw d}{ F_{f}M^1_d,  H_fM^2_d }  =
 \pair{t\sw d}{ F_{f}M^1_d,  H^{\cdot t_f} h }  \]
\[= \pair{t^d_e}{ F_{ft_f}M^1_d,   h }\]
\[ = \pair{t^d_e}{ F^f_{t^f} M^1_e ,   h } \]
\[ = \pair{t^e_e}{ F^f M^1_e , H^{\cdot t^f}  h } \]
if we also had $H^{\cdot t^f} h= H^f M^2_e$ we'd be done.
\subsubsection{Option 2}
Let's suppose there is a $h : H^{dt^e_d}_e$ such that $h = H^{t^f}_f M^2_d$. Well,
that's trivial. In other words, just set $h = H^{t^f}_f M^2_d$. What's the coend property
for $t^f : t^e_d \to t^d_d$? It's that for any $z : F^d_{e t^e_d} \x H^{d t^d_d}_e$, we should find
\[ \pair {t^e_d} {z_1 , H^{\cdot t^f} z_2 } =  \pair {t\sw d} {F_{\cdot t_f} z_1, z_2 }\]
That gets us nowhere.
\subsubsection{Observation about Option 1}
If we had $h  :  H^{dt^d_e}_e$ such that $H^{\cdot t_f} h= H_fM^2_d$ and $H^{\cdot t^f} h= H^f M^2_e$,
we'd have the second component of the end property for $M$. For we'd calculate
\[  H^{\cdot t^f}_f M^2_d =  H^{\cdot t\sw f} h = H^{ft_f} M^2_e  \]
So if I had $p : F^{d}_{et^e_d} \x H^{dt^d_e}_e$ such that
\[(F_{\cdot t^f} \x H^{\cdot t_f})p = (F_f \x H_f)M_d\qquad
(F_{\cdot t_f} \x H^{\cdot t^f})p = (F^f \x H^f)M_e\]
I'd definitely have the above entailment.
\subsubsection{Generalization of this Observation}
Suppose we have $F : \doubs \A \x \doubs \B \to \rset$ and $t : \doubs \A \to \B$.
Suppose $M_d : F\sw{d t\sw d}$. But suppose we also
have $p_f : F^{dt^d_e}_{et^e_d}$ with
\[F^{\cdot t_f}_{\cdot t^f}p_f = F_f M_d\qquad
F_{\cdot t_f}^{\cdot t^f}p_f = F^f M_e\]
Then we have
\[ \int_\alpha \int^\beta F\sw{\alpha\beta}\]
by giving $L_d = \pair {t\sw d}{M_d}$
because
\[\pair {t\sw d}{F_f M_d} = \pair {t\sw d}{F^{\cdot t_f}_{\cdot t^f}p_f}\]
\[= \pair {t^d_e}{F^{}_{\cdot t^f_f}p_f}\]
\[= \pair {t\sw e}{F^{\cdot t^f}_{\cdot t_f}p_f}\]
\[= \pair {t\sw e}{F^f M_e}\]
All this data is a putative definition of
\[\int_\alpha [F^{\alpha\beta}_{\alpha\beta}]^{[t^\alpha_\alpha/\beta]}_\beta\]
\subsection{Expecting Blur To Fail}
So I think I expect covariant right-blur to fail for this, but it just might
be a signal that I need to ask for something slightly than just covariance
of the position the term appears in. Let's take a crack at it.
\[
\erule
{\int_\alpha F^\alpha_{\alpha t^\alpha_\alpha}}
{\int_\alpha [F^\alpha_{\alpha\beta}]^{[t^\alpha_\alpha/\beta]}_\beta}
\]
We have $M_d : F^d_{d t^d_d}$. We definitely cannot come up with
$p_f : F^{d}_{et^e_d}$  in any obvious way. Ok, but we can perhaps do
\[
\erule
{\int_\alpha F^\alpha_{\alpha t_\alpha}}
{\int_\alpha [F^\alpha_{\alpha\beta}]^{[t_\alpha/\beta]}_\beta}
\]
and come up with
$p_f : F^{d}_{et_d}$ as $F_f M_d$. We can check
\[p_f = F_f M_d\qquad
F_{\cdot t_f} p_f = F^f M_e\]
because $M$ actually is an end. However, I actually can't easily tolerate this kind
of watered-down definition, because I know that things like
\[\erule
{\int_\alpha F^\alpha_{\alpha t\sw \alpha} }
{\int_\alpha \int^\beta F^\alpha_{\alpha \beta}}
\isok
\]
worked! Why is that? Looking back at the original proof, it's because
I was able to appeal to the coend property first, instead of the end property first.
There might be more than one underlying reason why $\forall L$ is justified, maybe?

In that proof, it seems that the stronger-than-end condition is that
 I'm able to come up with, for any $f$, a
$F^{dt^e_d}_{et^d_e}$. Hm, but that isn't significant. Since it's by using the coend property
rather than the end property, is it actually the case that the univariance check is
baked directly into $\forall L$ and doesn't require coming up with any particular
property? I don't really like that conclusion.
\end{document}
