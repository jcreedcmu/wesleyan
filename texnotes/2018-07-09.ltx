\documentclass{article}
\usepackage[tmargin=0.05in, bmargin=0.05in]{geometry}
\input{theorem}
\input{prooftree}
\usepackage{relsize}
\usepackage{stmaryrd}
\usepackage{latexsym}
\usepackage{yfonts}
\usepackage{amsmath}
\usepackage[usenames,dvipsnames,svgnames,table]{xcolor}
\usepackage{tikz}
\usetikzlibrary{calc,arrows,cd,decorations.pathreplacing}
\usetikzlibrary{decorations.pathmorphing}
\usepackage{tcolorbox}
\tcbuselibrary{breakable}
\usepackage{listings}
\lstset{basicstyle=\ttfamily\footnotesize,breaklines=true}

\def\lint{{\textstyle\int}}
\def\isopen{\textcolor{orange}{\mathlarger{\mathlarger{\mathlarger{\textbf ?}}}}}
\def\isok{\textcolor{green}{\mathlarger{\mathlarger{\mathlarger{\checkmark}}}}}
\def\isbad{\textcolor{red}{\mathlarger{\mathlarger{\mathlarger{\x}}}}}
\def\chave{\eqno \textcolor{blue}{\hbox{have}}}
\def\cset{\eqno \textcolor{green}{\hbox{set}}}
\def\cwant{\eqno \textcolor{orange}{\hbox{want}}}
\def\gol{\sqsubset}
\def\gor{\sqsupset}

\def\sp{\bullet}
\def\ot{\leftarrow}
\def\prequiv{\dashv\vdash}
\def\fdom{{\mathbf{d}f}}
\def\fcod{{\mathbf{e}f}}
\def\fidom{\mathbf{\bar d}f}
\def\ficod{\mathbf{\bar e}f}

\def\thn{\mathrel|}
\def\coe{\mathsf{coe}}
\def\bpush{\mathbf{push}}
\def\bpull{\mathbf{pull}}

\def\wo{\setminus}
\def\fA{\mathsf{A}}
\def\fC{\mathsf{C}}
\def\fX{\mathsf{X}}
\def\ff{\mathsf{f}}
\def\fm{\mathsf{m}}
\def\rspan{\mathsf{Span}}
% \def\El#1{\mathsf{El}({#1})}
\def\El#1{\ulcorner{#1}\urcorner}
\def\U{\mathsf{U}}
\def\uu{\mathsf{u}}
\def\uni{\U}
\def\mor#1#2{#1 \to \underline{#2}}

\def\ridp{\mathsf{idp}}
\def\ssem#1{\langle\!\langle{#1}\rangle\!\rangle}

\definecolor{lred}{rgb}{0.95,0.8,0.8}
\definecolor{cyan}{rgb}{0.80,0.95,0.95}
\definecolor{lorange}{rgb}{0.95,0.90,0.80}
\definecolor{bluegray}{rgb}{0.6,0.6,0.85}
\definecolor{lgray}{gray}{0.9}
\newtcolorbox{declbox}{colframe=lred,colback=lred,grow to right by=-10mm,grow to left by=-10mm,
boxrule=0pt,boxsep=0pt,breakable}
\newtcolorbox{thmbox}{colframe=cyan,colback=cyan,grow to right by=-10mm,grow to left by=-10mm,
boxrule=0pt,boxsep=0pt,breakable}
\newtcolorbox{defnbox}{colframe=lorange,colback=lorange,grow to right by=-10mm,grow to left by=-10mm,
boxrule=0pt,boxsep=0pt,breakable}
\newtcolorbox{tangentbox}{colframe=lgray,colback=lgray,grow to right by=-10mm,grow to left by=-10mm,
boxrule=0pt,boxsep=0pt,breakable}

\input{linear}
\def\rpath#1{[#1]}
\def\rfst{\mathsf{fst}\,}
\def\rsnd{\mathsf{snd}\,}
\def\bunfold{\mathbf{unfold}}
\def\bfold{\mathbf{fold}}
\def\susp#1{\langle {#1} \rangle}
\def\ssusp#1{\langle\!\langle {#1} \rangle\!\rangle}
\def\dto{\mathrel{\dot\to}}
\def\dns{{\downarrow}}
\def\ups{{\uparrow}}
\def\sprov{\Vdash}
\def\signat{{\color{red}\Sigma}}
\def\ep#1{\underline{#1}}
\def\wat{\mathbin{@}}
\def\wwat{\mathbin{\underline\wat}}
\def\cn{{:}}
\def\dv{{\div}}
\def\ww{{\mathsf w}}
\def\base{{\textfrak b}}

\def\munit{I}
\def\tt{{\mathsf t}}
\def\ii{{\mathbb I}}
\def\T{\mathbb{T}}
\def\tw{\mathsf{Tw}}
\def\sw#1{^{#1}_{#1}}
\def\TP{\mathbf{TPre}}
\def\pp{\textsf{\textbf p}}
\def\nn{{\mathsf n}}
\def\PP{\textsf{\textbf P}}
\def\NN{\textsf{\textbf N}}
\def\zz{{\mathsf z}}
\def\sem#1{[\![#1]\!]}
\def\usem#1{\lceil\!\!\lceil{#1}\rceil\!\!\rceil}
\def\zem#1{\langle\!\langle#1\rangle\!\rangle}
\def\col#1{{\mathsf{C}}_{#1}}
\def\lax{\mathop\bigcirc}
\def\rjust{\mathsf{just}}
\def\rcvt{\mathsf{cvt}}
\def\rtype{\mathsf{type}}
\def\rdtype{\mathsf{disc}}
\def\rkind{\mathsf{kind}}
\def\rmode{\mathsf{mode}}
\def\rprel{\mathbf{Prel}}
\def\rrfam{\mathbf{Rfam}}
\def\rset{\mathbf{Set}}
\def\rfinset{\mathbf{FinSet}}
\def\rrel{\mathbf{Rel}}
\def\rcat{\mathbf{Cat}}
\def\rfam{\mathbf{Fam}}
\def\binj{\mathbf{inj}}
\def\rid{\mathsf{id}}
\def\rtrue{\mathrel\mathrm{true}}
\def\pbck{\ar[dr, phantom, pos=0, "\lrcorner"]}
\def\bpbck{\ar[ddrr, phantom, pos=0, "\lrcorner"]}
\def\erule#1#2{\begin{prooftree}#1\justifies #2\end{prooftree}}
\def\lpar{\bindnasrepma}
\def\lamp{\binampersand}
\def\btwo{\mathbf{2}}
\def\bone{\mathbf{1}}

\newarrow {Equiv} =====
\def\FinSet{\mathbf{FinSet}}
\def\x{\times}
\def\maps{\ar[dd,mapsto,shorten <=2em, shorten >=2em]}
\def\mapt{\ar[ddd,mapsto,shorten <=2em, shorten >=2em]}
\def\A{\mathbf{A}}
\def\B{\mathbf{B}}
\def\C{\mathbf{C}}
\def\G{\mathbf{G}}
\def\D{\mathbf{D}}
\def\DD{\mathbb{D}}
\def\E{\mathbf{E}}
\def\M{\mathbf{M}}
\def\pair#1#2{\langle#1,#2\rangle}
\def\ltri{{\lhd}}
\def\rtri{{\rhd}}
\def\tri{\rhd}
\def\ll{{<}}
\def\rr{{>}}
\def\cc{\mathsf{c}}
\def\dd{\mathsf{d}}
\def\o{\circ}
\def\rctx{\,\mathsf{ctx}}
\def\rdctx{\,\mathsf{dctx}}
\def\del{\partial}
\def\also#1{\ \textcolor{blue}{\celse #1}}
\newcounter{nodemaker}
\setcounter{nodemaker}{0}
\def\twocell#1#2{%
  \global\edef\mynodeone{twocell\arabic{nodemaker}}%
  \stepcounter{nodemaker}%
  \global\edef\mynodetwo{twocell\arabic{nodemaker}}%
  \stepcounter{nodemaker}%
  \ar[#1,phantom,shift left=3,""{name=\mynodeone}]%
  \ar[#1,phantom,shift right=3,""'{name=\mynodetwo}]%
  \ar[Rightarrow,#2,from=\mynodeone,to=\mynodetwo]%
}
\def\twocellswap#1#2{%
  \global\edef\mynodeone{twocell\arabic{nodemaker}}%
  \stepcounter{nodemaker}%
  \global\edef\mynodetwo{twocell\arabic{nodemaker}}%
  \stepcounter{nodemaker}%
  \ar[#1,phantom,shift right=3,""{name=\mynodeone}]%
  \ar[#1,phantom,shift left=3,""'{name=\mynodetwo}]%
  \ar[Rightarrow,#2,from=\mynodeone,to=\mynodetwo]%
}
\def\maps{\ar[dd,mapsto,shorten <=2em, shorten >=2em]}
\author{Jason Reed}
\definecolor{fib}{HTML}{ff7f00}
\definecolor{green}{HTML}{007f00}
\definecolor{red}{HTML}{df3f3f}
\definecolor{opfib}{HTML}{007fff}

% For lightening colors I used
% http://trycolors.com/ 6 parts white to 1 part color
\definecolor{opfibl}{HTML}{DBEDFF}
\definecolor{greenl}{HTML}{DBEDDB}
\definecolor{redl}{HTML}{FAE4E4}
\def\njudge#1{\fcolorbox{opfib}{white}{#1}}
\def\nrule#1{\fcolorbox{white}{opfibl}{#1}}
\def\neqn#1{\fcolorbox{white}{redl}{#1}}



\def\judge#1{\vskip 2em\noindent \njudge{$#1$}\vskip 0.5em\noindent}
\def\rule#1{\vskip 2em \noindent \nrule{$#1$}\vskip 0.5em\noindent}
\def\eqn#1{\vskip 2em \noindent \neqn{$#1$}\vskip 0.5em\noindent}
\def\prof{\nrightarrow}
\def\tensor{\otimes}
\def\htensor{\mathrel{\hat\otimes}}
\def\lol{\multimap}
\def\hlol{\mathrel{\hat\multimap}}
\def\wtf{{\color{red}???}}

\def\re{\mathbf{E}}
\def\sh{\sharp}
\def\shp{\mathrel{\sharp}}
\def\zero{\texttt{0}}
\begin{document}

\def\
\tikzset{
   commutative diagrams/.cd,
   arrow style=tikz,
   diagrams={>=stealth}}

\def\doubs#1{{}^{{#1}^\op}_{\x {#1}}}
\def\doub#1{{#1}^\op \x {#1}}
\section{Collecting Examples}
\[
\erule
{\int_\alpha F \sw {\alpha \alpha}}
{\int_\alpha \int^\beta F \sw {\alpha \beta}}
\isbad
\qquad
\erule
{\int_\alpha F^\alpha_\alpha \to G\sw \alpha}
{\left(\int_\alpha F^\alpha_\alpha\right) \to \int_\alpha G\sw \alpha}
\isbad
\]
\[
\erule
{\int_\alpha F^\alpha_{\alpha t\sw \alpha} \x H^{\alpha t\sw \alpha}_\alpha}
{\int_\alpha \int^\beta F^\alpha_{\alpha \beta} \x H^{\alpha \beta}_\alpha}
\isopen
\qquad
\erule
{ \int_\alpha F^{\alpha}_{\alpha t^\alpha_\alpha} \x H^{\alpha t^\alpha_\alpha}_{\alpha } \to G^\alpha_\alpha}
{\int_{\alpha} \left(\int_{\beta} F^\alpha_{\alpha\beta} \x H^{\alpha \beta}_{\alpha }\right) \to G^\alpha_\alpha}
\isok
\]
\[
\erule
{\int_\alpha F^\alpha_{\alpha \alpha} \x H^{\alpha \alpha}_\alpha}
{\int_\alpha \int^\beta F^\alpha_{\alpha \beta} \x H^{\alpha \beta}_\alpha}
\isok
\qquad
\erule
{\int_\alpha F^\alpha_{\alpha t\sw \alpha} }
{\int_\alpha \int^\beta F^\alpha_{\alpha \beta}}
\isok
\]
\subsection{Solving that Open One}
I keep staring at
\[
\erule
{\int_\alpha F^\alpha_{\alpha t\sw \alpha} \x H^{\alpha t\sw \alpha}_\alpha}
{\int_\alpha \int^\beta F^\alpha_{\alpha \beta} \x H^{\alpha \beta}_\alpha}
\isopen
\]
and thinking I can do it now. Let's try.
We have $M_d : F^d_{d t\sw d} \x H^{d t\sw d}_d$.
We can surely write
$M^1_d : F^d_{d t\sw d}$ and $M^2_d : H^{d t\sw d}_d$ for its components.
The end property is
\[ (F_{ft_f} \x H^{\cdot t^f}_f)M_d = (F^f_{t^f} \x H^{ft_f})M_e : F^d_{e t^d_e} \x H^{d t^e_d}_e\]
which does separate as
\[ F_{ft_f} M^1_d = F^f_{t^f} M^1_e : F^d_{e t^d_e} \chave\]
\[  H^{\cdot t^f}_f M^2_d =  H^{ft_f} M^2_e :  H^{d t^e_d}_e \chave\]
We're trying to make $L_d : \int^\beta F^d_{d\beta} \x H^{d\beta}_d$ so we set
\[L_d = \pair {t\sw d} {M_d}\] and try to check
\[ (\int F_{f} \x H_f)L_d = (\int F^f \x H^{f})L_e : \int^\beta F^d_{e \beta} \x H^{d \beta}_e\]
i.e.
\[ \pair{t\sw d}{ (F_{f} \x H_f)M_d } = \pair{t\sw e}{ (F^{f} \x H^f)M_e } : \int^\beta F^d_{e \beta} \x H^{d \beta}_e\]
\[ \pair{t\sw d}{ F_{f}M^1_d,  H_fM^2_d } = \pair{t\sw e}{ F^{f}M^1_e, H^f M^2_e } : \int^\beta F^d_{e \beta} \x H^{d \beta}_e \cwant\]
\subsubsection{Option 1}
Let's suppose there is a $h  :  H^{dt^d_e}_e$ such that $H^{\cdot t_f} h= H_fM^2_d$. Then we would have,
by coend property,
\[ \pair{t\sw d}{ F_{f}M^1_d,  H_fM^2_d }  =
 \pair{t\sw d}{ F_{f}M^1_d,  H^{\cdot t_f} h }  \]
\[= \pair{t^d_e}{ F_{ft_f}M^1_d,   h }\]
\[ = \pair{t^d_e}{ F^f_{t^f} M^1_e ,   h } \]
\[ = \pair{t^e_e}{ F^f M^1_e , H^{\cdot t^f}  h } \]
if we also had $H^{\cdot t^f} h= H^f M^2_e$ we'd be done.
\subsubsection{Option 2}
Let's suppose there is a $h : H^{dt^e_d}_e$ such that $h = H^{t^f}_f M^2_d$. Well,
that's trivial. In other words, just set $h = H^{t^f}_f M^2_d$. What's the coend property
for $t^f : t^e_d \to t^d_d$? It's that for any $z : F^d_{e t^e_d} \x H^{d t^d_d}_e$, we should find
\[ \pair {t^e_d} {z_1 , H^{\cdot t^f} z_2 } =  \pair {t\sw d} {F_{\cdot t_f} z_1, z_2 }\]
That gets us nowhere.
\subsubsection{Observation about Option 1}
If we had $h  :  H^{dt^d_e}_e$ such that $H^{\cdot t_f} h= H_fM^2_d$ and $H^{\cdot t^f} h= H^f M^2_e$,
we'd have the second component of the end property for $M$. For we'd calculate
\[  H^{\cdot t^f}_f M^2_d =  H^{\cdot t\sw f} h = H^{ft_f} M^2_e  \]
So if I had $p : F^{d}_{et^e_d} \x H^{dt^d_e}_e$ such that
\[(F_{\cdot t^f} \x H^{\cdot t_f})p = (F_f \x H_f)M_d\qquad
(F_{\cdot t_f} \x H^{\cdot t^f})p = (F^f \x H^f)M_e\]
I'd definitely have the above entailment.
\subsubsection{Generalization of this Observation}
Suppose we have $F : \doubs \A \x \doubs \B \to \rset$ and $t : \doubs \A \to \B$.
Suppose $M_d : F\sw{d t\sw d}$. But suppose we also
have $p_f : F^{dt^d_e}_{et^e_d}$ with
\[F^{\cdot t_f}_{\cdot t^f}p_f = F_f M_d\qquad
F_{\cdot t_f}^{\cdot t^f}p_f = F^f M_e\]
Then we have
\[ \int_\alpha \int^\beta F\sw{\alpha\beta}\]
by giving $L_d = \pair {t\sw d}{M_d}$
because
\[\pair {t\sw d}{F_f M_d} = \pair {t\sw d}{F^{\cdot t_f}_{\cdot t^f}p_f}\]
\[= \pair {t^d_e}{F^{}_{\cdot t^f_f}p_f}\]
\[= \pair {t\sw e}{F^{\cdot t^f}_{\cdot t_f}p_f}\]
\[= \pair {t\sw e}{F^f M_e}\]
All this data is a putative definition of
\[\int_\alpha [F^{\alpha\beta}_{\alpha\beta}]^{[t^\alpha_\alpha/\beta]}_\beta\]
\subsection{Expecting Blur To Fail}
So I think I expect covariant right-blur to fail for this, but it just might
be a signal that I need to ask for something slightly than just covariance
of the position the term appears in. Let's take a crack at it.
\[
\erule
{\int_\alpha F^\alpha_{\alpha t^\alpha_\alpha}}
{\int_\alpha [F^\alpha_{\alpha\beta}]^{[t^\alpha_\alpha/\beta]}_\beta}
\]
We have $M_d : F^d_{d t^d_d}$. We definitely cannot come up with
$p_f : F^{d}_{et^e_d}$  in any obvious way. Ok, but we can perhaps do
\[
\erule
{\int_\alpha F^\alpha_{\alpha t_\alpha}}
{\int_\alpha [F^\alpha_{\alpha\beta}]^{[t_\alpha/\beta]}_\beta}
\]
and come up with
$p_f : F^{d}_{et_d}$ as $F_f M_d$. We can check
\[p_f = F_f M_d\qquad
F_{\cdot t_f} p_f = F^f M_e\]
because $M$ actually is an end. However, I actually can't easily tolerate this kind
of watered-down definition, because I know that things like
\[\erule
{\int_\alpha F^\alpha_{\alpha t\sw \alpha} }
{\int_\alpha \int^\beta F^\alpha_{\alpha \beta}}
\isok
\]
worked! Why is that? Looking back at the original proof, it's because
I was able to appeal to the coend property first, instead of the end property first.
There might be more than one underlying reason why $\forall L$ is justified, maybe?

In that proof, it seems that the stronger-than-end condition is that
 I'm able to come up with, for any $f$, a
$F^{dt^e_d}_{et^d_e}$. Hm, but that isn't significant. Since it's by using the coend property
rather than the end property, is it actually the case that the univariance check is
baked directly into $\forall L$ and doesn't require coming up with any particular
property? I don't really like that conclusion.

\subsection{Some Examples of Composition}

So I should be able to do

\[
\erule
{\int_{\alpha\beta} F_\alpha \to G^\beta_{\alpha\beta}\qquad \int_{\alpha\beta}  G^\alpha_{\alpha\beta} \to H_\beta}
{\int_\alpha F_\alpha \to H_\alpha}
\isok
\]
Because it's a no-loop extranatural transformation composition.
Specifically, we can construct
\[
\erule
{M_{ab} : F_a \to G^b_{ab}\qquad N_{ab} :   G^a_{ab} \to H_b}
{L_a : F_a \to H_a}
\]
as $L_a(x) = N_{aa}(M_{aa} x)$. We have the end-properties
\[ G_{fg} \o M_{ab} = G^g \o M_{AB} \o F_f : F_a \to G^b_{AB} \]
\[ H_g \o N_{ab} \o G^f =  N_{AB} \o G_{fg} : G^A_{ab} \to H_B\]
for $f : a \to A$ and $g : b \to B$.
and we need to check
\[ H_f \o L_{a}  =  L_{A} \o F_f : F_a \to H_A\]
i.e.
\[ H_f \o N_{aa} \o M_{aa}  =  N_{AA} \o M_{AA} \o F_f : F_a \to H_A\]
and there we're pretty much stuck. Or are we? Ah, I see, I can independently set
$f$ and $g$ in the end-properties I have. So I have in particular

\[ G_{f} \o M_{ab} = M_{Ab} \o F_f : F_a \to G^b_{Ab} \]
\[ H_g \o N_{ab} =  N_{aB} \o G_{\cdot g} : G^a_{ab} \to H_B\]
so I compute
\[ H_f \o N_{aa} \o M_{aa}  =  N_{aA} \o G_{\cdot f} \o M_{aa}\]
\[ =  N_{aA} \o G^f \o M_{aA} \]
\[ =  N_{AA} \o G_f \o M_{aA} \]
\[=  N_{AA} \o M_{AA} \o F_f \]
And I kind of have a feel for how this is pushing a bead along the string diagram.

\subsection{Attempting to Strengthen}
\[
\erule
{\int_{\alpha\beta} F_\alpha \to G^\beta_{\alpha\beta}\qquad \int_{\alpha\beta}  G^\alpha_{\alpha\beta} \to H_\beta^\beta}
{\int_\alpha F_\alpha \to H_\alpha^\alpha}
\isok
\]
we construct
\[
\erule
{M_{ab} : F_a \to G^b_{ab}\qquad N_{ab} :   G^a_{ab} \to H^b_b}
{L_a : F_a \to H^a_a}
\]
as $L_a(x) = N_{aa}(M_{aa} x)$. We have the end-properties
\[ G_{fg} \o M_{ab} = G^g \o M_{AB} \o F_f : F_a \to G^b_{AB} \]
\[ H_g \o N_{ab} \o G^f =  H^g \o N_{AB} \o G_{fg} : G^A_{ab} \to H^b_B\]
for $f : a \to A$ and $g : b \to B$.
and we need to check
\[ H_f \o L_{a}  =  H^f \o L_{A} \o F_f : F_a \to H^a_A\]
i.e.
\[ H_f \o N_{aa} \o M_{aa}  =  H^f \o N_{AA} \o M_{AA} \o F_f : F_a \to H^a_A\]
So we try to calculate
\[ H_f \o N_{aa} \o M_{aa}  =  H^f \o N_{aA} \o G_{\cdot f} \o M_{aa}\]
\[ =  H^f \o N_{aA} \o G^f \o M_{aA} \]
\[ =  H^f \o N_{AA} \o G_f \o M_{aA} \]
\[=  H^f \o N_{AA} \o M_{AA} \o F_f \]
\subsection{Attempting to Strengthen Noch Einmal}
\[
\erule
{\int_{\alpha\beta} F^\alpha_\alpha \to G^\beta_{\alpha\beta}\qquad \int_{\alpha\beta}  G^\alpha_{\alpha\beta} \to H_\beta^\beta}
{\int_\alpha F^\alpha_\alpha \to H_\alpha^\alpha}
\isok
\]
we construct
\[
\erule
{M_{ab} : F^a_a \to G^b_{ab}\qquad N_{ab} :   G^a_{ab} \to H^b_b}
{L_a : F^a_a \to H^a_a}
\]
as $L_a(x) = N_{aa}(M_{aa} x)$. We have the end-properties
\[ G_{fg} \o M_{ab} \o F^f = G^g \o M_{AB} \o F_f : F^A_a \to G^b_{AB} \eqno(M(f, g))\]
\[ H_g \o N_{ab} \o G^f =  H^g \o N_{AB} \o G_{fg} : G^A_{ab} \to H^b_B \eqno(N(f, g))\]
for $f : a \to A$ and $g : b \to B$.
and we need to check
\[ H_q \o L_{c} \o F^q =  H^q \o L_{C} \o F_q : F^C_c \to H^c_C\]
for any $q : c \to C$, i.e.
\[ H_q \o N_{cc} \o M_{cc} \o F^q  =  H^q \o N_{CC} \o M_{CC} \o F_q : F^C_c \to H^c_C\]
So calculate
\[ H_q \o N_{cc} \o M_{cc} \o F^q  = H^q \o N_{cC} \o G_{\cdot q} \o  M_{cc} \o F^q  \eqno(N(\rid_c ,q))\]
\[= H^q \o N_{cC} \o G^{q} \o  M_{cC} \o F^q  \eqno(M(\rid_c ,q))\]
\[= H^q \o N_{CC} \o G_{q} \o  M_{cC} \o F^q  \eqno(N(q ,\rid_C))\]
\[= H^q \o N_{CC} \o  M_{CC} \o F_q  \eqno(M(q ,\rid_C))\]
\subsection{Still More}
\[
\erule
{\int_{\alpha\beta} F\sw{\alpha\beta} \to G^\beta_{\alpha\beta}\qquad \int_{\alpha\beta}  G^\alpha_{\alpha\beta} \to H\sw{\alpha\beta}}
{\int_\alpha F\sw{\alpha\alpha} \to H\sw{\alpha\alpha}}
\isok
\]
we construct
\[
\erule
{M_{ab} : F\sw{ab} \to G^b_{ab}\qquad N_{ab} :   G^a_{ab} \to H\sw{ab}}
{L_a : F\sw{aa} \to H\sw{aa}}
\]
as $L_a(x) = N_{aa}(M_{aa} x)$. We have the end-properties
\[ G_{fg} \o M_{ab} \o F^{f g} = G^g \o M_{AB} \o F_{f g} : F^{AB}_{ab} \to G^b_{AB} \eqno(M(f, g))\]
\[ H_{fg} \o N_{ab} \o G^f =  H^{fg} \o N_{AB} \o G_{fg} : G^A_{ab} \to H^{ab}_{AB} \eqno(N(f, g))\]
for $f : a \to A$ and $g : b \to B$.
and we need to check
\[ H_{qq} \o L_{c} \o F^{qq} =  H^{qq} \o L_{C} \o F_{qq} : F^{CC}_{cc} \to H^{cc}_{CC}\]
for any $q : c \to C$, i.e.
\[ H_{qq} \o N_{cc} \o M_{cc} \o F^{qq} =  H^{qq} \o N_{CC} \o M_{CC} \o F_{qq} : F^{CC}_{cc} \to H^{cc}_{CC}\]
So calculate
\[ H_{qq} \o N_{cc} \o M_{cc} \o F^{qq}  = H^{\cdot q}_q \o N_{cC} \o G_{\cdot q} \o  M_{cc} \o F^{qq}  \eqno(N(\rid_c ,q))\]
\[= H^{\cdot q}_q \o N_{cC} \o G^{q} \o  M_{cC} \o F^{q}_{\cdot q}  \eqno(M(\rid_c ,q))\]
\[= H^{qq} \o N_{CC} \o G_{q} \o  M_{cC} \o F^{q}_{\cdot q}  \eqno(N(q ,\rid_C))\]
\[= H^{qq} \o N_{CC}  \o  M_{CC} \o F_{q q}  \eqno(M(q ,\rid_C))\]

\subsection{Something Like the $\mathsf S$-combinator}
\[
\erule
{\int_{\alpha\beta} F\sw{\alpha\beta} \to G^\beta_{\alpha\beta}
\qquad \int_{\alpha\beta} F\sw{\alpha\beta} \x  G^\alpha_{\alpha\beta} \to H\sw{\alpha\beta}}
{\int_\alpha F\sw{\alpha\alpha} \to H\sw{\alpha\alpha}}
\isok
\]
we construct
\[
\erule
{M_{ab} : F\sw{ab} \to G^b_{ab}\qquad N_{ab} :  F\sw{ab}\x G^a_{ab} \to H\sw{ab}}
{L_a : F\sw{aa} \to H\sw{aa}}
\]
as $L_a(x) = N_{aa} \o \pair{\rid}{ M_{aa}}$. We have the end-properties
\[ G_{fg} \o M_{ab} \o F^{f g} = G^g \o M_{AB} \o F_{f g} : F^{AB}_{ab} \to G^b_{AB} \eqno(M(f, g))\]
\[ H_{fg} \o N_{ab} \o (F^{fg} \x G^f) =  H^{fg} \o N_{AB} \o (F_{fg} \x G_{fg}) : F^{AB}_{ab} \x  G^A_{ab} \to H^{ab}_{AB} \eqno(N(f, g))\]
for $f : a \to A$ and $g : b \to B$.
and we need to check
\[ H_{qq} \o L_{c} \o F^{qq} =  H^{qq} \o L_{C} \o F_{qq} : F^{CC}_{cc} \to H^{cc}_{CC}\]
for any $q : c \to C$, i.e.
\[ H_{qq} \o N_{cc} \o \pair{\rid}{ M_{cc}} \o F^{qq} =  H^{qq} \o N_{CC} \o \pair{\rid}{ M_{CC}} \o F_{qq} : F^{CC}_{cc} \to H^{cc}_{CC}\]
So calculate
\[ H_{qq} \o N_{cc} \o \pair{\rid}{ M_{cc}} \o F^{qq} \]
\[ = H_{qq} \o N_{cc} \o \pair{ F^{qq}}{ M_{cc} \o  F^{qq}}  \]
\[ = H_{qq} \o N_{cc} \o (F^{\cdot q} \x \rid) \o \pair{ F^{q}}{ M_{cc} \o  F^{qq}}  \]
\[ = H^{\cdot q}_q \o N_{cC} \o (F_{\cdot q} \x G_{\cdot q}) \o  \pair{ F^{q}}{ M_{cc} \o  F^{qq}}  \eqno(N(\rid_c ,q))\]
\[ = H^{\cdot q}_q \o N_{cC} \o  \pair{ F^{q}_{\cdot q}}{ G_{\cdot q} \o M_{cc} \o  F^{qq}}\]
\[= H^{\cdot q}_q \o N_{cC} \o   \pair{ F^{q}_{\cdot q}} {G^{q} \o M_{cC} \o F^{q}_{\cdot q}}  \eqno(M(\rid_c ,q))\]
\[  = H^{qq} \o N_{CC} \o   \pair{ F_{q q}} { G_q \o M_{cC} \o F^{q}_{\cdot q}}  \eqno(N(q ,\rid_C))\]
\[= H^{qq} \o N_{CC} \o   \pair{ F_{q q}} {  M_{CC} \o F_{q q}} \eqno(M(q ,\rid_C))\]
\[= H^{qq} \o N_{CC} \o   \pair{ \rid} {  M_{CC} } \o F_{q q} \]

\subsubsection{What's the Sequent Proof Look Like}

\[
\erule
{
\[
\[
\[
\justifies
  F^{aa}_{aa}\prov F^{aa}_{aa}
\]
\qquad
\[
\[
\[
\justifies
   F^{aa}_{aa} \prov F^{aa}_{aa}
\]
\[
\justifies
   G^a_{aa} \prov G^a_{aa}
\]
\[
\justifies
H^{aa}_{aa}    \prov H^{aa}_{aa}
\]
\justifies
   G^a_{aa}, F^{aa}_{aa} \x G^a_{aa} \to H^{aa}_{aa},
 F^{aa}_{aa} \prov H^{aa}_{aa}
\]
\justifies
   G^a_{aa}, \forall ab . F^{ab}_{ab} \x G^a_{ab} \to H^{ab}_{ab},
 F^{aa}_{aa} \prov H^{aa}_{aa}
\]
\justifies
  F^{aa}_{aa} \imp G^a_{aa}, \forall ab . F^{ab}_{ab} \x G^a_{ab} \to H^{ab}_{ab},
 F^{aa}_{aa} \prov H^{aa}_{aa}
\]
\justifies
\forall ab . F^{ab}_{ab} \imp G^b_{ab}, \forall ab . F^{ab}_{ab} \x G^a_{ab} \to H^{ab}_{ab},
 F^{aa}_{aa} \prov H^{aa}_{aa}
\]}
{\forall ab . F^{ab}_{ab} \imp G^b_{ab}, \forall ab . F^{ab}_{ab} \x G^a_{ab} \to H^{ab}_{ab} \prov
\forall a . F^{aa}_{aa} \imp H^{aa}_{aa}
}
\]
\section{Loops In the Sequent Calculus}
So what if syntactically the idea is that we do quantifier synchronous rules
with suspended substitutions like
\[
\erule
{\Gamma, [t/x]A^x_x }
{\Gamma, \forall x . A^x_x \prov C}
\]
so we still have sthe structure of where the variables occurred, and the identity
rule is something like
\[
\erule
{\sigma  A \sim \sigma' A' }
{\Gamma, \sigma A \prov \sigma' A'}
\]
Where $A \sim A'$ is some kind of loop-freeness and compatibility condition among the variables
of $A$ and $A'$.

Let's try to see how the examples I have fare under that conjecture.
\[
\erule
{
\[
\[
\isbad
\justifies
[x/\alpha]F\sw{\alpha\alpha} \prov [x/\beta] F \sw {x \beta}
\]
\justifies
\forall\alpha. F \sw {\alpha \alpha} \prov \exists\beta. F \sw {x \beta}
\]
}
{\forall\alpha. F \sw {\alpha \alpha}\prov \forall\alpha .\exists\beta. F \sw {\alpha \beta}}
\]
Good, this seems like it has a loop.
\[
\erule
{
\[
\[
\isbad
\justifies
[x/\alpha] F^\alpha_\alpha \prov  [x/\alpha] F^\alpha_\alpha
\]
\[
\justifies
[x/\alpha] G\sw \alpha \prov  G\sw x
\]
\justifies
[x/\alpha] F^\alpha_\alpha \to G\sw \alpha, [x/\alpha] F^\alpha_\alpha \prov  G\sw x
\]
}
{\forall\alpha. F^\alpha_\alpha \to G\sw \alpha, \forall\alpha. F^\alpha_\alpha \prov  G\sw x}
\]
This seems like a loop specifically at $F$; I think the $G$-identity might be acceptable.
\[
\erule
{
\[\justifies [t^x_x/\beta]F^x_{x\beta} \prov [x/\alpha]F^\alpha_{\alpha t\sw \alpha} \]
\[\justifies [t^x_x/\beta]H^{x\beta}_x \prov [x/\alpha]H_\alpha^{\alpha t\sw \alpha} \]
\[
\justifies
[x/\alpha] G\sw \alpha \prov  G\sw x
\]
}
{ \forall\alpha .F^{\alpha}_{\alpha t^\alpha_\alpha} \x H^{\alpha t^\alpha_\alpha}_{\alpha } \to G^\alpha_\alpha,
\forall{\beta}. F^x_{x\beta} \x H^{x \beta}_{x }\prov  G^x_x}
\]
Yeah, here the same $G$-identity reappears, and I suppose all three of these ought
to be acceptable. I'm much less clear about my intuitions for general functor terms,
but I guess the `concrete' $x$s in $[t^x_x/\beta]$ have some chance of meaningfully
terminating the loop? Or something? Or maybe it's the other $x/\alpha$ interaction that
gets things started. Not sure until I conjecture a meaning for delayed substitutions.
\[
\erule
{[x/\alpha]F^\alpha_{\alpha\alpha} \prov [x/\beta] F^x_{x\beta}
\qquad
[x/\alpha]H_\alpha^{\alpha\alpha} \prov [x/\beta] H_x^{x\beta}}
{\forall\alpha. F^\alpha_{\alpha \alpha} \x H^{\alpha \alpha}_\alpha \prov
 \exists\beta. F^x_{x \beta} \x H^{x \beta}_x}
\]
Right, these would be loops except they're happening only at covariant or contravariant arguments.
\[
\erule
{[x/\alpha]F^\alpha_{\alpha t\sw \alpha}\prov [ t^x_x/\beta]F^x_{x \beta}}
{\forall\alpha. F^\alpha_{\alpha t\sw \alpha}  \prov \exists\beta. F^x_{x \beta}}
\]
Huh, this is a recurrence of the $F$-identity from two examples ago. So I guess
it must be ok.

That's my original batch of examples. Let's look at beefed-up composition.
\[
\erule
{F\sw{xx} \prov [xx/ab]F\sw{ab}
\qquad
[xx/ab]G^b_{ab} \prov [xx/ab]G^a_{ab}
\qquad[xx/ab]H\sw{ab} \prov H\sw{xx}}
{\forall{ab}. F\sw{ab} \to G^b_{ab}, \forall{ab}.  G^a_{ab} \to H\sw{ab}
,  F\sw{xx} \prov H\sw{xx}}
\]
What could these identity proofs (or variants of them) mean so that
\[
\erule
{[xx/ab]G^b_{ab} \prov [xx/ab]G^a_{ab}
\qquad[xx/ab]H\sw{ab} \prov H\sw{xx}}
{\forall ab . G^{a}_{ab} \to H^{ab}_{ab} , [xx/ab]G^b_{ab} \prov  H\sw{xx}}
\]
would be sound? Does it simplify anything to consider
\[
\erule
{A\sw x \prov [xx/ab]G^a_{ab}
\qquad[xx/ab]H\sw{ab} \prov B\sw x}
{\forall ab . G^{a}_{ab} \to H^{ab}_{ab} , A\sw x \prov  B\sw x}
\]
I know that I have an end
\[M : \int_{ab} G^a_{ab} \to H\sw {ab}\]
so I can get  $M_{xx} : G^x_{xx}$ to $H\sw {xx}$, with
$H_{fg} \o M_{dd'} \o G^f = H^{fg} \o M_{ee'} \o G_{fg}$.
I also probably have some sort of
\[N_x : A\sw x \to G^x_{xx}\]
\[L_x : H^{xx}_{xx} \to B\sw x\]
with properties yet to be determined. I want
to build
\[P_x : \left(\int_{ab} G^a_{ab} \to H\sw {ab}\right) \to A\sw x \to B\sw x \]
so obviously I set
\[P_x (M, a) = L_x(M_{xx} (N_x a))\]
and I want to check
\[(a : A^e_d) \to B_f P_d (M, A^f a) = B^f P_e(M, A_f a)\]
i.e.
\[(a : A^e_d) \to B_f L_d(M_{dd} (N_d A^f a)) = B^f L_e(M_{ee} (N_e A_f a))\]
Now if $N$ and $L$ were merely ends, we'd already have ... ugh, I don't know if
this line of thinking is going to get me anywhere.

\subsection{A Different Simplification}

\[
\erule
{A\sw x \prov [x/a] B\sw{ax} \qquad [x/a] C\sw{ax} \prov D\sw x}
{\forall a . B\sw{ax} \to C\sw {ax}, A\sw x \prov D \sw x}
\]
\subsection{A Different Composition Challenge}
\[
\erule
{}
{\int_a \left(\int_b B\sw{ab} \to C\sw {ab}\right) \to (A\sw a \to B\sw {aa}) \to (A\sw a \to C \sw {aa})}
\isok
\]
We define
\[M_d(E, k, x) = E_d(k(x))\]
and need to check
\[(E : \int_b B^{db}_{eb} \to C^{eb}_{db})(k : A^d_e \to B^{ee}_{dd})(x : A^e_d) \to\]
\[ C_{ff} M_d({\textstyle\int} C^f \o E \o {\textstyle\int} B_f , B^{ff} \o k \o A_f, A^f x) =\]
\[ C^{ff} M_e({\textstyle\int} C_f \o E \o {\textstyle\int} B^f , B_{ff} \o k \o A^f, A_f x)\]
i.e.
\[(E : \int_b B^{db}_{eb} \to C^{eb}_{db})(k : A^d_e \to B^{ee}_{dd})(x : A^e_d) \to\]
\[  C^f_{ff}  E_d     B^{ff}_f k  A^f_f x =  C^{ff}_f  E_e     B^f_{ff}  k  A^f_f x\]
knowing that $E$'s end property gives
\[C_{\cdot f}\o  E_d \o B^{\cdot f} = C^{\cdot f} \o E_d \o B_{\cdot f}\]
but this is trivially true.
\subsection{A Harder Composition Challenge}
\[
\erule
{\int_a A\sw a \to B\sw {aa}}
{\int_a \left(\int_b B\sw{ab} \to C\sw {ab}\right)  \to (A\sw a \to C \sw {aa})}
\]
Have $M_d : A\sw d \to B\sw{dd}$ with
\[ B_{ff} \o M_d \o A^f = B^{ff} \o M_e \o A_f \]
Construct
\[L_d(E, x) = E_d(M_d(x)) \]
need to check
\[(E : \int_b B^{db}_{eb} \to C^{eb}_{db})(x : A^e_d) \to\]
\[ C_{ff} L_d({\textstyle\int} C^f \o E \o {\textstyle\int} B_f ,  A^f x) =
 C^{ff} L_e({\textstyle\int} C_f \o E \o {\textstyle\int} B^f , A_f x)\]
i.e.
\[(E : \int_b B^{db}_{eb} \to C^{eb}_{db})(x : A^e_d) \to\]
\[ C_{ff}^f E_d  B_f M_d  A^f x = C^{ff}_f  E_e  B^f M_e A_f x\]
and here we get stuck because $M$'s end property
and $E$'s end property (the latter being
\(C_{\cdot f}\o  E_d \o B^{\cdot f} = C^{\cdot f} \o E_d \o B_{\cdot f}\)
)
both want a $B_{\cdot f}$
or $B^{\cdot f}$ to get started.


\subsection{A Simpler Composition Challenge}
\[
\erule
{\int_a B\sw {aa}}
{\int_a \left(\int_b B\sw{ab} \to C\sw {ab}\right)  \to C \sw {aa}}
\]
Have $M_d : B\sw{dd}$ with
\[ B_{ff} \o M_d = B^{ff} \o M_e \]
Construct
\[L_d(E) = E_d(M_d) \]
need to check
\[(E : \int_b B^{db}_{eb} \to C^{eb}_{db}) \to
 C_{ff} L_d({\textstyle\int} C^f \o E \o {\textstyle\int} B_f) =
 C^{ff} L_e({\textstyle\int} C_f \o E \o {\textstyle\int} B^f)\]
i.e.
\[(E : \int_b B^{db}_{eb} \to C^{eb}_{db}) \to
 C_{ff}^f E_d  B_f M_d  = C^{ff}_f  E_e  B^f M_e \]
and here we get stuck because $M$ and $E$'s end properties both want a $B_{\cdot f}$
or $B^{\cdot f}$ to get started.

\subsection{Simpler Still}
\[
\erule
{\int_a B\sw {aa}}
{\int_a \left(\int_b B\sw{ab} \to C\right)  \to C}
\]
Have $M_d : B\sw{dd}$ with
\[ B_{ff} \o M_d = B^{ff} \o M_e \]
Construct
\[L_d(E) = E_d(M_d) \]
need to check
\[(E : \int_b B^{db}_{eb} \to C) \to
 L_d({\textstyle\int}  E \o {\textstyle\int} B_f) =
 L_e({\textstyle\int}  E \o {\textstyle\int} B^f)\]
i.e.
\[(E : \int_b B^{db}_{eb} \to C) \to
  E_d  B_f M_d  =   E_e  B^f M_e \]
and here we get stuck because $M$ and $E$'s end properties both want a $B_{\cdot f}$
or $B^{\cdot f}$ to get started.
But I'm having trouble making a counterexample. It might be that $C$ being closed
makes this trivially true somehow.

\subsection{Reduce Dependencies of $B$ one way}
\[
\erule
{\int_a B\sw {a}}
{\int_a \left( B\sw{a} \to C\sw a\right)  \to C\sw a}
\isok
\]
Have $M_d : B\sw{dd}$ with
\[ B_{f} \o M_d = B^{f} \o M_e \]
Construct
\[L_d(E) = E(M_d) \]
need to check
\[(E : B^{d}_{e} \to C^e_d) \to
 L_d(C^f \o  E \o  B_f) =
 L_e(C_f \o  E \o  B^f)\]
i.e.
\[(E :  B^{d}_{e} \to C^e_d) \to
  C^f E B_f M_d  =  C_f E  B^f M_e \]
And here we can proceed just fine.
\subsection{Reduce Dependencies of $B$ the other way}
\[
\erule
{\int_a B\sw {a}}
{\int_a \left( \int_b B\sw{b} \to C\sw a\right)  \to C\sw a}
\]
Have $M_d : B\sw{d}$ with
\[ B_{f} \o M_d = B^{f} \o M_e \]
Construct
\[L_d(E) = E_d(M_d) \]
need to check
\[(E : \int_b B^{b}_{b} \to C^{e}_{d}) \to
 C_{f} L_d({\textstyle\int} C^f \o E ) =
 C^{f} L_e({\textstyle\int} C_f \o E )\]
i.e.
\[(E : \int_b B^{b}_{b} \to C^{e}_{d}) \to
 C_{f}^f E_d   M_d  = C^{f}_f  E_e  M_e \]
and here we get stuck because $M$ and $E$'s end properties both want a $B_{ f}$
or $B^{ f}$ to get started.

I can't seem to make a counterexample for this, either. Yeah,
I'm just being pressured back into the application counterexmaple
\[
\erule
{\int_a B\sw {a}}
{\left( \int_b B\sw{b} \to C\sw {b}\right) \to \int_a    C\sw {a}}
\isbad
\]
where $B$ is 0111 and $C$ is 0112. That's fine, it still breaks appropriately.
\subsection{So What Intuition Can I Extract}
Let's stare harder at that rule that fails, and see how I can enhance the premise to make
it acceptable.
\[
\erule
{[x/a]B^a_a \prov [x/a]B^a_a \qquad [x/a]C^a_a \prov C^x_x}
{\forall a . B^a_a, \forall a . B^a_a \to C^a_a \prov C^x_x}
\]
Have $M_d : B\sw{d}$ with
\[ B_{f} \o M_d = B^{f} \o M_e \]
Construct
\[L_d(E) = E_d(M_d) \]
need to check
\[(E : \int_b B^{b}_{b} \to C^{b}_{b}) \to
 C_{f} L_d(E ) =
 C^{f} L_e(E )\]
i.e.
\[(E : \int_b B^{b}_{b} \to C^{b}_{b}) \to
 C_{f} E_d   M_d  = C^{f}  E_e  M_e \]
and here we get stuck because $M$ and $E$'s end properties both want a $B_{ f}$
or $B^{ f}$ to get started.

Staring at $[x/a]B^a_a \prov [x/a]B^a_a$ and keeping in mind that when checking the end
property for the overall sequent, we're sort of effectively substituting $f : d\to e$
for $x$, it makes sense to ask for $M_f : B^d_e \to B^d_e$? No, maybe that doesn't make
sense. Surely it works to ask for $M_f : B^e_d$ such that $M_d = B^f M_f$ and $M_e = B_f M_f$.

\subsection{More Guesswork}
What would be a sufficient condition on the first premise of the rule
\[
\erule
{[t^x_x/a]A^a_a \prov [u^x_x/a]B^a_a \qquad [x/a]C^a_a \prov C^x_x}
{\forall a . A^a_a, \forall a . B^a_a \to C^a_a \prov C^x_x}
\]
to make it work? Or indeed, on something like
\[
\erule
{[t^x_x/a]A^{xa}_{xa} \prov [u^x_x/a]B \sw {xa}}
{\forall a . A\sw {xa}\prov \exists a . B \sw {xa}}
\]
?

We at least probably have some kind of function
\[N_x : A\sw{x t\sw x} \to B\sw{x u\sw x}\]
%\[M : \int_a A\sw {xa}\]
and we are trying to make
\[L_x : \int_a A\sw{xa} \to \int^b B\sw {xb}\]
and
so we set
\[L_x(y) = \pair {u\sw x} {N_x(y_{t\sw x})} \]
For any $f : d \to e$, we know the end and coend properties
\[ A_{\cdot f} y_d = A^{\cdot f} y_e : A^{xd}_{xe} \qquad (q : B^{xe}_{xd}) \to \pair d {B^{\cdot f} q} = \pair e {B_{\cdot f} q} \]
And we need to check for any $\phi : \delta \to \epsilon$ that
\[B_\phi \o L_\delta \o A^\phi  = B^\phi \o L_\epsilon \o A_\phi \]
i.e.
\[(y : \int_a A^{\epsilon a}_{\delta a}) \to  B_\phi L_\delta A^\phi y = B^\phi L_\epsilon A_\phi y\]
\[(y : \int_a A^{\epsilon a}_{\delta a}) \to
   \pair {u\sw \delta} {B_\phi N_\delta(A^\phi y_{t\sw \delta})}
   =
   \pair {u\sw \epsilon} {B^\phi N_\epsilon(A_\phi y_{t\sw \epsilon})}
: \int^b B^{\delta b}_{\epsilon b}
\]
So we want to imagine that we have some extra data on $N_x$ that lets us use
some of our assumptions. One such bit of extra data is supposing that
that $N_\delta$ factors to expose some kind of $B^{\cdot f}$ or $B_{\cdot f}$ so we can use the coend
property of $B$. We could consider for $f$ either $u_\phi : u\sw \delta \to u^\delta_\epsilon$
 or $u^\phi : u^\epsilon_\delta \to u\sw \delta$.
Factorization assumptions we could make would include
\[
\begin{tikzcd}
A\sw{\delta t\sw \delta} \ar[r, "N^1_\phi"] \ar[d, "N^2_\phi"'] \ar[dr, "N_\delta" description]
& B^{\delta u^\delta_\epsilon}_{\delta u\sw \delta} \ar[d, "B^{\cdot u_\phi}"]\\
B^{\delta u\sw \delta}_{\delta u^\epsilon_\delta} \ar[r, "B_{\cdot u^\phi}"']
& B\sw{\delta u\sw \delta}
\end{tikzcd}
\]
Ok, let's suppose we have $N^1_\phi$. Then we could compute
\[  \pair {u\sw \delta} {B_\phi N_\delta A^\phi y_{t\sw \delta}}\]
\[ = \pair {u\sw \delta} {B_\phi B^{\cdot u_\phi} N^1_\phi A^\phi y_{t\sw \delta}}\]
\[ = \pair {u^\delta_\epsilon} {B_\phi B_{\cdot u_\phi} N^1_\phi A^\phi y_{t\sw \delta}}\]
And then stuck more or less.

It seems like I have lots of options for factoring $N$ in various ways.

\subsection{Switching Notation}
I don't like how I've aligned on $d$s and $\delta$s here. Let me swap them.
We're trying to validate
\[
\erule
{[t^x_x/a]A^{xa}_{xa} \prov [u^x_x/b]B \sw {xb}}
{\int_a  A\sw {xa}\prov \int^b  B \sw {xb}}
\]
\[ N_d : A\sw {dt\sw d} \to B\sw{d u \sw d}\chave\]
\[ L_d :  \int_a  A^{da}_{da} \to \int^b  B^{db}_{db} \cwant\]
\[ L_d =\lambda y. \pair{u\sw d}{N_d y_{t\sw d}} \cset\]
\[ \lint B_f \o L_d \o \lint  A^f = \lint  B^f \o L_e \o \lint  A_f \cwant \]
\[ \left(y : \int_a A^{ea}_{da}\right) \to B_f L_d A^f y = B^f L_e A_f y : \int^b B^{db}_{eb}\cwant \]
\[ \left(y : \int_a A^{ea}_{da}\right) \to  \pair{u\sw d}{B_f N_d A^f y_{t\sw d}}
= \pair{u\sw e}{B^f N_e A_f y_{t\sw e}} : \int^b B^{db}_{eb}\cwant \]
\[ A_{\cdot \phi} y_\delta = A^{\cdot \phi} y_\epsilon : A^{e\delta}_{d\epsilon} \qquad (q : B^{d\epsilon}_{e\delta}) \to \pair \delta {B^{\cdot \phi} q} = \pair \epsilon {B_{\cdot \phi} q} \chave \]

So now I'm going to try to consistently lean towards factorizations of
$N_d/N_e$ that lead towards $t^d_e/u^d_e$ for no particular reason.
Assume:
\[
\begin{tikzcd}
   A^{d t \sw d}_{d t^d_e}\ar[r, "N^<_{df}"]\ar[from=d]
& B^{d u^d_e}_{d u \sw d} \ar[d]
\\
A\sw{d t \sw d} \ar[r, "N_d"']&B\sw{d u\sw d}
\end{tikzcd}
\qquad
\begin{tikzcd}
 A^{e t \sw e}_{e t^d_e}\ar[r, "N^>_{ef}"]
& B^{e u^d_e}_{e u \sw e}
\\
A\sw{e t \sw e} \ar[u]\ar[r, "N_e"']&B\sw{e u\sw e}\ar[from=u]
\end{tikzcd}
\]
\[
\begin{tikzcd}
&A^{dt^d_d}_{dt^d_e}\ar[r, "N^<_{df}"] & B^{du^d_e}_{du^d_d}
\\
\int_a A^{ea}_{da}\ar[r]
&  A^{et^d_e}_{dt^d_e}\ar[u]\ar[d]
&B^{du^d_e}_{eu^d_e} \ar[from=u]\ar[from=d]
&\int_b B^{db}_{eb}\ar[from=l]
\\
& A^{e t \sw e}_{e t^d_e}\ar[r, "N^>_{ef}"'] & B^{e u^d_e}_{e u \sw e}
\end{tikzcd}
\]
So I can try to compute
\[   \pair{u\sw d}{B_f N_d A^f y_{t\sw d}} \]
\[ =  \pair{u\sw d}{B_f^{\cdot u_f} N^<_{df} A_{\cdot u_f}^f y_{t\sw d}} \]
\[ =  \pair{u^d_e}{B_{f u_f} N^<_{df} A^{f u_f} y_{t^d_e}} \]
\[ =  \pair{u^d_e}{B^{f}_{\cdot u^f} N^>_{ef} A_{f}^{\cdot u^f} y_{t^d_e}} \]
\[ =  \pair{u^e_e}{B^{f u^f} N^>_{ef} A_{f u^f} y_{t^e_e}} \]
\[ =  \pair{u^e_e}{B^{f} N_e A_{f} y_{t^e_e}} \]
If $A$ is contravariant and $B$ is covariant, we can get this out of a mere end, I think.

\subsection{What If I go for $t^d_e$ but $u^e_d$?}
\[
\begin{tikzcd}
   A^{d t \sw d}_{d t^d_e}\ar[r, "N^<_{df}"]\ar[from=d]
& B^{d u^d_d}_{d u^e_d} \ar[d]
\\
A\sw{d t \sw d} \ar[r, "N_d"']&B\sw{d u\sw d}
\end{tikzcd}
\qquad
\begin{tikzcd}
 A^{e t \sw e}_{e t^d_e}\ar[r, "N^>_{ef}"]
& B^{e u^e_e}_{e u^e_d}
\\
A\sw{e t \sw e} \ar[u]\ar[r, "N_e"']&B\sw{e u\sw e}\ar[from=u]
\end{tikzcd}
\]
\[
\begin{tikzcd}
&A^{dt^d_d}_{dt^d_e}\ar[r, "N^<_{df}"] & B^{du^d_d}_{du^e_d}
\\
\int_a A^{ea}_{da}\ar[r]
&  A^{et^d_e}_{dt^d_e}\ar[u]\ar[d]
&B^{du^e_d}_{eu^e_d} \ar[from=u]\ar[from=d]
&\int_b B^{db}_{eb}\ar[from=l]
\\
& A^{e t \sw e}_{e t^d_e}\ar[r, "N^>_{ef}"'] & B^{e u^e_e}_{e u^e_d}
\end{tikzcd}
\]
So I can try to compute
\[   \pair{u\sw d}{B_f N_d A^f y_{t\sw d}} \]
\[ =  \pair{u\sw d}{B_{fu^f} N^<_{df} A_{\cdot u_f}^f y_{t\sw d}} \]
\[ =  \pair{u^e_d}{B_{f}^{\cdot u^f} N^<_{df} A^{f u_f} y_{t^d_e}} \]
\[ =  \pair{u^e_d}{B^{f u_f} N^>_{ef} A_{f}^{\cdot u^f} y_{t^d_e}} \]
\[ =  \pair{u^e_e}{B^{f}_{\cdot u_f} N^>_{ef} A_{f u^f} y_{t^e_e}} \]
\[ =  \pair{u^e_e}{B^{f} N_e A_{f} y_{t^e_e}} \]
Seems ok? And would allow blur if $A$ and $B$ are both contravariant?

Can maybe represent this derivation as a larger diagram
\[
\begin{tikzcd}
A^{et\sw d}_{dt\sw d}\ar[from=dd]\ar[r]
&A\sw{d t \sw d} \ar[d]\ar[r, "N_d"]
&B\sw{d u\sw d}\ar[from=d]
&B^{d u\sw d}_{e u\sw d}\ar[from=l]\ar[dd]
\\
&A^{dt^d_d}_{dt^d_e}\ar[r, "N^<_{df}"] & B^{du^d_d}_{du^e_d}
\\
\int_a A^{ea}_{da}\ar[r]
&  A^{et^d_e}_{dt^d_e}\ar[u]\ar[d]
&B^{du^e_d}_{eu^e_d} \ar[from=u]\ar[from=d]
&\int^b B^{db}_{eb}\ar[from=l]
\\
& A^{e t \sw e}_{e t^d_e}\ar[r, "N^>_{ef}"'] & B^{e u^e_e}_{e u^e_d}
\\
A^{et\sw e}_{dt\sw e}\ar[from=uu]\ar[r]
&A\sw{e t \sw e} \ar[u]\ar[r, "N_e"']
&B\sw{e u\sw e}\ar[from=u]
&B^{d u\sw e}_{e u\sw e}\ar[from=l]\ar[uu]
\end{tikzcd}
\]

\section{Just Left Forall By itself}

If there's no substitution of $u$ for a variable in $B$, this diagram would look like
\[
\begin{tikzcd}
A^{et\sw d}_{dt\sw d}\ar[from=dd]\ar[r]
&A\sw{d t \sw d} \ar[d]\ar[r, "N_d"]
&B\sw{d }\ar[from=d, equal]
\\
&A^{dt^d_d}_{dt^d_e}\ar[r, "N^<_{df}"] & B^{d}_{d}
\\
\int_a A^{ea}_{da}\ar[r]
&  A^{et^d_e}_{dt^d_e}\ar[u]\ar[d]
&B^{d}_{e} \ar[from=u]\ar[from=d]
& B^{d}_{e}\ar[from=l]
\\
& A^{e t \sw e}_{e t^d_e}\ar[r, "N^>_{ef}"'] & B^{e }_{e }
\\
A^{et\sw e}_{dt\sw e}\ar[from=uu]\ar[r]
&A\sw{e t \sw e} \ar[u]\ar[r, "N_e"']
&B\sw{e }\ar[from=u, equal]
\end{tikzcd}
\]
What this diagram is saying is that if we postulate the three cells in the middle column,
then we have an
inhabitant of the end
\[\int_x \left(\int_a A^{xa}_{xa}\right)  \to B^x_x \]
If $A$ is contravariant in its $a$-argument, and $N$ is already an end,
then $N^>_{df}$ and $N^<_{ef}$ trivially
exist; we can just assign $N_d$ and $N_e$ to them.

Ok, notation time. The relevant knobs to turn are: is it covariant/contravariant,
is it positive/negative, and is it connected to the source/destination of the arrow
being substituted for the variable. My sequent is going to look like

\[[t^x_x/a]^\nu\cdots [t^x_x/a]^\nu A, \ldots \prov [u^x_x / b]^\mu\cdots [u^x_x / b]^\mu B\]

where $\nu, \mu ::= \dns \celse \ups  $. (co, contra-variant).

\[\textcolor{red}{wrong?}\ups_{xf}^+(u) = {}^{u^e_d}_{u^x_x} \qquad \ups_{xf}^-(t) = {}_{t^d_e}^{t^x_x}\]
\[\ups_{f}^+(u) = {}^{u^e_d}_{u^e_d} \qquad \ups_{f}^-(t) = {}_{t^d_e}^{t^d_e}\]
\[\dns_{xf}^+(u) = {}^{u^d_e}_{u^x_x} \qquad \dns_{xf}^-(t) = {}^{t^e_d}_{t^x_x}\]
\[\dns_{f}^+(u) = {}^{u^d_e}_{u^d_e} \qquad \dns_{f}^-(t) = {}^{t^e_d}_{t^e_d}\]
and the diagram looks like (leaving $f$ implicit)
\[
\begin{tikzcd}
A^{et\sw d}_{dt\sw d}\ar[from=dd]\ar[r]
&A\sw{d t \sw d} \ar[d]\ar[r, "N_d"]
&B\sw{d u\sw d}\ar[from=d]
&B^{d u\sw d}_{e u\sw d}\ar[from=l]\ar[dd]
\\
&A^{d}_d \nu^-_{df }(t) \ar[r, "N_{df}"] & B^{d}_d \nu^+_{df }(t)
\\
\int_a A^{ea}_{da}\ar[r]
&  A^{e}_{d} \nu^-_f(t)\ar[u]\ar[d]
&B^{d}_{e} \nu^+_f(t) \ar[from=u]\ar[from=d]
&\int^b B^{db}_{eb}\ar[from=l]
\\
& A^{e}_{e} \nu^-_{ef }(t) \ar[r, "N_{ef}"'] & B^{e}_{e} \nu^+_{ef }(t)
\\
A^{et\sw e}_{dt\sw e}\ar[from=uu]\ar[r]
&A\sw{e t \sw e} \ar[u]\ar[r, "N_e"']
&B\sw{e u\sw e}\ar[from=u]
&B^{d u\sw e}_{e u\sw e}\ar[from=l]\ar[uu]
\end{tikzcd}
\]
And I think I can dispense with the $</>$ distinction since giving the $x$ and the $f$ suffices.

\subsection{Coincidences}
I notice that $\ups^+$ and $\dns^-$ give exactly the same results. So instead of talking about
pairs of arguments
$\nu^-$ vs. $\nu^+$, I should just talk about $\nu$ and $\bar\nu$. Furthermore, clearly
I should be considering twisted arrows of $f$ down to $d$ and $e$. Given a
$\tau : f \to s$, where $s : d' \to e'$, I define
\[\ups_{\tau}(u) = {}_{u^e_d}^{u^{e'}_{d'}} \qquad \dns_{\tau}(u) = {}^{u^d_e}_{u^{d'}_{e'}}\]
and my diagram is then
\[
\begin{tikzcd}
A^{et\sw d}_{dt\sw d}\ar[from=dd]\ar[r]
&A\sw{d t \sw d} \ar[d]\ar[r, "N_d"]
&[2em]B\sw{d u\sw d}\ar[from=d]
&B^{d u\sw d}_{e u\sw d}\ar[from=l]\ar[dd]
\\
&A^{d}_d \bar\nu_{\ltri f }(t) \ar[r, "N_{\ltri f}"] & B^{d}_d \nu_{\ltri f }(u)
\\
\int_a A^{ea}_{da}\ar[r]
&  A^{e}_{d} \bar\nu_{\rid_f}(t)\ar[u]\ar[d]\ar[r, "N_{\rid_f}" description]
&B^{d}_{e} \nu_{\rid_f}(u) \ar[from=u]\ar[from=d]
&\int^b B^{db}_{eb}\ar[from=l]
\\
& A^{e}_{e} \bar\nu_{\rtri f }(t) \ar[r, "N_{\rtri f}"'] & B^{e}_{e} \nu_{\rtri f }(u)
\\
A^{et\sw e}_{dt\sw e}\ar[from=uu]\ar[r]
&A\sw{e t \sw e} \ar[u]\ar[r, "N_e"']
&B\sw{e u\sw e}\ar[from=u]
&B^{d u\sw e}_{e u\sw e}\ar[from=l]\ar[uu]
\end{tikzcd}
\]
No, this doesn't check out, something went wrong.

Let's revisit these:
\[\textcolor{blue}{\ups_{xf}^+(u) = {}_{u^e_d}^{u^x_x}} \qquad \ups_{xf}^-(t) = {}_{t^d_e}^{t^x_x}\]
\[\ups_{f}^+(u) = {}^{u^e_d}_{u^e_d} \qquad \ups_{f}^-(t) = {}_{t^d_e}^{t^d_e}\]
\[\dns_{xf}^+(u) = {}^{u^d_e}_{u^x_x} \qquad \dns_{xf}^-(t) = {}^{t^e_d}_{t^x_x}\]
\[\dns_{f}^+(u) = {}^{u^d_e}_{u^d_e} \qquad \dns_{f}^-(t) = {}^{t^e_d}_{t^e_d}\]
I fixed the blue one; there aren't as many coincidences as I thought.
So I should still have the argument be a twisted arrow $\tau : f \to s$. But now it's looking
like
\[\ups_{\tau}^+(u) = {}_{u^e_d}^{u^{e'}_{d'}} \qquad \ups_{\tau}^-(u) = {}_{u^d_e}^{u^{d'}_{e'}}\]
\[\dns_{\tau}^+(u) = {}^{u^d_e}_{u^{d'}_{e'}} \qquad \dns_{\tau}^-(u) = {}^{u^e_d}_{u^{e'}_{d'}}\]
\[
\begin{tikzcd}
A^{et\sw d}_{dt\sw d}\ar[from=dd]\ar[r]
&A\sw{d t \sw d} \ar[d]\ar[r, "N_d"]
&[2em]B\sw{d u\sw d}\ar[from=d]
&B^{d u\sw d}_{e u\sw d}\ar[from=l]\ar[dd]
\\
&A^{d}_d \nu^-_{\ltri f }(t) \ar[r, "N_{\ltri f}"] & B^{d}_d \nu^+_{\ltri f }(u)
\\
\int_a A^{ea}_{da}\ar[r]
&  A^{e}_{d} \nu^-_{\rid_f}(t)\ar[u]\ar[d]\ar[r, "N_{\rid_f}" description]
&B^{d}_{e} \nu^+_{\rid_f}(u) \ar[from=u]\ar[from=d]
&\int^b B^{db}_{eb}\ar[from=l]
\\
& A^{e}_{e} \nu^-_{\rtri f }(t) \ar[r, "N_{\rtri f}"'] & B^{e}_{e} \nu^+_{\rtri f }(u)
\\
A^{et\sw e}_{dt\sw e}\ar[from=uu]\ar[r]
&A\sw{e t \sw e} \ar[u]\ar[r, "N_e"']
&B\sw{e u\sw e}\ar[from=u]
&B^{d u\sw e}_{e u\sw e}\ar[from=l]\ar[uu]
\end{tikzcd}
\]

Perhaps in general
\[ N_\tau : A^{e'}_{d'} \nu^-_\tau(t) \to B^{d'}_{e'} \nu^+_\tau(u) \]
and
\[
\begin{tikzcd}
  A^{d'}_{d} \nu^-_{\rid_{\ll\tau}}(t)\ar[d]\ar[r, "N_{\rid_{\ll\tau}}"]
&[4em]B^{d}_{d'} \nu^+_{\rid_{\ll\tau}}(u) \ar[from=d]
\\
 A^{e'}_{d'} \nu^-_{\tau }(t) \ar[r, "N_{\tau}" description] & B^{d'}_{e'} \nu^+_{\tau }(u)
\\
  A^{e}_{e'} \nu^-_{\rid_{\rr\tau}}(t)\ar[u]\ar[r, "N_{\rid_{\rr\tau}}"']
&[4em]B^{e'}_{e} \nu^+_{\rid_{\rr\tau}}(u) \ar[from=u]
\end{tikzcd}
\]
Where $\tau$ looks like
\[\begin{tikzcd}
  d \ar[d, "\ll \tau"']\ar[r]& e\ar[from=d, "\rr\tau"']\\
d'\ar[r] &e'
\end{tikzcd}\]


\end{document}
