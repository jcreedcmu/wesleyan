\documentclass{article}
\usepackage[tmargin=0.15in, bmargin=0.15in]{geometry}
\input{theorem}
\input{prooftree}
\usepackage{hyperref}
% https://tex.stackexchange.com/a/847
\hypersetup{
    colorlinks,
    urlcolor={blue},
}
\usepackage{makecell}
\usepackage{relsize}
\usepackage{latexsym}
\usepackage{amsmath}
\usepackage[usenames,dvipsnames,svgnames,table]{xcolor}
\usepackage{tikz}
\usetikzlibrary{calc,arrows,cd,decorations.pathreplacing}
\usetikzlibrary{decorations.pathmorphing}
\usepackage{tcolorbox}
\usepackage{stackengine}
\newcommand\oast{\stackMath\mathbin{\stackinset{c}{0ex}{c}{0ex}{\ast}{\bigcirc}}}

\tcbuselibrary{breakable}
\usepackage{listings}
\lstset{basicstyle=\ttfamily\footnotesize,breaklines=true}

\def\sssection#1{\vskip1em \hrule\vskip 0.5em \noindent $\triangleright$ {\bf #1} \vskip0.5em \hrule\vskip 1em }
\def\I{\mathbb{I}}




\def\gets{\leftarrow}
\def\all{\forall}

\def\spec{\mathsf{Spec}}
\def\breturn{\mathop{\mathbf{return}}\nolimits}
\def\bthunk{\mathop{\mathbf{thunk}}\nolimits}
\def\brun{\mathop{\mathbf{run}}\nolimits}
\def\bget{\mathop{\mathbf{get}}\nolimits}
\def\bGel{\mathop{\mathbf{Gel}}\nolimits}
\def\bgel{\mathop{\mathbf{gel}}\nolimits}
\def\bgbound{\mathop{\mathbf{gbound}}\nolimits}
\def\bgpath{\mathop{\mathbf{gpath}}\nolimits}
\def\bungel{\mathop{\mathbf{ungel}}\nolimits}
\def\bGet{\mathop\mathbf{Get}}
\def\dapt#1#2{#1[\![#2]\!]}
\def\dap#1#2{#1\{#2\}}
\def\ll{\langle\!\langle}
\def\rr{\rangle\!\rangle}
\def\rshape{\ {\mathsf{shape}}}
\def\rrefl{{\mathsf{refl}}}
\def\bd{\mathsf{Bd}}
\def\bdd{\mathsf{Bdd}}
\def\rset{\mathbf{Set}}
\def\rid{\mathsf{id}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\def\prequiv{\dashv\vdash}
\def\sq{\square}

\definecolor{blu}{rgb}{0.1,0.5,1}
\definecolor{orng}{rgb}{1,0.5,0.3}

\def\nameof#1{\ulcorner{#1}\urcorner}
\def\U{\mathsf{U}}
\def\uu{\mathsf{u}}
\def\uni{\U}



\definecolor{lred}{rgb}{0.95,0.8,0.8}
\definecolor{cyan}{rgb}{0.80,0.95,0.95}
\definecolor{lorange}{rgb}{0.95,0.90,0.80}
\definecolor{bluegray}{rgb}{0.6,0.6,0.85}
\definecolor{lgray}{gray}{0.8}
\newtcolorbox{declbox}{colframe=lred,colback=lred,grow to right by=-10mm,grow to left by=-10mm,
boxrule=0pt,boxsep=0pt,breakable}
\newtcolorbox{thmbox}{colframe=cyan,colback=cyan,grow to right by=-10mm,grow to left by=-10mm,
boxrule=0pt,boxsep=0pt,breakable}
\newtcolorbox{defnbox}{colframe=lorange,colback=lorange,grow to right by=-10mm,grow to left by=-10mm,
boxrule=0pt,boxsep=0pt,breakable}
\newtcolorbox{tangentbox}{colframe=lgray,colback=lgray,grow to right by=-10mm,grow to left by=-10mm,
boxrule=0pt,boxsep=0pt,breakable}

\input{linear}
\def\parr{\mathbin{\rotatebox[origin=c]{180}{\&}}}
\def\iff{\ \Longleftrightarrow\ }
\def\bu{\bullet}
\def\J{\mathbb{J}}
\def\R{\mathbb{R}}
\def\rpath#1{[#1]}
\def\rfst{\mathsf{fst}\,}
\def\rsnd{\mathsf{snd}\,}
\def\bunfold{\mathbf{unfold}}
\def\bfold{\mathbf{fold}}
\def\susp#1{\langle {#1} \rangle}
\def\ssusp#1{\langle\!\langle {#1} \rangle\!\rangle}
\def\dto{\mathrel{\dot\to}}
\def\dns{{\downarrow}}
\def\ups{{\uparrow}}
\def\sprov{\Vdash}
\def\signat{{\color{red}\Sigma}}
\def\ep#1{\underline{#1}}
\def\wat{{@}}
\def\wwat{\mathbin{\underline\wat}}
\def\cn{{:}}
\def\cprov{\mathrel\#}
\def\dv{{\div}}
\def\ww{{\mathsf w}}
\def\base{{\textfrak b}}

\def\N{{\mathbb N}}
\def\Z{{\mathbb Z}}
\def\munit{I}
\def\tt{{\mathsf t}}
\def\ii{{\mathbb I}}
\def\T{\mathbb{T}}
\def\tw{\mathop\triangleright\nolimits}
\def\tb{\mathop\blacktriangleleft}
\def\sw#1{^{#1}_{#1}}
\def\TP{\mathbf{TPre}}
\def\pp{\textsf{\textbf p}}
\def\nn{{\mathsf n}}
\def\PP{\textsf{\textbf P}}
\def\NN{\textsf{\textbf N}}
\def\zz{{\mathsf z}}
\def\sem#1{[\![#1]\!]}
\def\usem#1{\lceil\!\!\lceil{#1}\rceil\!\!\rceil}
\def\zem#1{\langle\!\langle#1\rangle\!\rangle}
\def\col#1{{\mathsf{C}}_{#1}}
\def\lax{\mathop\bigcirc}
\def\rjust{\mathsf{just}}
\def\rcvt{\mathsf{cvt}}
\def\rtype{\mathsf{type}}
\def\rdtype{\mathsf{disc}}
\def\rkind{\mathsf{kind}}
\def\rmode{\mathsf{mode}}
\def\rprel{\mathbf{Prel}}
\def\rrfam{\mathbf{Rfam}}
%\def\rset{\mathbf{Set}}
\def\rfinset{\mathbf{FinSet}}
\def\rrel{\mathbf{Rel}}
\def\rcat{\mathbf{Cat}}
\def\rfam{\mathbf{Fam}}
\def\binj{\mathbf{inj}}
\def\rtrue{\ \mathsf{true}}
\def\rfalse{\ \mathsf{false}}
\def\pbck{\ar[dr, phantom, pos=0, "\lrcorner"]}
\def\bpbck{\ar[ddrr, phantom, pos=0, "\lrcorner"]}
\def\erule#1#2{\begin{prooftree}#1\justifies #2\end{prooftree}}
\def\lpar{\bindnasrepma}
\def\lamp{\binampersand}
\def\btwo{\mathbf{2}}
\def\bone{\mathbf{1}}

\def\FinSet{\mathbf{FinSet}}
\def\x{\times}
\def\maps{\ar[dd,mapsto,shorten <=2em, shorten >=2em]}
\def\mapt{\ar[ddd,mapsto,shorten <=2em, shorten >=2em]}
\def\A{\mathbf{A}}
\def\B{\mathbb{B}}
\def\C{\mathbb{C}}
\def\W{\mathbb{W}}
\def\S{\mathbf{S}}
\def\G{\mathbf{G}}
\def\D{\mathbb{D}}
\def\E{\mathbb{E}}
\def\M{\mathbf{M}}
\def\pair#1#2{\langle#1,#2\rangle}
\def\ltri{{\lhd}}
\def\rtri{{\rhd}}
\def\tri{\rhd}
\def\cc{\mathsf{c}}
\def\dd{\mathsf{d}}
\def\o{\circ}
\def\rctx{\,\mathsf{ctx}}
\def\rdctx{\,\mathsf{dctx}}
\def\del{\partial}
\def\also#1{\ \textcolor{blue}{\celse #1}}
\newcounter{nodemaker}
\setcounter{nodemaker}{0}
\def\twocell#1#2{%
  \global\edef\mynodeone{twocell\arabic{nodemaker}}%
  \stepcounter{nodemaker}%
  \global\edef\mynodetwo{twocell\arabic{nodemaker}}%
  \stepcounter{nodemaker}%
  \ar[#1,phantom,shift left=3,""{name=\mynodeone}]%
  \ar[#1,phantom,shift right=3,""'{name=\mynodetwo}]%
  \ar[Rightarrow,#2,from=\mynodeone,to=\mynodetwo]%
}
\def\twocellswap#1#2{%
  \global\edef\mynodeone{twocell\arabic{nodemaker}}%
  \stepcounter{nodemaker}%
  \global\edef\mynodetwo{twocell\arabic{nodemaker}}%
  \stepcounter{nodemaker}%
  \ar[#1,phantom,shift right=3,""{name=\mynodeone}]%
  \ar[#1,phantom,shift left=3,""'{name=\mynodetwo}]%
  \ar[Rightarrow,#2,from=\mynodeone,to=\mynodetwo]%
}
\def\maps{\ar[dd,mapsto,shorten <=2em, shorten >=2em]}
\author{Jason Reed}
\definecolor{fib}{HTML}{ff7f00}
\definecolor{green}{HTML}{007f00}
\definecolor{red}{HTML}{df3f3f}
\definecolor{opfib}{HTML}{007fff}

% For lightening colors I used
% http://trycolors.com/ 6 parts white to 1 part color
\definecolor{opfibl}{HTML}{DBEDFF}
\definecolor{greenl}{HTML}{DBEDDB}
\definecolor{redl}{HTML}{FAE4E4}

% https://tex.stackexchange.com/questions/716631/curved-arrows-from-tikz-cd-do-not-work
\tikzset{
  curve/.style={
    settings={#1},
    to path={
      (\tikztostart)
      .. controls ($(\tikztostart)!\pv{pos}!(\tikztotarget)!\pv{height}!270:(\tikztotarget)$)
      and ($(\tikztostart)!1-\pv{pos}!(\tikztotarget)!\pv{height}!270:(\tikztotarget)$)
      .. (\tikztotarget)\tikztonodes
    },
  },
  settings/.code={%
    \tikzset{quiver/.cd,#1}%
    \def\pv##1{\pgfkeysvalueof{/tikz/quiver/##1}}%
  },
  quiver/.cd,
  pos/.initial=0.35,
  height/.initial=0,
}

\begin{document}

\def\
\tikzset{
   commutative diagrams/.cd,
   arrow style=tikz,
   diagrams={>=stealth}}
\tikzset{shorten <>/.style={shorten >=#1,shorten <=#1}}

\section{Cotangent}

Can I extract any interesting combinatorial story out of constructing
a translation-independent function?
Like, can I even figure out the combinatorial
relationship between $L(x+2) = 1/(1-(x+2))$
and $1/(-1-x) = -1 + x - x^2 +x^3 - \cdots$.
Somehow I think
\[ L(x+2) = xL(x^2) - L(x^2) \]
i.e.
\[L(x^2) + L(x+2) = xL(x^2)  \]
But the $+2$ is problematic. Can I generalize to $+a$?
\[ L(x+a) = {1\over 1-(x+a)} = {-1\over (a-1) + x}\]
Hm, I don't know what to do with that.

How about let's push it in the other direction. What's
the power series of $f(x) = {1\over (2-x)}$?
Well $f(x) = 1/2$. Then $f'(x) = {1\over ( 2-x)^2}$.
Hm. I see the pattern. Well, surely, symbolically, we also have
\[ f(x) = {1\over 2-x} = {1/2 \over 1 - x/2}\]
\[ = 2^{-1} + 2^{-2} x + 2^{-3} x^2 + 2^{-4} x^3 + \cdots \]
Ok, so if
\[f(x) = 2^{-1} + 2^{-2} x + 2^{-3} x^2 + 2^{-4} x^3 + \cdots \]
\[g(x) = 1 +  x +  x^2 +  x^3 + \cdots \]
Can we see in any combinatorial sense that $f(x + 1) = g(x)$? Hmm dunno.
If I have
\[f(x) = A^{1} + A^{2} x + A^{3} x^2 + A^{4} x^3 + \cdots \]
Then $f = A{1 \over 1 - Ax}$ and in some sense $f = {1 \over 1/A - x}$.
What if $B = 1/ A$? Then maybe $A = 1 / B = L(1-B)$.

\subsection{Summing}
What about just checking that
\[ {1\over 1- x} + {1\over -1 -  x} = {2x\over 1- x^2} \]
?
This is
\[ L(x) + L^-(x) - L^+(x) = 2xL(x^2) \]

Well what if we define
\[A = \prod_{n\ge 1} n \]
\[A_m = \prod_{n\ge 1, n\ne m} n  \]
Then we want to do something like
\[ f(x) = {x\over 1- x^2} + {x\over 4- x^2} + {x\over 9- x^2}+\cdots\]
then
\[ f(x) = {x\over 1- x^2} + {x/4\over - (x/2)^2} + {x/9\over 1- (x/3)^2}+\cdots\]
and maybe we can reason that
\[ f(A^2 x) =
 {A_1^2 x\over 1- A^2 A_1^2 x^2} +
 {A_2^2 x\over 1- A^2 A_2^2 x^2} +
 {A_3^2 x\over 1- A^2 A_3^2 x^2} + \cdots \]
\[ = (n : \N) \x A_n^2 x L((A A_n x)^2) \]

\subsection{Shifting}
Let's take
\[ f(x) = {1\over 3 - x} \qquad \therefore\  3f(3x) = L(x)\]
\[ g(x) = {1\over 4 - x} \qquad \therefore\  4g(4x) = L(x) \]
Then can I prove in some sense that
\[ g(x+1) = f(x) \]
?
Well let's try to evaluate
\[ 4g(4x+4) = L(x+1) = 3f(3x+3) \]
Hm. I don't know about that.
Can I relate anything to solving equations like
\[ 3 f(x) = 1 + x f(x) \]
\[ 4 g(x) = 1 + x g(x) \]
What if I generalize to
\[ f(x) = {1\over a - x} \qquad   af(x) = 1 + x f(x)\]
\[ g(x) = {1\over a + b - x} \qquad  (a+b)g(x) = 1 + xg(x) \]
And I try to extract something like $g(x+b) = f(x)$?
I could special case even to
\[ L(x) = {1\over 1 - x} \qquad   L(x) = 1 + x L(x)\]
\[ g(x) = {1\over 1 + b - x} \qquad  (1+b)g(x) = 1 + xg(x) \]
And try to extract something like $h := h = L(x)$?
What if I try to compute
\[ (1+b)h =  1 +  (x+b)h\]
then I find that
\[ h \approx  1 + xh\]
in the sense that
\[{\color{gray}bh} + h = {\color{gray}bh} +  1 + xh\]
and then I can add another collateral thingy and get
\[{\color{gray}bh + xbh} + h = {\color{gray}bh + xbh} +  1 + x +x^2h\]
i.e.
\[{\color{gray}bh(1+x)} + h = {\color{gray}bh(1+x)} +  1 + x +x^2h\]
and I think I can expand this to
\[{\color{gray}bhL(x)} + h = {\color{gray}bhL(x)} +  L(x)\]
But really
\[ g(x) = {1/(1+b)\over 1 - x/(1+b)} = L(x/(1+b))/(1+b) \]
So I should be restricting attention to situations where my argument
and my environment are multiplied by $1+b$. I don't know how to express that nontautologically.
\subsection{Interleaved Lists}

It's intuitively clear that
\[L(A+B) = L(A)L( B \x L(A))\]
Because a list of $A$ or $B$ can be interpreted as a run of $A$s until
you get to the first $B$, then another run of $A$s until you get to the next
$B$, etc. This also makes algebraic sense in that
\[ {1\over 1 - A - B} = {1\over 1- A} {1\over 1- {B \over 1 - A}}\]
And $L(2)$ is sort of like $-1$ in that
\[ L(A) = 1 + AL(A) \]
means
\[ {\color{gray} L(2)} = {\color{gray} L(2)\, +\, } 1 + L(2) \]
So I should find if I set $m = L(2)$, then
\[L(2+B) = L(2)L( B \x L(2))\]
\[L(2+B) =  m + m^2B + m^3B^2 + m^4B^3 + \cdots\]
And I want $m$ to behave like $-1$, so I want to get something like
\[L(2+B) + (1 + B^2 + B^4 + \cdots) =  (B + B^3 + B^5 + \cdots)\]
So I guess
\[ L(2 + B) = m + \cdots\]
becomes
\[ L(2 + B) + m + 1 = m + \cdots\]

In general, if $X = m + Y$, then $X + m + 1 = m + Y$, because
$X + m + 1 = (2m + 1) + Y = m + Y$.

I want to prove some theorem like that for $m^2 \approx 1$.
I know that $m = m + 1 + m$ so
\[ 1 + {\color{gray}m^2 + m} = m^2 + {\color{gray}m^2 + m}\]
Hm I'm getting lost in the specifics.

\[L(2) = {1\over 1-2} = {-1\over 1}\]
\[L(3) = {1\over 1-3} = {-1\over 2}\]
\[L(4) = {1\over 1-4} = {-1\over 3}\]
\[L(L(2)) = {1\over (2/1)} = {1/2}\]
\[L(L(3)) = {1\over (3/2)} = {2/3}\]
\[L(L(4)) = {1\over (4/3)} = {3/4}\]
\[L(L(2)) - L(3) = 1\]
\[L(L(3)) - L(4) = 1\]
\[L(L(A))  = 1 + L(A + 1) \tag{*}\]
Oh yeah because
\[L(A+B) = L(A)L( B \x L(A))\]
means
\[L(A+1) = L(A)L(L(A))\]
and just by list definition
\[L(L(A))  = 1 + L(A)L^2(A)\]
So putting those two together gives $(*)$. More generally
\[ L(B \cdot L(A)) = 1 + B \cdot L(A) \cdot L(B \cdot L(A))\]
\[ = 1 + B \cdot L(A + B)\]
\subsection{Difference}
What's $L(B - A)$? I should find something like
\[L(B-A) = L(-A)L( B \x L(-A))\]
\[ = (L_0(A) - L_1(A))L( B \x (L_0(A) - L_1(A)))\]
Hmm that could get messy due to the nested list of differences.
What about
\[L(A - B) = L(A)L( -B \x L(A))\]
\[ = L(A)L_0( B L(A)) - L(A) L_1(B L(A))\]
Then we're conjecturing that if $A = B + C$ then
\[L(C) + L(A) L_1(B L(A)) = L(A)L_0( B L(A))\]
so
\[L(C) + L(B + C) L_1(B L(B + C)) = L(B + C)L_0( B L(B + C))\]
I'm not sure I love that either. Let's revisit
\[L(B-A) = L(-A)L( B \x L(-A))\]
\[ = L(-A)(1 + B L(-A) + B^2 L(-A)^2 + B^3 L(-A)^3 + \cdots )\]
This seems like it's going to be a meaningful two-variable generating function.
The type $L(-A)$ by itself is the pair of types
\[\begin{array}{cccccccccc}
L_0(A)& = &1&&A^2&&A^4&&A^6&\cdots\\
L_1(A)&=&&A&&A^3&&A^5&&\cdots\\
\end{array}\]
And then $L(-A)^2 = (L_0^2 +L_1^2, 2L_0L_1)$
Ok let's just define $M^+_n$ and $M^-_n$ and $M_n = M^+_n - M^-_n$, so that
\[L(B-A) = M_1(1 + B M_1 + B^2 M_2 + B^3  M_3 + \cdots )\]
i.e.
\[L(B-A)^+ = M_1^+(1 + B M^+_1 + B^2 M^+_2 + B^3  M^+_3 + \cdots ) +
M_1^-( B M^-_1 + B^2 M^-_2 + B^3  M^-_3 + \cdots )\]
\[L(B-A)^- = M_1^-(1 + B M^+_1 + B^2 M^+_2 + B^3  M^+_3 + \cdots ) +
M_1^+( B M^-_1 + B^2 M^-_2 + B^3  M^-_3 + \cdots )\]

\subsection{Summing}
No wait maybe there's nothing invalid about
\[L(A - B)  = L(A)L_0( B L(A)) - L(A) L_1(B L(A))\]
after all.
This is lists of $A+B$ where we're splitting on the parity of the number of $B$s.
We still have
\[L(A + B)  = L(A)L( B L(A))\]
So my cotangent-like function is notionally
\[ F = \sum_{k\in \Z} L(A + kB) \]
And therefore actually it's two types
\[ F^+ = \sum_{k \ge 0} L(A + kB) +  \sum_{k \ge 1} L(A) L_0( kBL(A)) \]
\[ F^- =  \sum_{k \ge 1} L(A) L_1( kBL(A)) \]
I could also write these as
\[ F^-(A) =   L(A) \sum_{k \ge 1} L_1( kBL(A)) \]
\[ F^+(A) = L(A) +  L(A) \sum_{k \ge 1}  (L(kBL(A)) + L_0( kBL(A))) \]

\subsection{Invariance}
What I'd like to show is from the definition
\[ F^-(A) =   L(A) \sum_{k \ge 1} L_1( kBL(A)) \]
\[ F^+(A) = L(A) +  L(A) \sum_{k \ge 1}  (L(kBL(A)) + L_0( kBL(A))) \]
I can show that somehow
\[ \color{red} F^+(A+B) - F^-(A+B) = F^+(A) - F^-(A) \]
i.e.
\[ F^+(A+B) +  F^-(A) = F^+(A) +  F^-(A+B)\]
Reminding myself that the key lemma is
\[ L(A + B) = L(A) L(B L(A)) \]
and the intuitions are that
\[ \color{red} L(A - B)  = L(A) L_0(B L(A)) -  L(A) L_1(B L(A))\]
\[ \color{red} F^+(A) - F^-(A) = \sum_{k\in \Z} L(A + kB)\]
\[  F^+(A)  = F^-(A) + \sum_{k \ge 0 } L(A + kB) +\color{red} \sum_{k \ge 1} L(A - kB)\]
\[  F^+(A)  = F^-(A) + \sum_{k \ge 0 } L(A + kB) +\color{red} \sum_{k \ge 1} \left( L(A) L_0(kB L(A)) -  L(A) L_1(kB L(A))\right)\]
So yeah we definitely can prove
\[  F^+(A) + \sum_{k\ge 1} L(A) L_1(kB L(A))  = F^-(A) + \sum_{k \ge 0 } L(A + kB) +\sum_{k \ge 1}  L(A) L_0(kB L(A)) \]
directly from the definitions of $F^+, F^-$. That's good.

Let's make some auxiliary definitions.
\[M_k = L(A + kB) \qquad P_k = L(A) L_0(kBL(A)) \qquad Q_k = L(A)L_1(kBL(A))\]
\[ F^+ = \sum_{k\ge 0} M_k + \sum_{k\ge 1} P_k \]
\[ F^- =  \sum_{k\ge 1} Q_k \]
Let's write a postfix superscript $*$ for $[A := A+ B]$.
We know that $M_k^* = M_{k+1}$. We want to claim that
\[ \color{red} (P_{k+1} - Q_{k+1})^* = P_{k} - Q_{k} \]
\[ P_{k+1}^*   + Q_{k} = P_{k} + Q_{k+1}^* \tag{a} \]
\[ \color{red}  (P_{1} - Q_{1})^* = M_0 \]
\[ P_{1}^*  = M_0 + Q_{1}^* \tag{b}\]
%% Let's investigate $(b)$ first.
%% \[ L(A+B) L_0(BL(A+B)) = L(A) + L(A+B)L_1(BL(A+B))\]

\subsection{Invariance Take Two}

I think I see it a bit better now. I can describe these types more directly.
$M_k$ is the type of lists where the items can be $A$ or $kB$,
$P_k$ is the subset of $M_k$ where there are an even number of $kB$ items.
$Q_k$ is the subset of $M_k$ where there are an odd number of $kB$ items.
So $M_k = P_k + Q_k$.
We can see $P_0 = L(A)$ and $Q_0 = 0$. We want to confirm
\[ P_{k+1}^*   + Q_{k} = P_{k} + Q_{k+1}^*  \]
Let's drill in to what these are as power series in $B$, term by term.

What's the $B^0$ term?
\begin{itemize}
\item $P_{k+1}^*$ has an even number of $kB$, so zero works. So $[B^0]P_{k+1}^* = 1$
\item $Q_k$ has an odd number of $kB$, so $[B^0]Q_k = 0$.
\item $P_{k}$ has an even number of $kB$, so zero works. So $[B^0]P_{k+1} = 1$
\item $Q_{k+1}^*$ has an odd number of $kB$, so $[B^0]Q^*_{k+1} = 0$.
\end{itemize}
There may be any number of $A$s floating around, but we just match them up. Only the $B$s
matter for this part of the argument. Anyway, we see $1=1$, that's fine.

What's the $B^1$ term?
\begin{itemize}
\item $P_{k+1}^*$ has an even number of $kB$, so we have to use a $B$. So $[B^1]P_{k+1}^* = B$
\item $Q_k$ has an odd number of $kB$, so $[B^1]Q_k = kB$.
\item $P_{k}$ has an even number of $kB$, so $[B^1]P_{k+1} = 0$
\item $Q_{k+1}^*$ has an odd number of $kB$, so $[B^1]Q^*_{k+1} = (k+1)B$.
\end{itemize}
Okay, $B + kB = (k+1)B$.

What's the $B^2$ term?
\begin{itemize}
\item $P_{k+1}^*$ has an even number of $kB$, so $[B^2]P_{k+1}^* = B^2 + (k+1)^2B^2$
\item $Q_k$ has an odd number of $kB$, so $[B^2]Q_k = 0$.
\item $P_{k}$ has an even number of $kB$, so $[B^2]P_{k+1} = k^2B^2$
\item $Q_{k+1}^*$ has an odd number of $kB$, so $[B^2]Q^*_{k+1} = 2(k+1)B$.
\end{itemize}
Okay, $(k+1)^2 + 1 = k^2 + 2(k+1)$.

\section{Spheres}
I want to axiomatize some types $B$ of balls and spheres $S$
that are meant to be shapes of arbitrary-dimensional cells.
They're going to be objects in the category $\mathbf{Poly}(\C)$.
An object of that category is a morphism $E \to X$ in $\C$.
The object $X$ is thought of as a type of `codes' and the object
$E$ is a `total space' fibered over $X$.

A morphism $f_1 : E_1 \to X_1$ to $f_2 : E_2 \to X_2$ is a diagram
\[\begin{tikzcd}
  E_1 \ar[from=r, "h_E"'] \ar[dr, "f_1"'] & \ar[r] \ar[d] \pbck \bullet & E_2 \ar[d, "f_2"] \\
  & X_1 \ar[r, "h_X"'] & X_2
\end{tikzcd}\]
which says how codes are mapped, but then contravariantly says how
the mapped encoded spaces `sit inside' the premapped encoded spaces.

{\bf Axiom 1}

There's a `boundary' morphism $\partial  : B \to S$
and `domain' and `codomain' morphisms $d, c : S \to B$
such that
\[\begin{tikzcd}
  S \pbck\ar[r, "c"] \ar[d, "d"'] & B \ar[d, "\partial"] \\
  B \ar[r, "\partial"'] & S
\end{tikzcd}\]
is a pullback. We write $\partial'$ for the unique map $S \to S$.

{\bf Axiom 2}

If $S$ is $E_S \to X_S$ and $B$ is $E_B \to X_B$, then there's
at least a diagram


% https://q.uiver.app/#q=WzAsNyxbMCwwLCJFX1MiXSxbMiwwLCJFX0IiXSxbMCwyLCJYX1MiXSxbMiwxLCJYX0IiXSxbNCwwLCJFX1MiXSxbNCwyLCJYX1MiXSxbMywwLCJcXGJ1bGxldCJdLFswLDEsIlxcRGVsdGFfRSIsMV0sWzAsMl0sWzEsM10sWzIsMywiXFxEZWx0YV9YIiwyXSxbNCw1XSxbMyw1LCJcXHBhcnRpYWxfWCIsMl0sWzYsNCwiXFxwYXJ0aWFsX0UiXSxbNiwxXSxbNiwzXSxbNiw1LCIiLDAseyJzdHlsZSI6eyJuYW1lIjoiY29ybmVyIn19XSxbMiw1LCIiLDEseyJjdXJ2ZSI6MiwibGV2ZWwiOjIsInN0eWxlIjp7ImhlYWQiOnsibmFtZSI6Im5vbmUifX19XV0=
\[\begin{tikzcd}
	{E_S} && {E_B} & \bullet & {E_S} \\
	&& {X_B} \\
	{X_S} &&&& {X_S}
	\arrow["{\Delta_E}"{description}, from=1-1, to=1-3]
	\arrow[from=1-1, to=3-1]
	\arrow[from=1-3, to=2-3]
	\arrow[from=1-4, to=1-3]
	\arrow["{\partial_E}", from=1-4, to=1-5]
	\arrow[from=1-4, to=2-3]
	\arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-4, to=3-5]
	\arrow[from=1-5, to=3-5]
	\arrow["{\partial_X}"', from=2-3, to=3-5]
	\arrow["{\Delta_X}"', from=3-1, to=2-3]
	\arrow[curve={height=12pt}, equals, from=3-1, to=3-5]
\end{tikzcd}\]

but I think I might want to demand more at the $E$-level, not sure.
These $\Delta$ maps create directed cells out of spheres.

{\bf Axiom 3}

Composition is possible ($n=0$ is vertical, greater $n$ are increasingly horizontal)
If I take the pullback of $c(\partial')^n\partial$ and $d(\partial')^n\partial$,
then there's a cartesian (i.e. the $h_E$ of it is an iso) map
from that to $B$.

% https://q.uiver.app/#q=WzAsNyxbMSwxLCJcXGJ1bGxldCJdLFsyLDEsIkIiXSxbMSwyLCJCIl0sWzIsMiwiQiJdLFswLDAsIkIiXSxbMCwyLCJCIl0sWzIsMCwiQiJdLFswLDFdLFswLDJdLFsxLDMsImQnIl0sWzIsMywiYyciLDJdLFswLDQsImgiLDFdLFsyLDUsImQnIl0sWzEsNiwiYyciLDJdLFs0LDYsImMnIl0sWzQsNSwiZCciLDJdLFswLDMsIiIsMSx7InN0eWxlIjp7Im5hbWUiOiJjb3JuZXIifX1dXQ==
\[\begin{tikzcd}
	B && B \\
	& \bullet & B \\
	B & B & B
	\arrow["{c'}", from=1-1, to=1-3]
	\arrow["{d'}"', from=1-1, to=3-1]
	\arrow["\mu"{description}, from=2-2, to=1-1]
	\arrow[from=2-2, to=2-3]
	\arrow[from=2-2, to=3-2]
	\arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=2-2, to=3-3]
	\arrow["{c'}"', from=2-3, to=1-3]
	\arrow["{d'}", from=2-3, to=3-3]
	\arrow["{d'}", from=3-2, to=3-1]
	\arrow["{c'}"', from=3-2, to=3-3]
\end{tikzcd}\]
That is, cartesian $\mu$ exists in the above diagram where
$c' = c(\partial')^n\partial$ and $d' = d(\partial')^n\partial$.

{\bf Axiom 4}

Identities exist: There is a cartesian morphism $\iota : B \to B$ such that
$d' \iota = \rid$ and $c' \iota = \rid$.
The fact that $\iota$ is cartesian but not required to be the identity means
that it can `bump up the dimension' of a cell while leaving its extension the same.

{\bf Axiom 5}

$S$ and $B$ are univalent. Paths downstairs are the same thing
as bijections between fibers upstairs.

Actually, wait, is the definition of their univalence somewhat subtle?
I think I want to ask for a bijection between cells {\em over} their boundary
sphere, or likewise a bijection of spheres {\em over} their common boundary cells.

\section{Quantum Toy Model}
Gwillen asked me to document this thought, so here's my attempt.
\subsection{Discrete Markov}
Suppose I have a graph like
\begin{center}
\begin{tikzpicture}[x=1pt,y=1pt,yscale=-1,xscale=1]
  % Define coordinates
  \coordinate (v1) at (100,105);
  \coordinate (v2) at (243,112);
  \coordinate (v3) at (183,176.5);
  \coordinate (v4) at (300,176.5);

  % Draw triangle
  \draw (v1) -- (v2) -- (v3) -- cycle;
  \draw (v3) -- (v4);

  % Add dots at vertices
  \fill (v1) circle (2pt);
  \fill (v2) circle (2pt);
  \fill (v3) circle (2pt);
  \fill (v4) circle (2pt);

  % Add labels to vertices
  \node[above left]  at (v1) {$v_1$};
  \node[above right] at (v2) {$v_2$};
  \node[below left]  at (v3) {$v_3$};
  \node[below right] at (v4) {$v_4$};

  % Optional: Add edge labels
  \node[above=3pt]  at ($(v1)!0.5!(v2)$) {$e_{12}$};
  \node[above left]  at ($(v2)!0.5!(v3)$) {$e_{23}$};
  \node[below left]   at ($(v3)!0.5!(v1)$) {$e_{13}$};
  \node[below=3pt]   at ($(v3)!0.5!(v4)$) {$e_{34}$};
\end{tikzpicture}
\end{center}
whose vertices are the set $V = {v_1, v_2, v_3, v_4}$, and whose
(undirected) edges are labelled by nonnegative real numbers $e_{ij} \ge 0$.
As a matter of notational convention, we say $e_{ji} = e_{ij}$, so for
example $e_{21}$ is just another equivalent way of writing $e_{12}$.
It's not particularly important that $e_{14}$ and $e_{24}$ are zero, but it may be convenient to imagine
a graph that's somewhat sparse.

We can imagine that this graph is the setting for a dynamical system.
Suppose there exists a single particle in the universe,
and at any point in time it lives at one of the vertices $v_i$. During any small interval
$\Delta t$ of time it has probability of $ e_{ij} \Delta t$ of jumping to vertex $j$.

The probability distribution of the particle's position is a column vector $\vec p(t) = (p_1\ p_2\ p_3\ p_4)^\top$.
We've said that

\[ p(t + \Delta t) = (1 +  M \Delta t) p(t) \]
for the symmetric matrix
\[M = \left(\begin{array}{cccc}
-e_{12}-e_{13} & e_{12} & e_{13} & 0 \\
e_{12} & -e_{12}-e_{23} & e_{23} & 0 \\

e_{13} & e_{23} & -e_{13}-e_{23}-e_{34} & e_{34} \\
0 & 0 & e_{34} & -e_{34} \\
\end{array}\right) \]
\subsection{Continuous-Time Markov}
Therefore
\[ p( N \Delta t) = (1 +  M \Delta t)^N p(0)  \]
\[\lim_{N \to \infty} p( N (t/N)) = \lim_{N \to \infty}(1 +  M (t / N))^N p(0)  \]
\[ p( t) = \lim_{N \to \infty} (1 +  M t / N)^N p(0)  \]
and we have
 $p(t) = e^{Mt} p(0)$.
We could reason through somehow that the probability mass is preserved if $M$ is suitable.
\subsection{Quantum}
Now suppose $M$ is skew symmetric, and we have a directed graph like


\begin{center}
\begin{tikzpicture}[x=1pt,y=1pt,yscale=-1,xscale=1]
  % Define coordinates
  \coordinate (v1) at (100,105);
  \coordinate (v2) at (243,112);
  \coordinate (v3) at (183,176.5);
  \coordinate (v4) at (300,176.5);

  % Add dots at vertices
  \fill (v1) circle (2pt);
  \fill (v2) circle (2pt);
  \fill (v3) circle (2pt);
  \fill (v4) circle (2pt);

  % Draw triangle
  \draw[->, shorten >=5pt] (v1) -- (v2);
  \draw[->, shorten >=5pt] (v2) -- (v3);
  \draw[->, shorten >=5pt] (v1) -- (v3);
  \draw[->, shorten >=5pt] (v3) -- (v4);

  % Add labels to vertices
  \node[above left]  at (v1) {$v_1$};
  \node[above right] at (v2) {$v_2$};
  \node[below left]  at (v3) {$v_3$};
  \node[below right] at (v4) {$v_4$};

  % Optional: Add edge labels
  \node[above=3pt]  at ($(v1)!0.5!(v2)$) {$e_{12}$};
  \node[above left]  at ($(v2)!0.5!(v3)$) {$e_{23}$};
  \node[below left]   at ($(v3)!0.5!(v1)$) {$e_{13}$};
  \node[below=3pt]   at ($(v3)!0.5!(v4)$) {$e_{34}$};
\end{tikzpicture}
\end{center}
and the matrix I have in mind is
\[M = \left(\begin{array}{cccc}
0 & e_{12} & e_{13} & 0 \\
-e_{12} & 0 & e_{23} & 0 \\

-e_{13} & -e_{23} & 0 & e_{34} \\
0 & 0 & -e_{34} & 0 \\
\end{array}\right) \]
And the dynamics I expect is $p(t + \Delta t) = (1 + M \Delta t) p(t)$,
so still $p(t) = e^{Mt} p(0)$.
But now I have $M^\top = -M$, and I wish to show that $\| p(t) \|^2 = \| p(0) \|^2$.
This is the same as showing $p^\top(t) p(t) = p^\top(0) p(0)$, in other words we can reason
\[ (e^{Mt} p(0))^\top (e^{Mt} p(0)) =  p(0)^\top (e^{Mt})^\top e^{Mt} p(0)\]
\[ =  p(0)^\top e^{M^\top t} e^{Mt} p(0)\]
\[ =  p(0)^\top e^{-M t} e^{Mt} p(0)\]
\[ = p^\top(0) p(0) \]
as required.

Is one discrete step unitary? There we're comparing
\[ ((1 + M \Delta t) p(t))^\top  (1 + M \Delta t) p(t)\]
against
\[ p(t)^\top  p(t)\]
and we see
\[ ((1 + M \Delta t) p(t))^\top  (1 + M \Delta t) p(t) =
p(t) ^\top (1 + M \Delta t)^\top    (1 + M \Delta t) p(t)
\]
\[ = p(t) ^\top (1 - M \Delta t + M \Delta t + M^\top M \Delta t^2 ) p(t)  \]
so to first order, ignoring $\Delta t^2$, this is equal to
$ p^\top(t) p(t) $ as required.

\subsection{From Quantum to Classical}
We want to `observe the vector in the standard basis' on `every time step'.
How are we going to do this?

I want some kind of copy operator to some unused qubits, I guess a CNOT like
\[|00\rangle \langle 00| + |10\rangle\langle 11| +|00\rangle \langle 01| + |10\rangle\langle 10|  \]


What if I just have a system with two real states $|0\rangle$ and $|1\rangle$?
Then I have a single parameter $k$ for how fast they interchange.
If my initial state is $|0\rangle$ then my state at time $t$ is probably like
$|0\rangle \cos(kt) + |1\rangle \sin(kt)$.
We start with
\[ \psi(0) = |0\rangle \]
and then after one tick
\[ \psi(\Delta t) = |0\rangle  + |1\rangle \Delta t\]
and then we `copy' to the next qubit over to get
\[ \psi^*(\Delta t) = |00\rangle  + |11\rangle \Delta t\]
Ah! And now at the next tick we interfere less.
\[ \psi(2\Delta t) = (|00\rangle + |10\rangle \Delta t)  + (|11\rangle \Delta t - |01\rangle\Delta t^2)\]
And then we copy again:
\[ \psi^*(2\Delta t) = (|000\rangle + |110\rangle \Delta t)  + (|111\rangle \Delta t - |001\rangle\Delta t^2)\]
And then we evolve again:
\[ \psi(3\Delta t) = (|000\rangle + |100\rangle \Delta t) + (|110\rangle \Delta t - |010\rangle \Delta t^2)  + \]
\[ (|111\rangle \Delta t - |011\rangle \Delta t^2) - (|001\rangle\Delta t^2 + |101\rangle\Delta t^3)\]
So what we're accumulating is a sum over binary strings, where we pick up a factor of $\Delta t$ for every change
of a bit from $0 \to 1$, and a factor of $-\Delta t$ for every change  $1 \to 0$.
\vfil\eject.\vfil\eject.\vfil\eject.\vfil\eject
\end{document}
