\documentclass{article}
\usepackage[tmargin=0.05in, bmargin=0.05in]{geometry}
\input{theorem}
\input{prooftree}
\usepackage{relsize}
\usepackage{stmaryrd}
\usepackage{latexsym}
\usepackage{yfonts}
\usepackage{amsmath}
\usepackage[usenames,dvipsnames,svgnames,table]{xcolor}
\usepackage{tikz}
\usetikzlibrary{calc,arrows,cd,decorations.pathreplacing}
\usetikzlibrary{decorations.pathmorphing}
\usepackage{tcolorbox}
\tcbuselibrary{breakable}
\usepackage{listings}
\lstset{basicstyle=\ttfamily\footnotesize,breaklines=true}

\def\lint{{\textstyle\int}}
\def\isopen{\textcolor{orange}{\mathlarger{\mathlarger{\mathlarger{\textbf ?}}}}}
\def\isok{\textcolor{green}{\mathlarger{\mathlarger{\mathlarger{\checkmark}}}}}
\def\isbad{\textcolor{red}{\mathlarger{\mathlarger{\mathlarger{\x}}}}}
\def\chave{\eqno \textcolor{blue}{\hbox{have}}}
\def\cset{\eqno \textcolor{green}{\hbox{set}}}
\def\cwant{\eqno \textcolor{orange}{\hbox{want}}}
\def\gol{\sqsubset}
\def\gor{\sqsupset}

\def\sp{\bullet}
\def\ot{\leftarrow}
\def\prequiv{\dashv\vdash}
\def\fdom{{\mathbf{d}f}}
\def\fcod{{\mathbf{e}f}}
\def\fidom{\mathbf{\bar d}f}
\def\ficod{\mathbf{\bar e}f}

\def\thn{\mathrel|}
\def\coe{\mathsf{coe}}
\def\bpush{\mathbf{push}}
\def\bpull{\mathbf{pull}}

\def\wo{\setminus}
\def\fA{\mathsf{A}}
\def\fC{\mathsf{C}}
\def\fX{\mathsf{X}}
\def\ff{\mathsf{f}}
\def\fm{\mathsf{m}}
\def\rspan{\mathsf{Span}}
% \def\El#1{\mathsf{El}({#1})}
\def\El#1{\ulcorner{#1}\urcorner}
\def\U{\mathsf{U}}
\def\uu{\mathsf{u}}
\def\uni{\U}
\def\mor#1#2{#1 \to \underline{#2}}

\def\ridp{\mathsf{idp}}
\def\ssem#1{\langle\!\langle{#1}\rangle\!\rangle}

\definecolor{lred}{rgb}{0.95,0.8,0.8}
\definecolor{cyan}{rgb}{0.80,0.95,0.95}
\definecolor{lorange}{rgb}{0.95,0.90,0.80}
\definecolor{bluegray}{rgb}{0.6,0.6,0.85}
\definecolor{lgray}{gray}{0.9}
\newtcolorbox{declbox}{colframe=lred,colback=lred,grow to right by=-10mm,grow to left by=-10mm,
boxrule=0pt,boxsep=0pt,breakable}
\newtcolorbox{thmbox}{colframe=cyan,colback=cyan,grow to right by=-10mm,grow to left by=-10mm,
boxrule=0pt,boxsep=0pt,breakable}
\newtcolorbox{defnbox}{colframe=lorange,colback=lorange,grow to right by=-10mm,grow to left by=-10mm,
boxrule=0pt,boxsep=0pt,breakable}
\newtcolorbox{tangentbox}{colframe=lgray,colback=lgray,grow to right by=-10mm,grow to left by=-10mm,
boxrule=0pt,boxsep=0pt,breakable}

\input{linear}
\def\rpath#1{[#1]}
\def\rfst{\mathsf{fst}\,}
\def\rsnd{\mathsf{snd}\,}
\def\bunfold{\mathbf{unfold}}
\def\bfold{\mathbf{fold}}
\def\susp#1{\langle {#1} \rangle}
\def\ssusp#1{\langle\!\langle {#1} \rangle\!\rangle}
\def\dto{\mathrel{\dot\to}}
\def\dns{{\downarrow}}
\def\ups{{\uparrow}}
\def\sprov{\Vdash}
\def\signat{{\color{red}\Sigma}}
\def\ep#1{\underline{#1}}
\def\wat{\mathbin{@}}
\def\wwat{\mathbin{\underline\wat}}
\def\cn{{:}}
\def\dv{{\div}}
\def\ww{{\mathsf w}}
\def\base{{\textfrak b}}

\def\munit{I}
\def\tt{{\mathsf t}}
\def\ii{{\mathbb I}}
\def\T{\mathbb{T}}
\def\tw{\mathsf{Tw}}
\def\sw#1{^{#1}_{#1}}
\def\TP{\mathbf{TPre}}
\def\pp{\textsf{\textbf p}}
\def\nn{{\mathsf n}}
\def\PP{\textsf{\textbf P}}
\def\NN{\textsf{\textbf N}}
\def\zz{{\mathsf z}}
\def\sem#1{[\![#1]\!]}
\def\usem#1{\lceil\!\!\lceil{#1}\rceil\!\!\rceil}
\def\zem#1{\langle\!\langle#1\rangle\!\rangle}
\def\col#1{{\mathsf{C}}_{#1}}
\def\lax{\mathop\bigcirc}
\def\rjust{\mathsf{just}}
\def\rcvt{\mathsf{cvt}}
\def\rtype{\mathsf{type}}
\def\rdtype{\mathsf{disc}}
\def\rkind{\mathsf{kind}}
\def\rmode{\mathsf{mode}}
\def\rprel{\mathbf{Prel}}
\def\rrfam{\mathbf{Rfam}}
\def\rset{\mathbf{Set}}
\def\rfinset{\mathbf{FinSet}}
\def\rrel{\mathbf{Rel}}
\def\rcat{\mathbf{Cat}}
\def\rfam{\mathbf{Fam}}
\def\binj{\mathbf{inj}}
\def\rid{\mathsf{id}}
\def\rtrue{\mathrel\mathrm{true}}
\def\pbck{\ar[dr, phantom, pos=0, "\lrcorner"]}
\def\bpbck{\ar[ddrr, phantom, pos=0, "\lrcorner"]}
\def\erule#1#2{\begin{prooftree}#1\justifies #2\end{prooftree}}
\def\lpar{\bindnasrepma}
\def\lamp{\binampersand}
\def\btwo{\mathbf{2}}
\def\bone{\mathbf{1}}

\newarrow {Equiv} =====
\def\FinSet{\mathbf{FinSet}}
\def\x{\times}
\def\maps{\ar[dd,mapsto,shorten <=2em, shorten >=2em]}
\def\mapt{\ar[ddd,mapsto,shorten <=2em, shorten >=2em]}
\def\A{\mathbf{A}}
\def\B{\mathbf{B}}
\def\C{\mathbf{C}}
\def\G{\mathbf{G}}
\def\D{\mathbf{D}}
\def\DD{\mathbb{D}}
\def\E{\mathbf{E}}
\def\M{\mathbf{M}}
\def\pair#1#2{\langle#1,#2\rangle}
\def\ltri{{\lhd}}
\def\rtri{{\rhd}}
\def\tri{\rhd}
\def\ll{{<}}
\def\rr{{>}}
\def\cc{\mathsf{c}}
\def\dd{\mathsf{d}}
\def\o{\circ}
\def\rctx{\,\mathsf{ctx}}
\def\rdctx{\,\mathsf{dctx}}
\def\del{\partial}
\def\also#1{\ \textcolor{blue}{\celse #1}}
\newcounter{nodemaker}
\setcounter{nodemaker}{0}
\def\twocell#1#2{%
  \global\edef\mynodeone{twocell\arabic{nodemaker}}%
  \stepcounter{nodemaker}%
  \global\edef\mynodetwo{twocell\arabic{nodemaker}}%
  \stepcounter{nodemaker}%
  \ar[#1,phantom,shift left=3,""{name=\mynodeone}]%
  \ar[#1,phantom,shift right=3,""'{name=\mynodetwo}]%
  \ar[Rightarrow,#2,from=\mynodeone,to=\mynodetwo]%
}
\def\twocellswap#1#2{%
  \global\edef\mynodeone{twocell\arabic{nodemaker}}%
  \stepcounter{nodemaker}%
  \global\edef\mynodetwo{twocell\arabic{nodemaker}}%
  \stepcounter{nodemaker}%
  \ar[#1,phantom,shift right=3,""{name=\mynodeone}]%
  \ar[#1,phantom,shift left=3,""'{name=\mynodetwo}]%
  \ar[Rightarrow,#2,from=\mynodeone,to=\mynodetwo]%
}
\def\maps{\ar[dd,mapsto,shorten <=2em, shorten >=2em]}
\author{Jason Reed}
\definecolor{fib}{HTML}{ff7f00}
\definecolor{green}{HTML}{007f00}
\definecolor{red}{HTML}{df3f3f}
\definecolor{opfib}{HTML}{007fff}

% For lightening colors I used
% http://trycolors.com/ 6 parts white to 1 part color
\definecolor{opfibl}{HTML}{DBEDFF}
\definecolor{greenl}{HTML}{DBEDDB}
\definecolor{redl}{HTML}{FAE4E4}
\def\njudge#1{\fcolorbox{opfib}{white}{#1}}
\def\nrule#1{\fcolorbox{white}{opfibl}{#1}}
\def\neqn#1{\fcolorbox{white}{redl}{#1}}



\def\judge#1{\vskip 2em\noindent \njudge{$#1$}\vskip 0.5em\noindent}
\def\rule#1{\vskip 2em \noindent \nrule{$#1$}\vskip 0.5em\noindent}
\def\eqn#1{\vskip 2em \noindent \neqn{$#1$}\vskip 0.5em\noindent}
\def\prof{\nrightarrow}
\def\tensor{\otimes}
\def\htensor{\mathrel{\hat\otimes}}
\def\lol{\multimap}
\def\hlol{\mathrel{\hat\multimap}}
\def\wtf{{\color{red}???}}

\def\re{\mathbf{E}}
\def\sh{\sharp}
\def\shp{\mathrel{\sharp}}
\def\zero{\texttt{0}}
\begin{document}

\def\
\tikzset{
   commutative diagrams/.cd,
   arrow style=tikz,
   diagrams={>=stealth}}

\def\doubs#1{{}^{{#1}^\op}_{\x {#1}}}
\def\doub#1{{#1}^\op \x {#1}}

\section{Towards a Quasinaturality Condition}
For $\nu\mu  ::=  \ups \celse \dns$, and
$s  ::=  {+} \celse {-}$, and
\[\tau \quad =\qquad \begin{tikzcd}
  d \ar[d, "\ll \tau"']\ar[r]& e\ar[from=d, "\rr\tau"']\\
d'\ar[r] &e'
\end{tikzcd}\]

 we define
a symbol $\nu_\tau^s(u)$
by
\[\ups_{\tau}^+(u) = {}_{u^e_d}^{u^{e'}_{d'}} \qquad \ups_{\tau}^-(u) = {}_{u^d_e}^{u^{d'}_{e'}}\]
\[\dns_{\tau}^+(u) = {}^{u^d_e}_{u^{d'}_{e'}} \qquad \dns_{\tau}^-(u) = {}^{u^e_d}_{u^{e'}_{d'}}\]

Perhaps of these four should be thought of as a functor $\tw(\tw(\C)) \to \doubs \D$,
(or, I guess, for all I know, $\tw(\C)^\to \to \doubs \D$,
but my gut tells me iterated-twisted-category is somehow more
plausible) assuming $u$ is a functor $\doubs \C \to \D$, and the rest
are various dualization choices relative to that.

The big diagram that's supposed to represent what this is good for is
\[
\begin{tikzcd}
A^{et\sw d}_{dt\sw d}\ar[from=dd]\ar[r]
&A\sw{d t \sw d} \ar[d]\ar[r, "N_d"]
&[2em]B\sw{d u\sw d}\ar[from=d]
&B^{d u\sw d}_{e u\sw d}\ar[from=l]\ar[dd]
\\
&A^{d}_d \nu^-_{\ltri f }(t) \ar[r, "N_{\ltri f}"] & B^{d}_d \mu^+_{\ltri f }(u)
\\
\int_a A^{ea}_{da}\ar[r]
&  A^{e}_{d} \nu^-_{\rid_f}(t)\ar[u]\ar[d]\ar[r, "N_{\rid_f}" description]
&B^{d}_{e} \mu^+_{\rid_f}(u) \ar[from=u]\ar[from=d]
&\int^b B^{db}_{eb}\ar[from=l]
\\
& A^{e}_{e} \nu^-_{\rtri f }(t) \ar[r, "N_{\rtri f}"'] & B^{e}_{e} \mu^+_{\rtri f }(u)
\\
A^{et\sw e}_{dt\sw e}\ar[from=uu]\ar[r]
&A\sw{e t \sw e} \ar[u]\ar[r, "N_e"']
&B\sw{e u\sw e}\ar[from=u]
&B^{d u\sw e}_{e u\sw e}\ar[from=l]\ar[uu]
\end{tikzcd}
\]

A semantic proof object for a sequent
\[ [t^x_x/a]^\nu A^{xa}_{xa} \prov [u^x_x/b]^\mu B^{xb}_{xb}\]
is supposed to be some data for each $\tau$
\[ N_\tau : A^{e'}_{d'} \nu^-_\tau(t) \to B^{d'}_{e'} \mu^+_\tau(u) \]
such that
\[
\begin{tikzcd}
  A^{d'}_{d} \nu^-_{\rid_{\ll\tau}}(t)\ar[d]\ar[r, "N_{\rid_{\ll\tau}}"]
&[4em]B^{d}_{d'} \mu^+_{\rid_{\ll\tau}}(u) \ar[from=d]
\\
 A^{e'}_{d'} \nu^-_{\tau }(t) \ar[r, "N_{\tau}" description] & B^{d'}_{e'} \mu^+_{\tau }(u)
\\
  A^{e}_{e'} \nu^-_{\rid_{\rr\tau}}(t)\ar[u]\ar[r, "N_{\rid_{\rr\tau}}"']
&[4em]B^{e'}_{e} \mu^+_{\rid_{\rr\tau}}(u) \ar[from=u]
\end{tikzcd}
\]
And I reckon this is a `for every object in $\tw(\tw(\C))$' kind of condition.
There's some `reduction' that those two twisted arrow category constructions
are eligible for, but they're not quite the same. The inner
 `reduced' twisted arrow category need only have the morphisms
that relate morphism-objects to their domain and codomain, and the outer
one needs only the ones that relate a $\tau$ to its
$\rid_{\ll \tau}$ and $\rid_{\rr \tau}$.

Actually, no, that doesn't quite work. For the sake of this immediately below
discussion, name things like
\[\tau \quad =\qquad \begin{tikzcd}
  x \ar[d, "\iota"']\ar[r, "s"]& y\ar[from=d, "\omega"']\\
d\ar[r, "g"'] &e
\end{tikzcd}\]
I can't construe $\rid_\iota$
as a sub-arrow of $\tau : s \to g$, because although $\iota$ is a subarrow of $g$,
I don't have that $g$ is not a subarrow of $\iota$.

However... I could consider $\rid_{\omega g}$ or $\rid_{g \iota}$ to be subarrows of $\tau$,
couldn't I? Yeah:
\[\tau \quad =\qquad \begin{tikzcd}
  x \ar[d, "\iota"']\ar[r, "s"]& y\ar[from=d, equal]\\
d\ar[r, "\omega g" description] \ar[d, equal]&y \ar[d, equal]
\\
d\ar[r, "\omega g" description] \ar[d, equal]&y\ar[from=d, "\omega"']
\\
d\ar[r, "g"'] &e
\end{tikzcd}
\qquad
 =\qquad \begin{tikzcd}
  x \ar[d, equal]\ar[r, "s"]& y\ar[from=d, "\omega"']\\
x\ar[r, "g \iota" description] \ar[d, equal]&e \ar[d, equal]
\\
x\ar[r, "g \iota" description] \ar[d, "\iota"']&e\ar[from=d, equal]
\\
d\ar[r, "g"'] &e
\end{tikzcd}\]
And {\em for in particular} $\lhd f$ and $\rhd f$, the appropriate choice of these
is going to turn out to be $\rid_{\rid_d}$ or $\rid_{\rid_e}$ as required.

And for sure $\rid_g$ is a subarrow of $\tau$:
\[\tau \quad =\qquad \begin{tikzcd}
  x \ar[d, "\iota"']\ar[r, "s"]& y\ar[from=d, "\omega"']\\
d\ar[r, " g" description] \ar[d, equal]&e \ar[d, equal]
\\
d\ar[r, " g" description] \ar[d, equal]&e\ar[from=d, equal]
\\
d\ar[r, "g"'] &e
\end{tikzcd}\]
So perhaps the real requirement is that whenever $\sigma$ is (at least a certain sort of
subarrow) of $\tau$, shaped like
\[
\begin{tikzcd}
x \ar[ddd]\ar[rrr]\ar[dr] &&& y\ar[from=ddd]\ar[from=dl]
\\
&x'\ar[r]\ar[d] &y'\ar[from=d]
\\
&d' \ar[dl]\ar[r]&e'\ar[from=dr]
\\
d \ar[rrr] &&& e
\end{tikzcd}
\]
with $\tau$ being the outer square, and $\sigma$ being the inner,
 then we require
\[
\begin{tikzcd}
 A^{e}_{d} \nu^-_{\tau }(t) \ar[r, "N_{\tau}" description] & B^{d}_{e} \mu^+_{\tau }(u)
\\
  A^{e'}_{d'} \nu^-_{\sigma}(t)\ar[u]\ar[r, "N_{\sigma}"']
&B^{d'}_{e'} \mu^+_{\sigma}(u) \ar[from=u]
\end{tikzcd}
\]
Aha, now it's easier to check that setting
\[\ups_{\tau}^+(u) = {}_{u^y_x}^{u^{e}_{d}} \qquad \ups_{\tau}^-(u) = {}_{u^x_y}^{u^{d}_{e}}\]
\[\dns_{\tau}^+(u) = {}^{u^x_y}_{u^{d}_{e}} \qquad \dns_{\tau}^-(u) = {}^{u^y_x}_{u^{e}_{d}}\]
does in fact give me at least the
{\em existence} of the arrows on the left and right sides of this diagram.

\subsection{How Is This a Natural Transformation?}
It certainly seems like it should be one, somehow.
For every {\em object} (e.g. $\tau, \sigma$) of $\tw(\tw(\C))$, we get
the data $N_\tau$, $N_\sigma$, etc. And for every morphism $\tau \to \sigma$,
we get a commutativity requirement. What's the target category of the functors
that $N$ is a natural transformation between? Is it just $\rset$? To the extent
that I'm thinking of $A$ and $B$ as functors $\doubs \C \x \doubs \D \to \rset$, I suppose so.
Ok, so then, yeah, when I write
\[B^d_e \mu^+_\tau(t)\]
that should be thought of as a functor $\tw(\tw(\C)) \to \rset$,
remembering that $t : \doubs \D \to \C$. I observe now that just as I
increased generality by splitting the polarity choice $\nu$ into $\nu$
and $\mu$ since I figured those choices could be made independently on the left
and right side of the turnstile, I figure I could talk about $t$ and $u$ as coming
from different categories, saying $t : \doubs \D \to \C$ and $u : \doubs \E \to \C$
and saying $A : \doubs \C \x\doubs \D \to \rset$ and $B : \doubs \C \x \doubs \E\to \rset$.
I think I'm going to take a pass on doing that for right now; I don't think that extra
generality is of any help to me having clear thoughts at the moment, but it must
eventually fall out of the more general case where I have lots
of substitutions for lots of disparate variables.

Ok, let's pick apart some things, now. When I have
\[\tau \quad =\qquad \begin{tikzcd}
  x \ar[d, "\iota"']\ar[r, "s"]& y\ar[from=d, "\omega"']\\
d\ar[r, " g" description] &e
\end{tikzcd}\]
I want to claim that projecting out the $d$-object is a functor $\tw^2(\C) \to \C^\op$.
For if I have a morphism $\tau \to \sigma$ in $\tw^2(\C)$, like
\[
\begin{tikzcd}
x \ar[ddd]\ar[rrr]\ar[dr] &&& y\ar[from=ddd]\ar[from=dl]
\\
&x'\ar[r]\ar[d] &y'\ar[from=d]
\\
&d' \ar[dl]\ar[r]&e'\ar[from=dr]
\\
d \ar[rrr] &&& e
\end{tikzcd}
\]
then I get a morphism from $\sigma$'s d --- namely, $d'$ --- to $\tau$'s. Ok, good, likewise
projecting $e$ and $x$ are covariant, and $y$ is also contravariant.
Ok, now I can reason that $u^d_e$ represents a functor $\tw^2(\C) \to \D$, if
I think of the symbols $d$ and $e$ as projections from the ambient input $\tau$.
Now I want to check that $u^x_y : \tw^2(\C) \to \D^\op$.

This makes me slightly confused. Let's recall what constructions are generally available.
If $F : \C \to \D$, then $F^\op : \C^\op \to \D^\op$. If $F : \C \to \D$ and $G: \C \to \E$,
then $\pair F G : \C \to \D \x \E$. There exist
functors $\dom : \tw(\C) \to \C$ and $\cod : \tw(\C) \to \C^\op$ if I use the convention I've
been using here that $\tw$ goes from supermorphism to submorphism.

Okay, doing {\texttt{2018-07-23.agda}} helps a bit. $A$ and $B$ are indeed functors
$\doubs \C \x \doubs \D \to \rset$. From them we construct functors
$\tw^2(\C) \to \rset^\op$ and $\tw^2(\C) \to \rset$. In general if we have
$F : \C \to \D^\op$ and $G : \C \to \D$ there's an evident notion of `natural transformation'
from $F$ to $G$, namely an assignment of morphisms $X \mapsto \alpha_X : FX \to GX$ such
that
\[
\begin{tikzcd}
FX \ar[r, "\alpha_X"]\ar[from=d, "Ff"]& GX\ar[d, "Gf"]\\
FY \ar[r, "\alpha_Y"']& GY
\end{tikzcd}
\]
always commutes in $\D$ for any $f : X \to Y \in \C$. Oh, I guess what I'm expected
to do is regard $F$ as $\C^\op \to \D$ and realize that this is a dinatural transformation, with
hexagon
\[
\begin{tikzcd}
&F^X \ar[r, "\alpha_X"]\ar[from=dl, "F^f"]& G_X\ar[dr, "G_f"]\\
F^Y &&& G_Y\\
&F^Y \ar[r, "\alpha_Y"]\ar[from=ul, equal]& G_Y\ar[ur, equal]
\end{tikzcd}
\]

Okay, so I guess that's my answer. What I'm claiming $N$ has to be is
a dinatural transformation from one functor to another. The real game I have
to play is articulating the constructions
\[ \doubs \C \x \doubs \D \to \rset \qquad \mapsto_{\mu, t} \qquad \tw^2(\C)^\op \to \rset\]
\[ \doubs \C \x \doubs \E \to \rset \qquad \mapsto_{\nu, u} \qquad \tw^2(\C) \to \rset\]
for which what's really essential is
\[ \tw^2(\C)^\op  \qquad \mapsto_{\mu, t} \qquad \doubs \C \x \doubs \D \]
\[ \tw^2(\C)  \qquad \mapsto_{\nu, u} \qquad \doubs \C \x \doubs \E \]

\end{document}
