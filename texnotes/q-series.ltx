\documentclass{article}

\usepackage{environ}
\usepackage{ytableau}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{hyperref}
\usepackage{xcolor}
\hypersetup{
    colorlinks,
    linkcolor={blue!90!black},
    citecolor={blue!50!black},
    urlcolor={blue!80!black}
}
\input{theorem}
\allowdisplaybreaks

\input{prooftree}
\def\erule#1#2{\begin{prooftree}#1\justifies #2\end{prooftree}}

\usepackage{tikz}
\usepackage{tikz-cd}
\definecolor{green}{HTML}{007f00}
\definecolor{cyan}{HTML}{007f7f}
\definecolor{purple}{HTML}{af00af}
\def\rr#1{{\color{red}\mathbf {#1}}}
\def\bb#1{{\color{blue}\mathbf{#1}}}
\def\Z{\mathcal A}
\def\adjust{\big|}
\def\O{\mathcal{O}}
\def\rid{\mathsf{id}}
\def\bd{\partial}
\def\prov{\vdash}
\def\prequiv{\dashv\vdash}
\def\imp{\Rightarrow}
\def\cqed{\hskip2mm{\vrule width .5em height .5em depth 0em}} % at the end of a |P.
\def\o{\circ}
\def\N{\mathbb{N}}
\def\R{\mathbb{R}}
\def\x{\times}
\def\st{\mathrel|}
\def\rset{\mathbf{Set}}
\def\op{\mathsf{op}}
\def\P{\mathbf{P}}
\def\dash{\hbox{---}}
\def\deg{\mathop{\mathsf{deg}}}
\def\celse{\mathrel{|}}
\def\cn{{:}}
\def\rok{\mathrel\mathsf{ok}}
\def\sub{\subseteq}

\newenvironment{nstabbing}
  {\setlength{\topsep}{-\parskip}%
   \setlength{\partopsep}{0pt}%
   \vskip-2em\hphantom{.}%
   \tabbing}
  {\endtabbing}
% LOL https://tex.stackexchange.com/questions/598862/adding-the-hyperref-packages-causes-errors
\def\MakeUppercaseUnsupportedInPdfStrings{\scshape}
\def\poch#1#2{\left(#1;#2\right)_\infty}
\def\pochn#1#2{\left(#1;#2\right)}
\def\tick{{\vphantom{\sum}}'}

\title{$q$-Series Notes}
\author{Jason Reed}
\begin{document}
\maketitle
\tikzset{
   commutative diagrams/.cd,
   arrow style=tikz,
   diagrams={>=stealth}}


\newif\ifshowall

% Decide whether to hide everything
%\showalltrue

\NewEnviron{hide}{\ifshowall\expandafter\BODY\else {\color{gray} $\cdots$ hidden $\cdots$ } \fi}


\section{Introduction}
\begin{hide}
This is a little \LaTeX sandbox for learning about $q$-series.
\end{hide}
\section{Jacobi Triple Product}
\begin{hide}
I understand it to be the case that

\[\poch{-a}{ab}\poch{-b}{ab}\poch{ab}{ab} = \sum_{n=-\infty}^{\infty} a^{n(n+1)\over 2}b^{n(n-1)\over 2}\]

Expanding out a few terms, I see this is the same as

\[((1+a)(1+a^2b)(1+a^3b^2)\cdots)((1+b)(1+ab^2)(1+a^2b^3)\cdots)\]
\[((1-ab)(1-a^2b^2)(1-a^3b^3)\cdots) = \sum_{n=-\infty}^{\infty} a^{n(n+1)\over 2}b^{n(n-1)\over 2}\]
So I think I should find that

\[((1+a)(1+a^2b)(1+a^3b^2)\cdots)((1+b)(1+ab^2)(1+a^2b^3)\cdots)\]
\[ = {1\over (1-ab)(1-a^2b^2)(1-a^3b^3)\cdots}\sum_{n=-\infty}^{\infty} a^{n(n+1)\over 2}b^{n(n-1)\over 2}\]

Let's try to interpret this combinatorially. The coefficient of $a^pb^m$ is somehow telling us that
we're trying to form partitions of $p$ things colored $a$ and $m$ things colored $b$. On the lhs of
the equation, we know that we can form parts which have the property that either they have one excess
$a$ or one excess $b$. On the rhs, what we're doing is analyzing the difference $p-m$, which
points us in the direction of a single term of the sum
\[\sum_{n=-\infty}^{\infty} a^{n(n+1)\over 2}b^{n(n-1)\over 2}\]
and asks us to partition the remainder of the elements into $ab$ pairs.

For example, let's consider the $a^3b^5$ term. We set $n = p-m = -2$. We're looking for
the $a^3b^5$ coefficient of
\[  {1\over (1-ab)(1-a^2b^2)(1-a^3b^3)\cdots} (ab^3)\]
which is asking us to find a partition of 2 on top of $ab^3$. So there should be two ways of partitioning
$a^3b^5$ using unique off-by-one chunks. And indeed there are: $(a^3b^4)b$ and $(a^2b^3)(ab^2)$.

What about $a^5b^7$? We should subtract off the same $ab^3$, and we should have as many ways to partition
as there are the 5 partitions of 4. I count:

\[ (a^3b^4)(a^2b^3), (a^4b^5)(ab^2),  (a^5b^6)b,  (a)(b)(a^3b^4)(ab^2), (a^2b)(b)(a^2b^3)(ab^2)  \]
I could also notate this as
\[ (43), (52), (61), (421\bar 1), (32\bar 21)  \]
where the barred part $\bar n$ counts as weight $n-1$. In this case I'm requiring that the unbarred parts minus
the barred parts equals $m-p$.

Ok, so which coefficients are bijective with exactly the 5 partitions of 4? It's going to be $a^4b^4$ times
any of the consecutive triangular $\ldots, a^6b^3, a^3b, a, 1, b, ab^3, a^3b^6, \ldots$. Therefore I want to look at
extended partitions of
\[\ldots, a^{10}b^7, a^7b^5, a^5b^4, a^4b^4, a^4b^5, a^5b^7, a^7b^{10}, \ldots\]
Ok so I already established
\[ a^5b^7 \leftrightarrow (43), (52), (61), (421\bar 1), (32\bar 21) \]
So I can extend this to
\[ a^7b^5 \leftrightarrow (\bar 4\bar 3), (\bar5 \bar2), (\bar6\bar1), (\bar4\bar21\bar 1), (\bar32\bar 2\bar 1) \]
\[ a^4b^4 \leftrightarrow (4\bar 1), (3\bar 2), (\bar 4 1), (\bar 3 2), (2\bar 2 1 \bar 1) \]
\[ a^4b^5 \leftrightarrow  (5), (41\bar 1),(32\bar 1), (3\bar 2 1), (\bar 3 2 1) \]
\[ a^5b^7 \leftrightarrow (43), (52), (61), (421\bar 1), (32\bar 21) \]
\[ a^7b^{10} \leftrightarrow (532), (541), (631), (721), (4321\bar 1)\]
\[ a^{10}b^{14} \leftrightarrow (5432), (7421), (6431), (8321), (6521) \]
Oof this is a mess. Let's try something simpler. Let's consider just the things that result in 0-partitions.
\[\ldots, a^6b^3, a^3b, a, 1, b, ab^3, a^3b^6, \ldots\]
These should be unique.
\[a^3b \leftrightarrow (\bar 2\bar 1)\]
\[a \leftrightarrow (\bar 1)\]
\[1 \leftrightarrow ()\]
\[b \leftrightarrow (1)\]
\[ab^3 \leftrightarrow (21)\]
\[a^3b^6 \leftrightarrow (321)\]
Ok, I understand this.
Next, 1-partitions: This is
\[\ldots, a^7b^4, a^4b^2, a^2b, ab, ab^2, a^2b^4, a^4b^{7}, \ldots\]
These should still be unique.
\[ab \leftrightarrow (1\bar 1)\]
\[ab^2 \leftrightarrow (2)\]
\[a^2b^4 \leftrightarrow (31)\]
\[a^4b^7 \leftrightarrow (421)\]
\[a^7b^{11} \leftrightarrow (5321)\]
Ok I think I get this.
Next, 2-partitions: This is
\[\ldots, a^8b^5, a^5b^3, a^3b^2, a^2b^2, a^2b^3, a^3b^5, a^5b^{8}, \ldots\]
These should come in pairs.
\[a^2b^2 \leftrightarrow (2\bar 1), (\bar 21)\]
\[a^2b^3 \leftrightarrow (3),(21\bar 1)\]
\[a^3b^5 \leftrightarrow (41),(32)\]
\[a^5b^8 \leftrightarrow (521),(431)\]
\[a^8b^{12} \leftrightarrow (6321),(5421)\]
Ah! Beginning to see a pattern asymptotically. If I look at the
$a^{10}b^{14}$ patterns, and subtract $(4321)$ from each of them, I
get $(1111),(3100),(2110),(4000),(2200)$. That is just the 5 partitions of 4. So I think I just need to
understand how the bars work.

I think I have, e.g.

\[(532) = (321) + (211)\]
\[(541) = (321) + (220)\]
\[(631) = (321) + (310)\]
\[(721) = (321) + (400)\]
\[(4321\bar 1) = (321) + (1111)\]
and then
\[(43) = (21) + (22)\]
\[(52) = (21) + (31)\]
\[(61) = (21) + (40)\]
\[(421\bar 1) = (21) + (211)\]
\[(32\bar 21) = (21) + (1111)\]
and then
\[(5) = (1) + (4)\]
\[(41\bar 1) = (1) + (31)\]
\[(32\bar 1) = (1) + (211)\]
\[(3\bar 2 1) = (1) + (22)\]
\[(\bar 3 2 1) = (1) + (1111)\]

\subsection{Claim}
Let $U(A,B)$ be the set of {\em unique off-diagonal partitions of $(A,B)$}, that is,
the set of finite sets of pairs $(a_i,b_i)$ such that $|a_i - b_i| =1$ for all $i \in I$, and
$A =\sum_{i} a_i$ and $B = \sum_i b_i$.
For example,
\[\{(1,2),(2,1),(10,9),(11,10)\} \in U(24,22)\]
Let $P(n)$ be the partitions of $n$, i.e. the set of finite multisets whose sum is $n$.

I claim there is a bijection
\[U(A,B) \cong P\left(A + B - (A - B)^2\over 2\right)\]

From this we deduce

\[ \poch{-a}{ab} \poch{-b}{ab} = \left(\sum_{n=-\infty}^\infty a^{n(n+1)\over 2}b^{n(n-1)\over 2}\right){1\over \poch{ab}{ab} }\]
\vfil\eject
\end{hide}




\section*{Stirling Numbers}
\begin{hide}
% Here's a recipe for how to get the stirling numbers.

If we generalize the $q$-Pochhammer symbol to $(a;q)_\infty$ to allow $a$ to
be an operator, defining it explicitly with the order\footnote{as opposed to $q^na$}
\[   \poch{a}{q} = \prod_{n=0}^\infty (1 - aq^n)\]
As usual we we say
\[(a; q)_n = {(a; q)_\infty \over (aq^n; q)_\infty} = (1-a)(1-aq)\cdots (1-aq^{n-1})\]
Now we can consider
 \[\pochn{-tq{\partial\over\partial q}}{q}_n = (1 + tq)(1 + 2tq^2)(1 + 3tq^3) \cdots (1 + ntq^n)\]
\def\,{$&$}
\def\pp{\, + \,}
\[\begin{tabular}{ll*{6}{l@{\ \ }}}
$(n=1) \, 1 \pp tq$\\
$(n=2) \, 1 \pp t(q+2q^2) \pp t^2(2q^3)$\\
$(n=3) \, 1 \pp t(q+2q^2+3q^3) \pp  t^2(2q^3+3q^4+6q^5) \pp 6t^3q^6$\\
\end{tabular}\]
The coefficient $t^kq^m$ in polynomial $n$ counts partitions of $m$ with $k$
parts of distinct lengths $\le n$, where one element of each part is
distinguished. So the $n=3$ polynomial describes for example
\def\spacer{\rule{0pt}{\normalbaselineskip}}
\ytableausetup{boxsize=1em}
\[\begin{tabular}{|l|l|}
\hline
$1$ &\spacer $\emptyset$\\
\hline
$tq$ &\spacer \(\ydiagram[ \bullet]{1}*{1} \)\\
$2tq^2$ &\spacer \(\ydiagram[ \bullet]{1}*{2}\quad
\ydiagram[ \bullet]{1+1}*{2}
\)\\
$3tq^3$ &\spacer \(\ydiagram[ \bullet]{1}*{3}\quad
\ydiagram[ \bullet]{1+1}*{3}\quad
\ydiagram[ \bullet]{2+1}*{3}\)\\
\hline
$2t^2q^3$ &\spacer \(\ydiagram[ \bullet]{1,1}*{2,1}\quad
\ydiagram[ \bullet]{1+1,1}*{2,1}
\)\\
$3t^2q^4$ &\spacer \(\ydiagram[ \bullet]{1,1}*{3,1}\quad
\ydiagram[ \bullet]{1+1,1}*{3,1}\quad
\ydiagram[ \bullet]{2+1,1}*{3,1}\)\\
$6t^2q^5$ & \spacer \(
\ydiagram[ \bullet]{1,1}*{3,2}\quad
\ydiagram[ \bullet]{1+1,1}*{3,2}\quad
\ydiagram[ \bullet]{2+1,1}*{3,2}\quad
\ydiagram[ \bullet]{1,1+1}*{3,2}\quad
\ydiagram[ \bullet]{1+1,1+1}*{3,2}\quad
\ydiagram[ \bullet]{2+1,1+1}*{3,2}
\)\\
&\\
\hline
$6t^3q^6$ & \spacer \(
\ydiagram[ \bullet]{1,1,1}*{3,2,1}\quad
\ydiagram[ \bullet]{1+1,1,1}*{3,2,1}\quad
\ydiagram[ \bullet]{2+1,1,1}*{3,2,1}\quad
\ydiagram[ \bullet]{1,1+1,1}*{3,2,1}\quad
\ydiagram[ \bullet]{1+1,1+1,1}*{3,2,1}\quad
\ydiagram[ \bullet]{2+1,1+1,1}*{3,2,1}
\)\\
&\\
\hline
\end{tabular}\]


If we substitute $q \leftarrow 1$, we get
\[\begin{tabular}{ll*{6}{l@{\ \ }}}
$(n=1) \, 1 \pp t$\\
$(n=2) \, 1 \pp 3t \pp 2t^2$\\
$(n=3) \, 1 \pp 6t \pp  11t^2 \pp 6t^3$\\
\end{tabular}\]
i.e. the Stirling numbers of the first kind.
\end{hide}


\section{Trying To Understand Modular Forms a Bit}

So we start with
\[\wp(z,\Lambda) = {1\over z^2} + \sum_{\lambda \in \Lambda}\tick \left({1\over (z-\lambda)^2} - {1\over \lambda^2}\right)\]
and we try to figure out its Laurent series.
\[ = {1\over z^2} + \sum_{\lambda \in \Lambda}\tick \left({{1\over \lambda^2}\over (1-{z\over\lambda})^2} - {1\over \lambda^2}\right)\]
\[ = {1\over z^2} + \sum_{\lambda \in \Lambda}\tick \left({1\over \lambda^2}{1\over (1-{z\over\lambda})^2} - {1\over \lambda^2}\right)\]
\[ = {1\over z^2} + \sum_{\lambda \in \Lambda}\tick \left({1\over \lambda^2}\left(\sum_{n=0}^\infty {z^n\over\lambda^n}\right)^2 - {1\over \lambda^2}\right)\]
\[ = {1\over z^2} + \sum_{\lambda \in \Lambda}\tick {1\over \lambda^2}\left(-1 + \left(\sum_{n=0}^\infty {z^n\over\lambda^n}\right)^2 \right)\]
\[ = {1\over z^2} + \sum_{\lambda \in \Lambda}\tick {1\over \lambda^2}\left(-1 + \left(\sum_{n=0}^\infty (n+1){z^n\over\lambda^n}\right) \right)\]
\[ = {1\over z^2} + \sum_{\lambda \in \Lambda}\tick {1\over \lambda^2} \left(\sum_{n=1}^\infty (n+1){z^n\over\lambda^n}\right) \]
\[ = {1\over z^2} + \sum_{\lambda \in \Lambda}\tick  \left(\sum_{n=1}^\infty (n+1){z^n\over\lambda^{n+2}}\right) \]
\[ = {1\over z^2} + \sum_{n=1}^\infty (n+1)z^n \sum_{\lambda \in \Lambda}\tick   {1\over\lambda^{n+2}} \]
\[ = {1\over z^2} + \sum_{n=1}^\infty (n+1) G_{n+2}z^n \]
And observe that every lattice $\Lambda$ is symmetric about the origin, so we have pairs of $\lambda$ and $-\lambda$,
and for odd $n$ we have $G_n = 0$, because every $\lambda^{-n}$ and $(-\lambda)^{-n}$ cancel. So
\[\wp= {1\over z^2} + \sum_{n=1}^\infty (2n+1) G_{2n+2}z^{2n}\]
And I can consider the derivative
\[\wp'= {-2\over z^3} + \sum_{n=1}^\infty (4n^2-2n) G_{2n+2}z^{2n-1}\]
And now I can try to cancel out those poles. Let $T = \wp - z^{-2}$ and $T' = \wp' + 2 z^{-3}$.
\[\wp^3=  z^{-6} + 3 z^{-4} T + 3 z^{-2} T^2 + T^3\]
\[(\wp')^2=  4z^{-6} + 3 z^{-3} T' + (T')^2\]
Ok so now I observe that
\[4\wp^3 - (\wp')^2  = 12 z^{-4} T + 12 z^{-2} T^2 + 4T^3 - 3 z^{-3} T' - (T')^2\]
eliminates the order 6 pole. What other poles do we still have? Since $T = 3G_{4}z^2 + \cdots$, we
find $12z^{-4}T$ starts $36G_4z^{-2} + \cdots$. So I want to subtract off a copy of $36G_4\wp$.
Oof, getting confused. Let's make some more definitions.
Since I see $G_6$ is eventually used, let's say

\[U = \sum_{n=3}^\infty (2n+1) G_{2n+2}z^{2n}\]
\[\wp= z^{-2} + 3G_4z^2 + 5G_6z^4 + U\]
\[\wp'= -2z^{-3} + 2G_4z + 20G_6z^3 + U'\]
\[(\wp')^2= 4z^{-6} -8G_4z^{-2} + \cdots \]
\[\wp^3= z^{-6} + 9G_4z^{-2} + \cdots\]
\section{Cauchy Integral Formula}

Let's try to do a little integral around the origin:
\[\oint z^n dz\]
Want to substitute $z = k e^{2\pi i t}$. Therefore $dz = 2\pi i k e^{2\pi i t} dt$.
So we're trying to compute
\[2\pi i \int_0^{1}  k^n e^{2\pi i tn} k e^{2\pi i t} dt \]
\[= 2\pi ik^{n+1} \int_0^{1}  e^{2\pi i t(n+1)}  dt \]
\[= 2\pi ik^{n+1} \int_0^{1}  e^{2\pi i t(n+1)}  dt \]
\[= \begin{cases}
\displaystyle 2\pi ik^{n+1} \int_0^{1}  dt & \hbox{if $n=-1$;}\\
\displaystyle2\pi ik^{n+1} \int_0^{1}  e^{2\pi i t(n+1)}  dt & \hbox{ow.}
\end{cases} \]
\[= \begin{cases}
\displaystyle 2\pi i   & \hbox{if $n=-1$;}\\
\displaystyle {k^{n+1}\over n+1} (  e^{2\pi i t(n+1)})\bigg|_0^{1} & \hbox{ow.}
\end{cases} \]
\[= \begin{cases}
\displaystyle 2\pi i   & \hbox{if $n=-1$;}\\
\displaystyle 0 & \hbox{ow.}
\end{cases} \]
How could I think of this with respect to a DFT?
Change $\int_0^1$ to something like $\sum_{t = 0}^{N-1}$.
Substitute $e^{2\pi i t/ N}$ for $z$, turning  $z^n$ into $e^{2\pi i t n/ N}$. We do find that
\[= \sum_{t=0}^{N-1} e^{2\pi i tn / N} = \begin{cases}
\displaystyle N   & \hbox{if $n=0\pmod N$;}\\
\displaystyle 0 & \hbox{ow.}
\end{cases} \]

\section{Lagrange Interpolation}

If I want to make a polynomial $f(x)$ that is 1 at $x = a_i$ and $0$ for $x=a_j$ for $j\ne i$,
then what I want is:
\[ \prod_{j\ne i} \left(x-a_j\over a_i - a_j\right)\]
So if I want a polynomial that is 1 everywhere, I can sum all these basis functions:
\[1 = \sum_i \prod_{j\ne i} \left(x-a_j\over a_i - a_j\right)\]


\[ = \sum_i \left(\prod_{j< i} \left(x-a_j\over a_i - a_j\right)\right)\left(\prod_{j> i} \left(x-a_j\over a_i - a_j\right)\right)\]
\[ = \sum_i \left(\prod_{j< i} \left(a_j - x\over a_j - a_i \right)\right)\left(\prod_{j> i} \left(x-a_j\over a_i - a_j\right)\right)\]
\[\prod_{i < j}(a_i - a_j) = \sum_i \left(\prod_{j< i} \left(a_j - x \right)\right)\left(\prod_{j> i} \left(x-a_j\right)\right)\]
\[f(\bar a) = \sum_i f([x/i]\bar a)\]




Define
\[f(\bar a) = \prod_{i < j} a_i - a_j\]
and claim:
\[f(\bar a) = \sum_i f([x/i]\bar a)\]
Try to prove by induction. For the base case we observe
\[a_1- a_2 = x - a_2 + a_1-  x\]
therefore
\[f(a_1, a_2) = f(x, a_2) + f(a_1, x)\]
In the step case suppose every $\sum_i$ means $\sum_{i=1}^{|\bar a|}$ and we're trying to show
\[f(\bar a, b) = f(\bar a, x) + \sum_i f([x/i]\bar a, b)\]
By definition of $f$ we have
\[f(\bar a, b) = f(\bar a)\prod_j (a_j - b)\]
and so
\[f([x/i]\bar a, b) = f([x/i]\bar a)\left(x-b \right)\prod_{j\ne i} (a_j - b)\]

So our goal is now
\[f(\bar a)\prod_j (a_j - b) = f(\bar a)\prod_j (a_j - x) + \sum_i f([x/i]\bar a)\left(x-b  \right)\prod_{j\ne i} (a_j - b)\]
Equivalently
\[f(\bar a)\prod_j (a_j - b) = f(\bar a)\prod_j (a_j - x) + \sum_i f([x/i]\bar a)\left((x-a_i)+(a_i-b)  \right)\prod_{j\ne i} (a_j - b)\]
Or
\[f(\bar a)\prod_j (a_j - b) = f(\bar a)\prod_j (a_j - x) \]
\[{} + \sum_i f([x/i]\bar a)\left(x-a_i  \right)\prod_{j\ne i} (a_j - b)\]
\[{} + \sum_i f([x/i]\bar a)\left(a_i-b  \right)\prod_{j\ne i} (a_j - b)\]
Or
\[f(\bar a)\prod_j (a_j - b) = f(\bar a)\prod_j (a_j - x) \]
\[{} + \sum_i f([x/i]\bar a)\left(x-a_i  \right)\prod_{j\ne i} (a_j - b)\]
\[{} + \sum_i f([x/i]\bar a)\prod_{j} (a_j - b)\]
And with the induction hypothesis we see this is
\[f(\bar a)\prod_j (a_j - b) = f(\bar a)\prod_j (a_j - x) \]
\[{} + \sum_i f([x/i]\bar a)\left(x-a_i  \right)\prod_{j\ne i} (a_j - b)\]
\[{} +  f(\bar a)\prod_{j} (a_j - b)\]
So
\[0 = f(\bar a)\prod_j (a_j - x)+ \sum_i f([x/i]\bar a)\left(x-a_i  \right)\prod_{j\ne i} (a_j - b)\]
and
\[ \sum_i f([x/i]\bar a)\left(a_i-x  \right)\prod_{j\ne i} (a_j - b) = f(\bar a)\prod_j (a_j - x)\]
now
\[ \sum_i f([x/i]\bar a)\left((a_i-b)+(b-x)  \right)\prod_{j\ne i} (a_j - b) = f(\bar a)\prod_j (a_j - x)\]
\[ \left(\sum_i f([x/i]\bar a)(a_i-b)\prod_{j\ne i} (a_j - b)\right) +
\left(\sum_i f([x/i]\bar a)(b-x) \prod_{j\ne i} (a_j - b)\right) = f(\bar a)\prod_j (a_j - x)\]
\[ \left(\sum_i f([x/i]\bar a)\prod_{j} (a_j - b)\right) +
\left(\sum_i f([x/i]\bar a)(b-x) \prod_{j\ne i} (a_j - b)\right) = f(\bar a)\prod_j (a_j - x)\]
\[ f(\bar a)\prod_{j} (a_j - b) +
\left(\sum_i f([x/i]\bar a)(b-x) \prod_{j\ne i} (a_j - b)\right) = f(\bar a)\prod_j (a_j - x)\]

\section{Fresh}
Define
\[f(\bar a) = \prod_{i < j} a_i - a_j\]
\[\bar a = (a_1,\ldots, a_n) \rightarrow  [i]\bar a = (a_1, \ldots, a_{i-1}, 0, a_{i+1},\ldots, a_n)\]
We want to show the recurrence:
\[f(\bar a) = \sum_i f([i]\bar a)\]
The $n=2$ case is easy: $a - b = -b + a$.

Notice that
\[f(\bar a, c) = f(\bar a)\prod_j (a_j - c) \]
%% and
%% \[f([i]\bar a, c) = f( [i]\bar a) (-c)\prod_{j\ne i} (a_j - c)\]
%% The step case requires
%% \[f(\bar a, c) = f(\bar a, 0) + \sum_i f([i]\bar a, c)\eqno(*)\]

I want to expand out
\[\prod_j (a_j - c)\]
in powers of $-c$.
\[\prod_j (a_j - c) = \sum_{m} (-c)^m \sum_{J \subseteq n \atop |J| = n-m} \prod_{j\in J} a_j\]
Therefore
\[f(\bar a, c) = f(\bar a)\sum_{m} (-c)^m \sum_{J \subseteq n \atop |J| = n-m} a_J \]
where $a_J = \prod_{j\in J} a_j$.
Now the step case of the induction requires
\[f(\bar a, c) = f(\bar a, 0) + \sum_i f([i]\bar a, c)\eqno(*)\]
hence
\[f(\bar a)\sum_{m} (-c)^m \sum_{J \subseteq n \atop |J| = n-m} a_J = f(\bar a)\prod_j a_j + \sum_i f([i]\bar a, c)\]
hence what we need is
\[f(\bar a)\sum_{m\ge 1} (-c)^m \sum_{J \subseteq n \atop |J| = n-m} a_J =  \sum_i f([i]\bar a, c)\]
\[f(\bar a)\sum_{m\ge 1} (-c)^m \sum_{J \subseteq n \atop |J| = n-m} a_J =
\sum_i f([i]\bar a)\sum_{m\ge 1} (-c)^m \sum_{J \subseteq n\setminus i \atop |J| = n-m} a_J\]
So I think what this is telling me that at any $m \ge 1$ we need
\[f(\bar a) \sum_{J \subseteq n \atop |J| = n-m} a_J =
\sum_i f([i]\bar a) \sum_{J \subseteq n\setminus i \atop |J| = n-m} a_J\]
i.e. by i.h.
\[\sum_i f([i]\bar a) \sum_{J \subseteq n \atop |J| = n-m} a_J =
\sum_i f([i]\bar a) \sum_{J \subseteq n\setminus i \atop |J| = n-m} a_J\]

\[\sum_i f([i]\bar a) \sum_{\substack{J \subseteq n \\ |J| = n-m \\ i \in J}} a_J = 0\]
\[\sum_i f([i]\bar a)a_i \sum_{\substack{J \subseteq n\setminus i \\ |J| = n-m-1 }} a_J = 0\]

I guess try to show this by induction on $\bar a$ now? For $n=2$, I have
$ab - ba = 0$, because $m \ge 1$ and $n = 2$ means $|J|=0$.

In the step case, let $b = a_{n+1}$ and try to show
\[\left(f(\bar a, 0)b \sum_{\substack{J \subseteq n \\ |J| = n-m }} a_J\right) + \sum_i f([i]\bar a, b)a_i \sum_{\substack{J \subseteq (n+1)\setminus i \\ |J| = n-m }} a_J = 0\]

\section{Divergent Sums}

Suppose $\zeta$ is an $n^{th}$ root of unity. Let
\[b(q) = {q\over (1-q)^2} = q + 2q^2 + 3q^3 + 4q^4 + \cdots\]

Then it's pretty easy to see by inspecting the power series that
\[\sum_{i=0}^{n-1}  b(\zeta^i q) = n^2 b(q^n)\]
If I define
\[Q = \prod_{i=1}^{n-1}(1-\zeta^i q) \qquad Q_j = Q / (1-\zeta^j q)\]
then I should be able to reason that
\[b(q) + \sum_{i=1}^{n-1}  b(\zeta^i q) = n^2 b(q^n)\]
\[b(q) Q^2 + \sum_{i=1}^{n-1}  b(\zeta^i q)Q^2 = n^2 b(q^n) Q^2\]
\[b(q) Q^2 + \sum_{i=1}^{n-1}  {\zeta^i q\over (1-\zeta^i q)^2}Q^2 = n^2 b(q^n) Q^2\]
\[b(q) Q^2 + \sum_{i=1}^{n-1}  \zeta^i q Q_i^2 = n^2 b(q^n) Q^2\]

\begin{lemma}
\[Q = \sum_{k=0}^{n-1} q^k\]
\end{lemma}

\begin{proof}
It should be sufficiently clear that
\[\prod_{i=0}^{n-1}(q-\zeta^i) = q^n - 1\]
That is the unique polynomial that has precisely those roots. Replace $q$ with $q^{-1}$:
\[\prod_{i=0}^{n-1}(q^{-1}-\zeta^i) = q^{-n} - 1\]
Multiply by $q^n$:
\[\prod_{i=0}^{n-1}(1-\zeta^iq) = 1 - q^n = \left(\sum_{k=0}^{n-1} q^k\right) - \left(\sum_{k=1}^{n} q^k\right)\]
Divide by $(1-q)$:
\[\prod_{i=1}^{n-1}(1-\zeta^iq) = \sum_{k=0}^{n-1} q^k\]
as required. \cqed
\end{proof}

Define
\[p(u) = \prod_{i = 1}^{n-1} (1-\zeta^i uq)\]
\begin{lemma}
$Q_j(1-q) = p(\zeta^j)$
\end{lemma}

\begin{proof}
\[ Q_j(1-q) = (1-\zeta^j q)^{-1} Q(1-q) \]
\[ = {(1-q)(1-\zeta^j q)^{-1}\prod_{i=1}^{n-1}(1-\zeta^i q)} \]
\[ = (1-\zeta^j q)^{-1}{\prod_{i=0}^{n-1}(1-\zeta^i q)} \]
\[ = (1-\zeta^j q)^{-1}{\prod_{i=j}^{n+j-1}(1-\zeta^i q)} \]
\[ = {\prod_{i=j+1}^{n+j-1}(1-\zeta^i q)} \]
\[ = {\prod_{i=1}^{n-1}(1-\zeta^i \zeta^j q)} = p(\zeta^j)\]
\cqed
\end{proof}


\begin{lemma}
\[\sum_{i=0}^{n-1} \zeta^i p(\zeta^i)^2 = n^2 q^{n-1}\]
\end{lemma}

\begin{proof}

\cqed
\end{proof}

\begin{lemma}
\[p(1) = \left(\sum_{t = 0}^{n-1} q^t\right)^2\]
\end{lemma}

\begin{proof}

\cqed
\end{proof}

\begin{lemma}
\[\sum_{i=1}^{n-1}  \zeta^i q Q_i^2 = -\sum_{t=0}^{2n-4} {t+3\choose t} q^t\]
% 3 → 2
% 4 → 4
% 5 → 6
% -q^6 - 4*q^5 - 10*q^4 - 20*q^3 - 10*q^2 - 4*q - 1
\end{lemma}

\begin{proof}
\[\sum_{i=1}^{n-1}  \zeta^i q Q_i^2 = \sum_{i=1}^{n-1} {\zeta^i p(\zeta^i)^2\over(1-q)^2}\]
\[= {-p(1) + \sum_{i=0}^{n-1} \zeta^i p(\zeta^i)^2\over(1-q)^2}\]
\[= {-p(1) + n^2 q^{n-1} \over (1-q)^2}\]
\[= {-\left(\sum_{t = 0}^{n-1} q^t\right)^2 + n^2 q^{n-1} \over (1-q)^2}\]
Now I need to show that
\[\left(\sum_{t = 0}^{n-1} q^t\right)^2 = n^2 q^{n-1} + \left(\sum_{t=0}^{2n-4} {t+3\choose t} q^t\right)(1-q)^2\]
\cqed
\end{proof}

\subsection{Generating Functions in Two Variables}
Wait a minute, all this ${t+3\choose t}$ stuff is wrong. Let's figure this out from scratch.
Think about generating functions in two variables. I have
\[{1\over (1-x)(1-y)} = \begin{pmatrix}
1&x&x^2&\cdots\\
y&xy&x^2y&\cdots\\
y^2&xy^2&x^2y^2&\cdots\\
\vdots&\vdots&\vdots&\ddots\\
\end{pmatrix}\]
And I can ignore the monomials in what follows and just write the coefficients:
\[{1\over (1-x)(1-y)} = \begin{pmatrix}
1&1&1&\cdots\\
1&1&1&\cdots\\
1&1&1&\cdots\\
\vdots&\vdots&\vdots&\ddots\\
\end{pmatrix}\]
Then we also have
\[{xy\over (1-x)(1-y)} = \begin{pmatrix}
0&0&0&\cdots\\
0&1&1&\cdots\\
0&1&1&\cdots\\
\vdots&\vdots&\vdots&\ddots\\
\end{pmatrix}\]
\[{1 \over (1-x)(1-y)(1-xy)} = {1+xy+x^2y^2+\cdots \over (1-x)(1-y)} = \begin{pmatrix}
1&1&1&\cdots\\
1&2&2&\cdots\\
1&2&3&\cdots\\
\vdots&\vdots&\vdots&\ddots\\
\end{pmatrix}\]
\[{1 \over (1-x)(1-y)(1-xy)^2} = \begin{pmatrix}
1&1&1&1&\cdots\\
1&3&3&3&\cdots\\
1&3&6&6&\cdots\\
1&3&6&10&\cdots\\
\vdots&\vdots&\vdots&\vdots&\ddots\\
\end{pmatrix}\]
\[{1 \over (1-x)(1-y)(1-xy)^3} = \begin{pmatrix}
1&1&1&1&\cdots\\
1&4&4&4&\cdots\\
1&4&10&10&\cdots\\
1&4&10&20&\cdots\\
\vdots&\vdots&\vdots&\vdots&\ddots\\
\end{pmatrix}\]
And reading {\em diagonals} of this gives us something awfully close to what we want.
That is, substituting $y \leftarrow q$ and $x \leftarrow qz$ would give us
\[{1 \over (1-qz)(1-q)(1-q^2z)^3} = \begin{pmatrix}
1&qz&q^2z^2&q^3z^3&\cdots\\
q&4q^2z&4q^3z^2&4q^4z^3&\cdots\\
q^2&4q^3z&10q^4z^2&10q^5z^3&\cdots\\
q^3&4q^4z&10q^5z^2&20q^6z^3&\cdots\\
\vdots&\vdots&\vdots&\vdots&\ddots\\
\end{pmatrix}\]
\[ = 1 + q(1 + z) + q^2(1 + 4z + z^2) + q^3(1 + 4z + 4z^2 + z^3) + \cdots \]
So just the even powers of $q$ give us the polynomials we're interested in. Therefore we want to symmetrize in $q$:
\[{1\over 2}\left({1 \over (1-qz)(1-q)(1-q^2z)^3} + {1 \over (1+qz)(1+q)(1-q^2z)^3}\right)\]
\[= {1\over 2}\left({(1-qz)(1-q) \over (1-q^2z^2)(1-q^2)(1-q^2z)^3} + {(1+qz)(1+q) \over (1-q^2z^2)(1-q^2)(1-q^2z)^3}\right)\]
\[= {1\over 2}\left({2 + 2q^2z \over (1-q^2z^2)(1-q^2)(1-q^2z)^3} \right)\]
\[= {1 + q^2z \over (1-q^2z^2)(1-q^2)(1-q^2z)^3} \]
Now $q$ only appears, by design, as $q^2$, so replace $q \leftarrow \sqrt{q}$ to get
\[{1 + qz \over (1-qz^2)(1-q)(1-qz)^3} =
\begin{pmatrix}
1&&qz^2&&q^2z^4&\cdots\\
&4qz&&4q^2z^3&&\cdots\\
q&&10q^2z^2&&10q^3z^4&\cdots\\
&4q^2z&&20q^3z^3&&\cdots\\
q^2&&10q^3z^2&&35q^4z^4&\cdots\\
\vdots&\vdots&\vdots&\vdots&\ddots\\
\end{pmatrix}\]
\[ = 1 + q(1 + 4z + z^2) + q^2(1 + 4z + 10z^2 + 4z^3 + z^4) + \cdots \]
Now we want to see systematically what happens when this polynomial is multiplied by $(1-z)^2$. I know the first
few terms are
\[(1-2z+z^2) + q(1+2z-6z^2+2z^3+z^4) + q^2(1+2z+3z^2-12z^3+3z^4+2z^5+z^6) + \cdots \]
That is, there's a factor of $4z + 9qz^2 + 16q^2z^3 + \cdots$ subtracted off. What should be there before that's subtracted is
\[\begin{pmatrix}
0&&z^2&&qz^4&\cdots\\
&2z&&2qz^3&&\cdots\\
1&&3qz^2&&3q^2z^4&\cdots\\
&2qz&&4q^2z^3&&\cdots\\
q&&3q^2z^2&&5q^3z^4&\cdots\\
\vdots&\vdots&\vdots&\vdots&\ddots\\
\end{pmatrix}\]
We can build this like so:
\[{1 \over (1-qz)(1-q)(1-q^2z)} = \begin{pmatrix}
1&qz&q^2z^2&q^3z^3&\cdots\\
q&2q^2z&2q^3z^2&2q^2z^3&\cdots\\
q^2&2q^3z&3q^2z^2&3q^5z^3&\cdots\\
q^3&2q^2z&3q^5z^2&4q^6z^3&\cdots\\
\vdots&\vdots&\vdots&\vdots&\ddots\\
\end{pmatrix}\]
\[{1+qz \over (1-qz^2)(1-q)(1-qz)} =
\begin{pmatrix}
1&&qz^2&&q^2z^4&\cdots\\
&2qz&&2q^2z^3&&\cdots\\
q&&3q^2z^2&&3q^3z^4&\cdots\\
&2q^2z&&4q^3z^3&&\cdots\\
q^2&&3q^3z^2&&5q^4z^4&\cdots\\
\vdots&\vdots&\vdots&\vdots&\ddots\\
\end{pmatrix}\]
So what we want to obtain is
\[{1\over q}\left({1+qz \over (1-qz^2)(1-q)(1-qz)} - 1\right) \]

Before expanding that out, I want to compute the diagonal of squared stuff.
\[ g(q,z) = 4z + 9qz^2 + 16q^2z^3 + \cdots \]
so $g(q,z) = zh(qz)$ where
\[ h(x) = 4 + 9x + 16x^2 + 25x^3 + \cdots \]
and so
\[ h(x) = {1\over x}\left(DxD \left(1\over 1- x\right) - 1\right)\]
\[ = {x^2 - 3x + 4\over (1-x)^3}\]
So my claim I think is that
\[f(q,z) = {1 + qz \over (1-qz^2)(1-q)(1-qz)^3} \]
\[\Delta(q,z) = {q^2z^3 - 3qz^2 + 4z\over (1-qz)^3}\]
\[\sigma(q,z) = {1\over q}\left({1+qz \over (1-qz^2)(1-q)(1-qz)} - 1\right)\]

\[f(q,z) - \Delta(q,z) = (1 - z)^2 \sigma(q,z)\]

Now working on the left I can see that
\[{1 + qz \over (1-qz^2)(1-q)(1-qz)^3} - {q^2z^3 - 3qz^2 + 4z\over (1-qz)^3} =\]
\[{1 + qz - (1-qz^2)(1-q)(q^2z^3 - 3qz^2 + 4z)\over (1-qz^2)(1-q)(1-qz)^3} \]
So actually I only need to confirm that
\[ q(1 + qz - (1-qz^2)(1-q)(q^2z^3 - 3qz^2 + 4z)) = (1-qz)^2(1 + qz - (1-qz^2)(1-q)(1-qz))\]
But hm sage checking that fails.

%% P.<q, z> = QQ[]
%% q*(1+q*z - (1-q*z^2)*(1-q)*(q^2*z^3 - 3*q*z^2 + 4*z)) - (1-q*z)^2 *(1 + q*z - (1-q*z^2)*(1-q)*(1-q*z))

%% var('q z')
%% def f(q,z):
%%     return (1 + q * z) / ((1 - q * z^2)*(1-q)*((1-q*z)^3))
%% def delta(q,z):
%%     return (q^2 * z^3 - 3 * q * z^2 + 4 * z) / (1 - q*z)^3
%% def sigma(q,z):
%%     return (1/q) * ((1 + q*z) / ((1-q*z^2) * (1-q) *(1-q*z)) - 1)
%% (f(q,z) - delta(q,z) - (1-z)^2 * sigma(q,z)).subs(q=0.1,z=0.06)
\end{document}
